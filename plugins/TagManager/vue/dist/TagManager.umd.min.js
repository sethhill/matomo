(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["TagManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["TagManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,n){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/TagManager/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"8bbf":function(e,n){e.exports=t},a5a2:function(e,t){e.exports=n},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ImportVersion",(function(){return p})),n.d(t,"VariableSelect",(function(){return G})),n.d(t,"VariableSelectType",(function(){return ne})),n.d(t,"FieldTextareaVariable",(function(){return ue})),n.d(t,"FieldVariableTemplate",(function(){return Te})),n.d(t,"FieldVariableTypeTemplate",(function(){return Ne})),n.d(t,"VariableEdit",(function(){return Et})),n.d(t,"VariableList",(function(){return Tn})),n.d(t,"VariableManage",(function(){return Sn})),n.d(t,"TriggerEdit",(function(){return Ea})),n.d(t,"TriggerList",(function(){return mi})),n.d(t,"TriggerManage",(function(){return fi})),n.d(t,"TagEdit",(function(){return So})),n.d(t,"TagList",(function(){return Vl})),n.d(t,"TagManage",(function(){return kl})),n.d(t,"VersionEdit",(function(){return Hc})),n.d(t,"VersionList",(function(){return Bs})),n.d(t,"VersionManage",(function(){return Hs})),n.d(t,"ContainerEdit",(function(){return bd})),n.d(t,"ContainerList",(function(){return Yd})),n.d(t,"ContainerManage",(function(){return tu})),n.d(t,"ContainerDashboard",(function(){return Ku})),n.d(t,"ContainerSelector",(function(){return cg})),n.d(t,"ManageInstallTagCode",(function(){return Xg})),n.d(t,"TrackingCodeCommon",(function(){return Cm})),n.d(t,"TrackingCodePage",(function(){return Mm})),n.d(t,"TrackingSPAPage",(function(){return ab})),n.d(t,"Debugging",(function(){return yp})),n.d(t,"CopyDialog",(function(){return wp})),"undefined"!==typeof window){var a=window.document.currentScript,i=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(n.p=i[1])}var r=n("8bbf"),o={class:"tagManagerImportVersion"},l={class:"ui-confirm",id:"confirmImportContainerVersion",ref:"confirmImportContainerVersion"},c=["value"],s=["value"];function d(e,t,n,a,i,d){var u=Object(r["resolveComponent"])("ActivityIndicator"),g=Object(r["resolveComponent"])("Field"),m=Object(r["resolveComponent"])("SaveButton"),b=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",o,[Object(r["createVNode"])(b,{"content-title":e.translate("TagManager_ImportVersion")},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VersionImportInfo")),1),Object(r["createVNode"])(u,{loading:e.isUpdating,"loading-message":e.translate("TagManager_UpdatingData")},null,8,["loading","loading-message"]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(g,{uicontrol:"text",modelValue:e.backupName,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.backupName=t}),name:"backupName",placeholder:" ",title:e.backupNameTitle,"inline-help":e.translate("TagManager_BackupVersionNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(g,{uicontrol:"textarea",modelValue:e.importContent,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.importContent=t}),name:"importContent",placeholder:" ","full-width":!0,title:e.translate("TagManager_VersionImportContentTitle")},null,8,["modelValue","title"])]),Object(r["createVNode"])(m,{class:"importVersion",disabled:!e.importContent,onConfirm:t[2]||(t[2]=function(t){return e.importVersion(e.backupName,e.importContent)}),value:e.translate("TagManager_VersionImportOverwriteContent")},null,8,["disabled","value"])]})),_:1},8,["content-title"]),Object(r["createElementVNode"])("div",l,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfirmImportContainerVersion")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,c),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,s)],512)])}var u=n("19dc"),g=n("a5a2"),m="importContainerVersion",b=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:u["ContentBlock"],ActivityIndicator:u["ActivityIndicator"],Field:g["Field"],SaveButton:g["SaveButton"]},data:function(){return{isUpdating:!1,backupName:"",importContent:""}},methods:{showNotification:function(e,t){var n=u["NotificationsStore"].show({message:e,context:t,type:"transient",id:m});setTimeout((function(){u["NotificationsStore"].scrollToNotification(n)}),200)},importVersion:function(e,t){var n=this;if(t){var a;try{a=JSON.parse(t)}catch(i){return void this.showNotification(Object(u["translate"])("TagManager_ErrorInvalidContainerImportFormat"),"error")}"tags"in a&&"triggers"in a&&"variables"in a&&"idcontainer"in a&&"context"in a?u["Matomo"].helper.modalConfirm(this.$refs.confirmImportContainerVersion,{yes:function(){n.isUpdating=!0;var e={exportedContainerVersion:t};u["AjaxHelper"].post({method:"TagManager.importContainerVersion",idContainer:n.idContainer,backupName:n.backupName},e).then((function(){n.showNotification(Object(u["translate"])("TagManager_VersionImportSuccess"),"success"),n.isUpdating=!1,window.location.reload()})).catch((function(){n.isUpdating=!1}))}}):this.showNotification(Object(u["translate"])("TagManager_ErrorContainerVersionImportIncomplete"),"error")}}},computed:{backupNameTitle:function(){return"".concat(Object(u["translate"])("TagManager_BackupVersionName")," (").concat(Object(u["translate"])("General_Recommended"),")")}}});b.render=d;var p=b,h={class:"tagManagerManageSelect tagManagerVariableSelect"},f={class:"tableActionBar"},v=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),j={class:"collection with-header"},O={class:"collection-header"},T=["onClick"],y={class:"title"},V={class:"secondary-content"},C=["onClick","title"],N={class:"collection-header"},E=["onClick"],S={class:"title"},w={class:"secondary-content"},k=["title"],M={class:"tableActionBar"},_=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1);function D(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("ActivityIndicator");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",h,[Object(r["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(r["createElementVNode"])("div",f,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVariable",onClick:t[0]||(t[0]=function(t){return e.createVariable()})},[v,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)],512),[[r["vShow"],!e.isLoading]])]),Object(r["createElementVNode"])("ul",j,[Object(r["createElementVNode"])("li",O,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(e.translate("TagManager_CustomVariables")),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.containerVariables,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",onClick:function(n){return e.selectVariable(t)},key:n},[Object(r["createElementVNode"])("span",y,Object(r["toDisplayString"])(t.name)+" ("+Object(r["toDisplayString"])(e.translate("TagManager_Type"))+": "+Object(r["toDisplayString"])(t.type)+") ",1),Object(r["createElementVNode"])("span",V,[Object(r["createElementVNode"])("i",{class:"icon-edit",onClick:Object(r["withModifiers"])((function(n){return e.editVariable(t)}),["stop"]),title:e.translate("General_Edit")},null,8,C)])],8,T)})),128))]),Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables")),1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.preconfiguredVariables,(function(t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(r["createElementVNode"])("li",N,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(function(t,n){return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:n,onClick:function(n){return e.selectVariable(t)}},[Object(r["createElementVNode"])("span",S,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",w,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.description},null,8,k)],512),[[r["vShow"],!!t.description]])],8,E)),[[r["vShow"],t.is_pre_configured]])})),128))])})),128)),Object(r["createElementVNode"])("div",M,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},[_,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable",e.translate("TagManager_Variable"))),1)],512),[[r["vShow"],!e.isLoading]])])])}function A(e){return U(e)||L(e)||B(e)||x()}function x(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function B(e,t){if(e){if("string"===typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}function L(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function U(e){if(Array.isArray(e))return P(e)}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var I=window,F=I.tagManagerHelper,H=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:Number},components:{ActivityIndicator:u["ActivityIndicator"]},data:function(){return{preconfiguredVariables:[],containerVariables:[],isLoading:!1,actualIdContainerVersion:this.idContainerVersion}},emits:["selectVariable"],created:function(){this.fetchAvailableVariables()},watch:{idContainerVersion:function(e){this.actualIdContainerVersion=e}},methods:{fetchAvailableVariables:function(){var e=this;this.preconfiguredVariables=[],this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.actualIdContainerVersion=t.draft.idcontainerversion,u["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:e.idContainer,idContainerVersion:e.actualIdContainerVersion}).then((function(t){e.preconfiguredVariables=[],e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var n,a=Object.assign(Object.assign({},t),{},{types:t.types.filter((function(e){return e.is_pre_configured}))});(n=e.containerVariables).push.apply(n,A(t.types.filter((function(e){return!e.is_pre_configured})))),a.types.length&&e.preconfiguredVariables.push(a)}))})).catch((function(){e.isLoading=!1}))}))},editVariable:function(e){var t=this;this.actualIdContainerVersion&&F.editVariable(this.idContainer,this.actualIdContainerVersion,e.idvariable,(function(){t.fetchAvailableVariables()}))},createVariable:function(){var e=this;this.actualIdContainerVersion&&F.editVariable(this.idContainer,this.actualIdContainerVersion,0,(function(){e.fetchAvailableVariables()}))},selectVariable:function(e){this.$emit("selectVariable",{variable:e})},fetchContainer:function(){return this.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:this.idContainer})}}});H.render=D;var G=H,R={class:"tagManagerManageSelect tagManagerVariableSelectType"},q=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1);function z(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",R,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"select",name:"variableType".concat(e.variableType),class:"selectVariableType","model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.onChange(t)}),"full-width":!0,options:e.containerVariables},null,8,["name","model-value","options"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVariable",onClick:t[1]||(t[1]=Object(r["withModifiers"])((function(t){return e.createVariable()}),["prevent"]))},[q,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)],512),[[r["vShow"],!e.isLoading]])])}function W(e){return Y(e)||J(e)||K(e)||X()}function X(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function K(e,t){if(e){if("string"===typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}function J(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Y(e){if(Array.isArray(e))return Z(e)}function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Q=window,ee=Q.tagManagerHelper,te=Object(r["defineComponent"])({props:{variableTypeName:{type:String,required:!0},modelValue:String,variableType:String},components:{Field:g["Field"]},emits:["update:modelValue"],data:function(){return{containerVariables:[],isLoading:!1,idContainerVersion:null}},created:function(){this.fetchAvailableVariables()},methods:{fetchAvailableVariables:function(){var e=this;this.containerVariables=[],this.fetchContainer().then((function(t){return e.isLoading=!0,e.idContainerVersion=t.draft.idcontainerversion,u["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:u["MatomoUrl"].parsed.value.idContainer,idContainerVersion:e.idContainerVersion}).then((function(t){e.containerVariables=[],e.isLoading=!1,t.forEach((function(t){var n,a=t.types.filter((function(t){return t.type===e.variableType})).map((function(e){return{key:"{{".concat(e.id,"}}"),value:e.name}}));(n=e.containerVariables).push.apply(n,W(a))})),e.modelValue||1!==e.containerVariables.length||e.onChange(e.containerVariables[0].key)})).catch((function(){e.isLoading=!1}))}))},onChange:function(e){this.$emit("update:modelValue",e)},createVariable:function(){var e=this;this.idContainerVersion&&ee.editVariable(u["MatomoUrl"].parsed.value.idContainer,this.idContainerVersion,0,(function(t){e.fetchAvailableVariables(),t&&e.onChange("{{".concat(t.name,"}}"))}),this.variableType)},fetchContainer:function(){return this.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getContainer",filter_limit:"-1",idContainer:u["MatomoUrl"].parsed.value.idContainer})}}});te.render=z;var ne=te,ae={class:"fieldVariableTemplate"},ie=["type","id","name","value"],re=["title"],oe=["for","innerHTML"];function le(e,t,n,a,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ae,[Object(r["createElementVNode"])("textarea",Object(r["mergeProps"])({class:"control_".concat(e.uiControl," materialize-textarea"),type:e.uiControl,id:e.name,name:e.name,value:e.modelValue,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"textarea"}),null,16,ie),Object(r["createElementVNode"])("span",{class:"icon-code",style:{"margin-top":"14px",position:"absolute"},title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,re),Object(r["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,oe)])}var ce=window,se=ce.tagManagerHelper,de=Object(r["defineComponent"])({props:{name:String,uiControlAttributes:Object,modelValue:String,title:String,uiControl:{type:String,required:!0}},inheritAttrs:!1,emits:["update:modelValue"],created:function(){this.onKeydown=Object(u["debounce"])(this.onKeydown.bind(this),50)},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;se.selectVariable((function(t){se.insertTextSnippetAtElement(e.$refs.textarea,"{{".concat(t.id,"}}"))}))}},watch:{modelValue:function(){var e=this,t=window,n=t.Materialize;setTimeout((function(){n.textareaAutoResize(e.$refs.textarea),n.updateTextFields()}))}},mounted:function(){var e=this,t=window,n=t.Materialize;setTimeout((function(){n.textareaAutoResize(e.$refs.textarea),n.updateTextFields()}))}});de.render=le;var ue=de,ge={class:"fieldVariableTemplate"},me=["type","id","name","value"],be=["title"],pe=Object(r["createElementVNode"])("br",null,null,-1),he=["for","innerHTML"];function fe(e,t,n,a,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ge,[Object(r["createElementVNode"])("input",Object(r["mergeProps"])({class:"control_".concat(e.uiControl),type:e.uiControl,id:e.name,name:e.name,value:e.modelValueText,onKeydown:t[0]||(t[0]=function(t){return e.onKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onKeydown(t)}),placeholder:"",style:{width:"calc(100% - 40px)"}},e.uiControlAttributes,{ref:"input"}),null,16,me),Object(r["createElementVNode"])("span",{class:"icon-code",title:e.translate("TagManager_ChooseVariable"),onClick:t[2]||(t[2]=function(t){return e.selectVariable()})},null,8,be),pe,Object(r["createElementVNode"])("label",{for:e.name,innerHTML:e.$sanitize(e.title)},null,8,he)])}var ve=window,je=ve.tagManagerHelper,Oe=Object(r["defineComponent"])({props:{uiControl:{type:String,required:!0},uiControlAttributes:Object,name:String,title:String,modelValue:null},inheritAttrs:!1,emits:["update:modelValue"],computed:{modelValueText:function(){return"undefined"===typeof this.modelValue||null===this.modelValue?"":this.modelValue.toString()}},created:function(){this.onKeydown=Object(u["debounce"])(this.onKeydown.bind(this),50)},mounted:function(){setTimeout((function(){window.Materialize.updateTextFields()}))},watch:{modelValue:function(){setTimeout((function(){window.Materialize.updateTextFields()}))}},methods:{onKeydown:function(e){this.$emit("update:modelValue",e.target.value)},selectVariable:function(){var e=this;je.selectVariable((function(t){je.insertTextSnippetAtElement(e.$refs.input,"{{".concat(t.id,"}}"))}))}}});Oe.render=fe;var Te=Oe,ye=["for","innerHTML"];function Ve(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("VariableSelectType");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",null,[Object(r["createVNode"])(l,{"model-value":e.modelValue,id:e.name,name:e.name,"variable-type-name":e.title,"variable-type":e.uiControlAttributes.variableType,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.$emit("update:modelValue",t)})},null,8,["model-value","id","name","variable-type-name","variable-type"]),Object(r["createElementVNode"])("label",{for:e.name,style:{"font-size":"0.8rem"},innerHTML:e.$sanitize(e.title)},null,8,ye)])}var Ce=Object(r["defineComponent"])({props:{uiControlAttributes:{type:Object,required:!0},name:String,title:String,modelValue:String},components:{VariableSelectType:ne},emits:["update:modelValue"]});Ce.render=Ve;var Ne=Ce;function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Se={class:"editVariable tagManagerManageEdit",ref:"root"},we={class:"loadingPiwik"},ke=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Me={class:"loadingPiwik"},_e=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),De={key:0,class:"form-group row"},Ae={class:"col s12"},xe={key:1},Be={class:"form-group row"},Le={class:"col s12"},Ue={class:"innerFormField"},Pe={class:"form-group row"},Ie={class:"col s12 m12"},Fe={for:"lookup_table"},He={class:"innerFormField comparisonField"},Ge={class:"innerFormField"},$e={class:"innerFormField"},Re=["onClick","title"],qe={class:"entityCancel"},ze={id:"confirmSelectVariableType"},We={class:"collection-header"},Xe=["onClick","title"],Ke=["src"],Je={class:"title"},Ye={class:"secondary-content"},Ze=["title"],Qe={class:"entityCancel"};function et(e,t,n,a,i,o){var l=this,c=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("GroupedSettings"),d=Object(r["resolveComponent"])("SaveButton"),u=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Se,[Object(r["createVNode"])(u,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])((function(){var n,a,i,o,u;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",we,[ke,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Me,[_e,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("form",{onSubmit:t[8]||(t[8]=function(t){return e.edit?e.updateVariable():e.createVariable()})},[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-warning"},Object(r["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[r["vShow"],e.isVariableDisabled]]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(c,{uicontrol:"text",name:"name","model-value":e.variable.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.variable.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_VariableNameHelp"),placeholder:e.translate("TagManager_VariableNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(c,{uicontrol:"textarea",name:"description","model-value":e.variable.description,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.variable.description=t,e.setValueHasChanged()}),maxlength:1e3,title:e.translate("TagManager_Description"),"inline-help":e.translate("TagManager_VariableDescriptionHelp"),placeholder:e.translate("TagManager_VariableDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),null!==(n=e.variable.typeMetadata)&&void 0!==n&&null!==(a=n.parameters)&&void 0!==a&&a.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",De,[Object(r["createElementVNode"])("div",Ae,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureThisVariable")),1)])])):Object(r["createCommentVNode"])("",!0),e.variable?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",xe,[Object(r["createVNode"])(s,{settings:(null===(i=e.variable.typeMetadata)||void 0===i?void 0:i.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[2]||(t[2]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Be,[Object(r["createElementVNode"])("div",Le,[Object(r["createElementVNode"])("h3",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"showAdvancedSettings",onClick:t[3]||(t[3]=Object(r["withModifiers"])((function(t){return e.showAdvanced=!0}),["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[r["vShow"],!e.showAdvanced]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"hideAdvancedSettings",onClick:t[4]||(t[4]=Object(r["withModifiers"])((function(t){return e.showAdvanced=!1}),["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[r["vShow"],e.showAdvanced]])])])],512),[[r["vShow"],null===(o=e.variable.typeMetadata)||void 0===o?void 0:o.hasAdvancedSettings]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",Ue,[Object(r["createVNode"])(c,{uicontrol:"text",name:"default_value","model-value":e.variable.default_value,"onUpdate:modelValue":t[5]||(t[5]=function(t){e.variable.default_value=t,e.setValueHasChanged()}),title:e.translate("TagManager_DefaultValue"),"inline-help":e.translate("TagManager_DefaultValueHelp"),placeholder:e.translate("TagManager_DefaultValuePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",Pe,[Object(r["createElementVNode"])("div",Ie,[Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("label",Fe,Object(r["toDisplayString"])(e.translate("TagManager_LookupTableTitle")),1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.variable.lookup_table,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:n,class:Object(r["normalizeClass"])("lookupTable lookupTable".concat(n," multiple valign-wrapper"))},[Object(r["createElementVNode"])("div",He,[Object(r["createVNode"])(c,{uicontrol:"select",name:"lookup_table_comparison","model-value":t.comparison,"onUpdate:modelValue":function(n){t.comparison=n,e.setValueHasChanged()},"full-width":!0,options:e.availableLookUpComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(r["createElementVNode"])("div",Ge,[Object(r["createVNode"])(c,{uicontrol:"text",name:"lookup_table_matchvalue","model-value":t.match_value,"onUpdate:modelValue":function(n){t.match_value=n,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableMatchValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),Object(r["createElementVNode"])("div",$e,[Object(r["createVNode"])(c,{uicontrol:"text",name:"lookup_table_outvalue","model-value":t.out_value,"onUpdate:modelValue":function(n){t.out_value=n,e.setValueHasChanged()},"full-width":!0,placeholder:e.translate("TagManager_LookupTableOutValue")},null,8,["model-value","onUpdate:modelValue","placeholder"])]),n+1!==e.variable.lookup_table.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:0,class:"icon-minus valign",onClick:function(t){return e.removeLookUpEntry(n)},title:e.translate("General_Remove")},null,8,Re)):Object(r["createCommentVNode"])("",!0)],2)})),128))])])])],512),[[r["vShow"],e.showAdvanced&&(null===(u=e.variable.typeMetadata)||void 0===u?void 0:u.hasAdvancedSettings)]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-warning"},Object(r["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[r["vShow"],e.isVariableDisabled]]),Object(r["withDirectives"])(Object(r["createVNode"])(d,{class:"createButton",onConfirm:t[6]||(t[6]=function(t){return e.edit?e.updateVariable():e.createVariable()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewVariable")},null,8,["disabled","saving","value"]),[[r["vShow"],!e.isVariableDisabled]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",qe,[Object(r["createElementVNode"])("a",{onClick:t[7]||(t[7]=Object(r["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])])],544),[[r["vShow"],!e.chooseVariableType&&e.editTitle]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ze,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.availableVariables,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:n},[Object(r["createElementVNode"])("li",We,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:n,class:Object(r["normalizeClass"])(["collection-item avatar",Ee({disabledTemplate:l.isVariableTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(n){return e.createVariableType(t)},title:l.isVariableTemplateDisabled[t.id]?e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates")):""},[t.icon?(Object(r["openBlock"])(),Object(r["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,Ke)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("span",Je,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(t.description),513),[[r["vShow"],t.description]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",Ye,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,Ze)],512),[[r["vShow"],!!t.help]])],10,Xe)})),128))])})),128)),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Qe,[Object(r["createElementVNode"])("a",{onClick:t[9]||(t[9]=Object(r["withModifiers"])((function(t){return e.cancel()}),["prevent"]))},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])],512),[[r["vShow"],e.chooseVariableType]])]})),_:1},8,["content-title"])],512)}function tt(e,t){return it(e)||at(e,t)||ct(e,t)||nt()}function nt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function at(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(r.push(a.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(l)throw i}}return r}}function it(e){if(Array.isArray(e))return e}function rt(e){return rt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function ot(e){return dt(e)||st(e)||ct(e)||lt()}function lt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ct(e,t){if(e){if("string"===typeof e)return ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ut(e,t):void 0}}function st(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function dt(e){if(Array.isArray(e))return ut(e)}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function gt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function bt(e,t,n){return t&&mt(e.prototype,t),n&&mt(e,n),e}function pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var ht=function(){function e(){var t=this;gt(this,e),pt(this,"privateState",Object(r["reactive"])({variables:[],isLoadingVars:!1,isLoadingSingle:!1,isUpdating:!1})),pt(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),pt(this,"isLoading",Object(r["computed"])((function(){var e=t.state.value;return e.isLoadingVars||e.isLoadingSingle}))),pt(this,"isUpdating",Object(r["computed"])((function(){return t.state.value.isUpdating}))),pt(this,"variables",Object(r["computed"])((function(){return t.state.value.variables}))),pt(this,"fetchPromise",null),pt(this,"availableVariablesPromises",{})}return bt(e,[{key:"fetchVariablesIfNotLoaded",value:function(e,t){this.fetchPromise||this.fetchVariables(e,t)}},{key:"findVariable",value:function(e,t,n,a){var i=this,o=this.variables.value.find((function(e){return e.idvariable===n}));return o&&!a?Promise.resolve(o):(this.privateState.isLoadingSingle=!0,u["AjaxHelper"].fetch({idVariable:n,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerVariable",filter_limit:"-1"}).then((function(e){return i.privateState.variables=[].concat(ot(i.privateState.variables),[e]),Object(r["readonly"])(e)})).finally((function(){i.privateState.isLoadingSingle=!1})))}},{key:"fetchVariables",value:function(e,t){var n=this;return this.privateState.isLoadingVars=!0,this.privateState.variables=[],this.fetchPromise||(this.fetchPromise=u["AjaxHelper"].fetch({method:"TagManager.getContainerVariables",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return n.privateState.variables=e,n.privateState.isLoadingVars=!1,n.variables.value})).finally((function(){n.privateState.isLoadingVars=!1}))}},{key:"fetchAvailableVariables",value:function(e){return this.availableVariablesPromises[e]||(this.availableVariablesPromises[e]=u["AjaxHelper"].fetch({method:"TagManager.getAvailableVariableTypesInContext",idContext:e,filter_limit:"-1"}).then((function(e){return Object(r["readonly"])(e)}))),Promise.resolve(this.availableVariablesPromises[e])}},{key:"suggestNameForType",value:function(e){for(var t=this,n=function(n){var a=e;n&&(a="".concat(a," (").concat(n,")"));var i=!t.variables.value.some((function(e){return e.name===a}));if(i)return{v:a}},a=0;a<100;a+=1){var i=n(a);if("object"===rt(i))return i.v}}},{key:"createOrUpdateVariable",value:function(e,t,n,a,i){var r=this;this.privateState.isUpdating=!0;var o=Object.entries(i).map((function(e){var t=tt(e,2),n=t[0],a=t[1],i=a;return"boolean"===typeof a&&(i=(+a).toString()),[n,i]})),l=Object.fromEntries(o),c=e.lookup_table.filter((function(e){return e&&e.out_value&&e.comparison}));return u["AjaxHelper"].post({idVariable:e.idvariable,method:t,idContainer:n,idContainerVersion:a,type:e.type,name:e.name,description:e.description,defaultValue:e.default_value},{parameters:l,lookupTable:c},{withTokenInUrl:!0}).finally((function(){r.privateState.isUpdating=!1}))}},{key:"reload",value:function(e,t){return this.privateState.variables=[],this.fetchPromise=null,this.availableVariablesPromises={},this.fetchVariables(e,t)}},{key:"deleteVariable",value:function(e,t,n){var a=this;return this.privateState.isUpdating=!0,this.privateState.variables=[],u["AjaxHelper"].fetch({idVariable:n,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerVariable"},{withTokenInUrl:!0}).finally((function(){a.privateState.isUpdating=!1}))}}]),e}(),ft=new ht;function vt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ot(e,t,n){return t&&jt(e.prototype,t),n&&jt(e,n),e}function Tt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var yt=function(){function e(){var t=this;vt(this,e),Tt(this,"privateState",Object(r["reactive"])({comparisons:[],isLoading:!1})),Tt(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),Tt(this,"isLoading",Object(r["computed"])((function(){return t.state.value.isLoading}))),Tt(this,"comparisons",Object(r["computed"])((function(){return t.state.value.comparisons}))),Tt(this,"comparisonOptions",Object(r["computed"])((function(){return t.comparisons.value.map((function(e){var t=e.id,n=e.name;return{key:t,value:n}}))}))),Tt(this,"initializePromise",null)}return Ot(e,[{key:"init",value:function(){return this.initializePromise||(this.initializePromise=this.fetchAvailableComparisons()),this.initializePromise}},{key:"fetchAvailableComparisons",value:function(){var e=this;return this.privateState.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getAvailableComparisons",filter_limit:"-1"}).then((function(t){e.privateState.comparisons=t})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),Vt=new yt,Ct="tagvariablemanagement",Nt=Object(r["defineComponent"])({props:{idVariable:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},variableType:String,isEmbedded:{type:Boolean,default:!1}},components:{GroupedSettings:g["GroupedSettings"],ContentBlock:u["ContentBlock"],Field:g["Field"],SaveButton:g["SaveButton"]},data:function(){return{isDirty:!1,showAdvanced:!1,chooseVariableType:!1,canUseCustomTemplates:u["Matomo"].hasUserCapability("tagmanager_use_custom_templates"),availableVariables:[],editTitle:"",variable:{},parameterValues:{},isUpdatingVar:!1}},emits:["changeVariable"],created:function(){Vt.init(),ft.fetchVariablesIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdVariable()},watch:{idVariable:function(e){null!==e&&this.initIdVariable()},variableParameterValues:{handler:function(e,t){e&&t&&(this.isDirty=!0)},deep:!0},variableLookupTable:{handler:function(){var e=(this.variable.lookup_table||[]).every((function(e){return!(null===e||void 0===e||!e.out_value)}));e&&this.addLookUpEntry()},deep:!0}},methods:{removeAnyVariableNotification:function(){u["NotificationsStore"].remove(Ct),u["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var n=u["NotificationsStore"].show({message:e,context:t,id:Ct,type:"transient"});setTimeout((function(){u["NotificationsStore"].scrollToNotification(n)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(u["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdVariable:function(){var e=this;u["Matomo"].helper.lazyScrollToContent(),this.availableVariables=[],u["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return ft.fetchAvailableVariables(e.context)})).then((function(t){e.availableVariables=t})).then((function(){if(e.edit&&e.idVariable)return e.editTitle=Object(u["translate"])("TagManager_EditVariable"),void ft.findVariable(e.idContainer,e.idContainerVersion,e.idVariable,e.isEmbedded).then((function(t){var n;t&&(e.variable=Object(u["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),(e.variable.lookup_table&&e.variable.lookup_table.length||e.variable.default_value)&&(e.showAdvanced=!0),e.addLookUpEntryIfNoneExists(),e.isDirty=!1,null!==(n=e.variable.typeMetadata)&&void 0!==n&&n.name&&(e.editTitle+=": ".concat(e.variable.typeMetadata.name)))}));if(e.create){var t=!1;e.variableType&&e.availableVariables.forEach((function(n){if(!t){var a=n.types.find((function(t){return(null===t||void 0===t?void 0:t.id)===e.variableType}));a&&(t=!0,e.createVariableType(a))}})),t||(e.editTitle=Object(u["translate"])("TagManager_ChooseVariableToContinue"),e.chooseVariableType=!0)}}))},addLookUpEntryIfNoneExists:function(){this.variable.lookup_table&&Array.isArray(this.variable.lookup_table)||(this.variable.lookup_table=[]),this.variable.lookup_table.length||this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""})},addLookUpEntry:function(){this.variable.lookup_table.push({comparison:"equals",match_value:"",out_value:""}),this.isDirty=!0},removeLookUpEntry:function(e){e>-1&&(this.variable.lookup_table.splice(e,1),this.isDirty=!0)},createVariableType:function(e){var t,n=this;e&&this.isVariableTemplateDisabled[e.id]||(this.chooseVariableType=!1,this.editTitle=Object(u["translate"])("TagManager_CreateNewVariable"),this.variable={idsite:parseInt("".concat(u["Matomo"].idSite),10),name:ft.suggestNameForType(e.name)||"",description:"",type:e.id,idcontainer:this.idContainer,idcontainerversion:this.idContainerVersion,default_value:"",lookup_table:[],typeMetadata:e},null!==(t=this.variable.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": ".concat(this.variable.typeMetadata.name)),this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.addLookUpEntry(),this.isDirty=!0,Object(r["nextTick"])((function(){if(n.$refs.root){var e=n.$refs.root;e.scrollIntoView();var t=e.querySelector("#name");t&&t.focus()}})))},cancel:function(){var e=Object.assign({},u["MatomoUrl"].hashParsed.value);delete e.idVariable,u["MatomoUrl"].updateHash(e)},createVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,ft.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.addContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t){e.isDirty=!1;var n=t.value;ft.reload(e.idContainer,e.idContainerVersion).then((function(){if(e.isEmbedded)return e.variable.idvariable=n,void e.$emit("changeVariable",{variable:e.variable});e.cancel(),setTimeout((function(){var t=Object(u["translate"])("TagManager_CreatedX",Object(u["translate"])("TagManager_Variable")),n="";e.hasPublishCapability()&&(n=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),e.showNotification("".concat(t," ").concat(n),"success")}),200)}))}})).finally((function(){e.isUpdatingVar=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateVariable:function(){var e=this;this.removeAnyVariableNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVar=!0,ft.createOrUpdateVariable(Object.assign(Object.assign({},this.variable),{},{name:encodeURIComponent(this.variable.name)}),"TagManager.updateContainerVariable",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t)if(e.isEmbedded)e.$emit("changeVariable",{variable:e.variable});else{e.isDirty=!1,ft.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdVariable()})),e.cancel();var n=Object(u["translate"])("TagManager_UpdatedX",Object(u["translate"])("TagManager_Variable")),a="";e.hasPublishCapability()&&(a=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),e.showNotification("".concat(n," ").concat(a),"success")}})).finally((function(){e.isUpdatingVar=!1})))},checkRequiredFieldsAreSet:function(){return!!this.variable.name||(this.showErrorFieldNotProvidedNotification(Object(u["translate"])("General_Name")),!1)},hasPublishCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_write")&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")}},computed:{typeInlineHelp:function(){var e,t,n=(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.description)||"",a=(null===(t=this.variable.typeMetadata)||void 0===t?void 0:t.help)||"";return"".concat(n," ").concat(a)},create:function(){return 0===this.idVariable},edit:function(){return!this.create},isLoading:function(){return ft.isLoading.value||Vt.isLoading.value},isUpdating:function(){return ft.isUpdating.value||this.isUpdatingVar},availableLookUpComparisons:function(){return Vt.comparisonOptions.value},isVariableTemplateDisabled:function(){var e=this,t={};return this.availableVariables.forEach((function(n){n.types.forEach((function(n){t[n.id]=!e.canUseCustomTemplates&&n.isCustomTemplate}))})),t},isVariableDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.variable.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},variableParameterValues:function(){var e;return null!==(e=this.variable.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null},variableLookupTable:function(){return this.variable.lookup_table}}});Nt.render=et;var Et=Nt,St={class:"tagManagerManageList tagManagerVariableList"},wt={class:"variableSearchFilter"},kt=["title"],Mt=["title"],_t=["title"],Dt=["title"],At=["title"],xt=["title"],Bt={colspan:"7"},Lt={class:"loadingPiwik"},Ut=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Pt={colspan:"7"},It=["id"],Ft=["title"],Ht=["title"],Gt=["title"],$t={class:"lookupTable"},Rt={class:"icon-ok"},qt=["title"],zt=["onClick","title"],Wt=["onClick","title"],Xt=["onClick","title"],Kt={class:"tableActionBar"},Jt=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Yt=["title"],Zt=Object(r["createElementVNode"])("span",{class:"icon-help preconfiguredVariablesHelp"},null,-1),Qt={class:"collection-header"},en={class:"title"},tn=["textContent"],nn={class:"secondary-content"},an=["title"],rn={class:"ui-confirm",id:"confirmDeleteVariable",ref:"confirmDeleteVariable"},on=["value"],ln=["value"],cn={class:"ui-confirm",id:"confirmDeleteVariableNotPossible",ref:"confirmDeleteVariableNotPossible"},sn={class:"collection"},dn=["value"];function un(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("ContentBlock"),s=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",St,[Object(r["createVNode"])(c,{feature:"Tag Manager",class:"tagManagerCustomVariablesList","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Variables")),"help-text":e.variablesHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableUsageBenefits")),1),Object(r["createElementVNode"])("div",wt,[Object(r["withDirectives"])(Object(r["createVNode"])(l,{uicontrol:"text",name:"variableSearch",title:e.translate("General_Search"),modelValue:e.variableSearch,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.variableSearch=t})},null,8,["title","modelValue"]),[[r["vShow"],e.variables.length>0]])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,kt),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,Mt),Object(r["createElementVNode"])("th",{class:"type",title:e.typeTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Type")),9,_t),Object(r["createElementVNode"])("th",{class:"lookupTable",title:e.lookupTableTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LookupTable")),9,Dt),Object(r["createElementVNode"])("th",{class:"lastUpdated",title:e.lastUpdatedTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),9,At),Object(r["withDirectives"])(Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,xt),[[r["vShow"],e.hasWriteAccess]])])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Bt,[Object(r["createElementVNode"])("span",Lt,[Ut,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Pt,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoVariablesFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerVariableNow",onClick:t[1]||(t[1]=function(t){return e.createVariable()})},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariableNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&!e.variables.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedVariables,(function(t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"variable".concat(t.idvariable),class:"variables",key:t.idvariable},[Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,Ft),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,Ht),Object(r["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(r["toDisplayString"])(t.typeMetadata.name),9,Gt),Object(r["createElementVNode"])("td",$t,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",Rt,null,512),[[r["vShow"],t.lookup_table.length]])]),Object(r["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.updated_date_pretty),1)],8,qt),Object(r["withDirectives"])(Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(n){return e.editVariable(t.idvariable,t.type)},title:e.translate("TagManager_EditVariable")},null,8,zt),Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(n){return e.deleteVariable(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Variable"))},null,8,Wt),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:function(n){return e.openCopyDialog(t)},title:e.translate("TagManager_CopyX",e.translate("TagManager_Variable"))},null,8,Xt),[[r["vShow"],e.hasPublishCapability()]])],2),[[r["vShow"],e.hasWriteAccess]])],8,It)})),128))])],512),[[s]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Kt,[Object(r["createElementVNode"])("a",{class:"createNewVariable",value:"",onClick:t[2]||(t[2]=function(t){return e.createVariable()})},[Jt,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("h2",{title:e.translate("TagManager_PreConfiguredInfoTitle")},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_PreconfiguredVariables"))+" ",1),Zt],8,Yt),Object(r["createElementVNode"])("div",null,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.containerVariables,(function(e,t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:t},[Object(r["createElementVNode"])("li",Qt,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(e.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.types,(function(e){return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:e.id},[Object(r["createElementVNode"])("span",en,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.name)+" ",1),Object(r["createElementVNode"])("span",{class:"variableId",textContent:Object(r["toDisplayString"])("{{".concat(e.id,"}}"))},null,8,tn)]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",nn,[Object(r["createElementVNode"])("i",{class:"icon-help",title:e.description},null,8,an)],512),[[r["vShow"],!!e.description]])],512)),[[r["vShow"],e.is_pre_configured]])})),128))])})),128))]),Object(r["createElementVNode"])("div",rn,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteVariableConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,on),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,ln)],512),Object(r["createElementVNode"])("div",cn,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableCannotBeDeleted")),1),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableBeingUsedBy")),1),Object(r["createElementVNode"])("ul",sn,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.variableReferences,(function(e){return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:"".concat(e.referenceType,".").concat(e.referenceId)},Object(r["toDisplayString"])(e.referenceTypeName)+": "+Object(r["toDisplayString"])(e.referenceName),1)})),128))]),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VariableBeingUsedNeedsRemove")),1),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,dn)],512)])}function gn(e){return hn(e)||pn(e)||bn(e)||mn()}function mn(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function bn(e,t){if(e){if("string"===typeof e)return fn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fn(e,t):void 0}}function pn(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function hn(e){if(Array.isArray(e))return fn(e)}function fn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var vn=window,jn=vn.tagManagerHelper,On=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},variablesHelpText:String},components:{Field:g["Field"],ContentBlock:u["ContentBlock"]},directives:{ContentTable:u["ContentTable"]},data:function(){return{hasWriteAccess:u["Matomo"].hasUserCapability("tagmanager_write"),variableReferences:[],containerVariables:[],variableSearch:""}},created:function(){var e=this;ft.fetchVariables(this.idContainer,this.idContainerVersion),u["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then((function(t){e.containerVariables=t}))},methods:{createVariable:function(){this.editVariable(0)},editVariable:function(e){u["MatomoUrl"].updateHash(Object.assign(Object.assign({},u["MatomoUrl"].hashParsed.value),{},{idVariable:e}))},deleteVariable:function(e){var t=this;u["AjaxHelper"].fetch({method:"TagManager.getContainerVariableReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idVariable:e.idvariable}).then((function(n){n&&n.length?(t.variableReferences=n,u["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariableNotPossible,{})):(t.variableReferences=[],u["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteVariable,{yes:function(){ft.deleteVariable(t.idContainer,t.idContainerVersion,e.idvariable).then((function(){ft.reload(t.idContainer,t.idContainerVersion),u["NotificationsStore"].remove("CopyDialogResultNotification")}))}}))}))},truncateText:function(e,t){return jn.truncateText(e,t)},hasPublishCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_write")&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},openCopyDialog:function(e){var t=u["MatomoUrl"].stringify({module:"TagManager",action:"copyVariableDialog",idSite:e.idsite,idContainer:this.idContainer,idVariable:e.idvariable,idContainerVersion:this.idContainerVersion});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyVariable")}},computed:{isLoading:function(){return ft.isLoading.value},isUpdating:function(){return ft.isUpdating.value},variables:function(){return ft.variables.value},sortedVariables:function(){var e=this.variableSearch.toLowerCase(),t=gn(this.variables).filter((function(t){return Object.keys(t).some((function(n){var a=t,i="";if("string"===typeof a[n])i=a[n];else if("typeMetadata"===n){var r=a.typeMetadata;i=r.name}else if("parameters"===n&&"CustomJsFunction"===a.type){var o=a.parameters;i=o.jsFunction}return-1!==i.toLowerCase().indexOf(e)}))}));return t.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),t},nameTranslatedText:function(){return this.translate("TagManager_VariablesNameDescription")},descriptionTranslatedText:function(){return this.translate("TagManager_VariablesDescriptionDescription")},typeTranslatedText:function(){return this.translate("TagManager_VariablesTypeDescription")},lookupTableTranslatedText:function(){return this.translate("TagManager_VariablesLookupTableDescription")},lastUpdatedTranslatedText:function(){return this.translate("TagManager_VariablesLastUpdatedDescription")},actionTranslatedText:function(){return this.translate("TagManager_VariablesActionDescription")},getActionClasses:function(){var e=this.hasPublishCapability()?" hasCopyAction":"";return"action".concat(e)}}});On.render=un;var Tn=On,yn={class:"manageVariable"},Vn={key:0},Cn={key:1};function Nn(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("VariableList"),c=Object(r["resolveComponent"])("VariableEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",yn,[e.editMode?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Vn,[Object(r["createVNode"])(l,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer,"variables-help-text":e.variablesHelpText},null,8,["id-container-version","id-container","variables-help-text"])])),e.editMode?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Cn,[Object(r["createVNode"])(c,{"id-container-version":e.idContainerVersion,"id-container":e.idContainer,"id-variable":e.idVariable},null,8,["id-container-version","id-container","id-variable"])])):Object(r["createCommentVNode"])("",!0)])}var En=Object(r["defineComponent"])({props:{idContainerVersion:Number,idContainer:String,variablesHelpText:String},components:{VariableList:Tn,VariableEdit:Et},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(r["watch"])((function(){return u["MatomoUrl"].hashParsed.value.idVariable}),(function(t){e.onIdVariableParamChange(t)})),u["NotificationsStore"].remove("variablevariablemanagement"),this.onIdVariableParamChange(u["MatomoUrl"].hashParsed.value.idVariable)},methods:{onIdVariableParamChange:function(e){if("0"===e){var t={isAllowed:!0};u["Matomo"].postEvent("TagManager.initAddVariable",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idVariable:function(){var e=u["MatomoUrl"].hashParsed.value.idVariable;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idVariable}}});En.render=Nn;var Sn=En;function wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var kn={class:"editTrigger tagManagerManageEdit",ref:"root"},Mn={class:"loadingPiwik"},_n=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Dn={class:"loadingPiwik"},An=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),xn={class:"form-group row"},Bn={class:"col s12"},Ln={key:0},Un={class:"form-group row"},Pn={class:"col s12"},In={class:"form-group row multiple"},Fn={class:"col s12 input-field m6"},Hn={class:"col s12 input-field m6"},Gn={class:"form-help"},$n=["innerHTML"],Rn={class:"col s12 m12"},qn={class:"innerFormField"},zn={class:"innerFormField comparisonField"},Wn={class:"innerFormField"},Xn=["onClick","title"],Kn={class:"triggerConditionNode"},Jn={class:"entityCancel"},Yn={id:"confirmSelectTriggerType"},Zn={class:"collection-header"},Qn=["onClick","title"],ea=["src"],ta={class:"title"},na={class:"secondary-content"},aa=["title"],ia={class:"entityCancel"};function ra(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("GroupedSettings"),s=Object(r["resolveComponent"])("SaveButton"),d=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",kn,[Object(r["createVNode"])(d,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])((function(){var n,a,i,o,d;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Mn,[_n,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Dn,[An,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("form",{onSubmit:t[5]||(t[5]=function(t){return e.edit?e.updateTrigger():e.createTrigger()})},[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-warning"},Object(r["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[r["vShow"],e.isTriggerDisabled]]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.trigger.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.trigger.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_TriggerNameHelp"),placeholder:e.translate("TagManager_TriggerNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.trigger.description,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.trigger.description=t,e.setValueHasChanged()}),maxlength:1e3,title:e.translate("TagManager_Description"),"inline-help":e.translate("TagManager_TriggerDescriptionHelp"),placeholder:e.translate("TagManager_TriggerDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",xn,[Object(r["createElementVNode"])("div",Bn,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureThisTrigger")),1)])],512),[[r["vShow"],null===(n=e.trigger.typeMetadata)||void 0===n||null===(a=n.parameters)||void 0===a?void 0:a.length]]),e.trigger?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ln,[Object(r["createVNode"])(c,{settings:(null===(i=e.trigger.typeMetadata)||void 0===i?void 0:i.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[2]||(t[2]=function(t){return e.parameterValues[t.name]=t.value})},null,8,["settings","all-setting-values"])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Un,[Object(r["createElementVNode"])("div",Pn,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_OnlyTriggerWhen"))+" "+Object(r["toDisplayString"])(e.translate("Goals_Optional")),1)])],512),[[r["vShow"],null===(o=e.trigger.typeMetadata)||void 0===o?void 0:o.hasAdvancedSettings]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",In,[Object(r["createElementVNode"])("div",Fn,[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerConditionsHelp")),1)]),Object(r["createElementVNode"])("div",Hn,[Object(r["createElementVNode"])("div",Gn,[Object(r["createElementVNode"])("span",{class:"inline-help",innerHTML:e.$sanitize(e.triggerInlineHelpText)},null,8,$n)])]),Object(r["createElementVNode"])("div",Rn,[Object(r["createElementVNode"])("div",null,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.trigger.conditions,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:n,class:Object(r["normalizeClass"])(["condition multiple valign-wrapper","condition".concat(n)])},[Object(r["createElementVNode"])("div",qn,[Object(r["createVNode"])(l,{uicontrol:"expandable-select",name:"condition_actual","model-value":t.actual,"onUpdate:modelValue":function(n){t.actual=n,e.setValueHasChanged()},"full-width":!0,options:e.availableVariables,title:e.variableIdToName[t.actual]||t.actual},null,8,["model-value","onUpdate:modelValue","options","title"])]),Object(r["createElementVNode"])("div",zn,[Object(r["createVNode"])(l,{uicontrol:"select",name:"condition_comparison","model-value":t.comparison,"onUpdate:modelValue":function(n){t.comparison=n,e.setValueHasChanged()},"full-width":!0,options:e.availableComparisons},null,8,["model-value","onUpdate:modelValue","options"])]),Object(r["createElementVNode"])("div",Wn,[Object(r["createVNode"])(l,{uicontrol:"text",name:"condition_expected","model-value":t.expected,"onUpdate:modelValue":function(n){t.expected=n,e.setValueHasChanged(),e.onConditionChange()},"full-width":!0},null,8,["model-value","onUpdate:modelValue"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"icon-minus valign",onClick:function(t){return e.removeConditionEntry(n)},title:e.translate("General_Remove")},null,8,Xn),[[r["vShow"],!(n+1===e.trigger.conditions.length)]])],2)})),128))]),Object(r["createElementVNode"])("p",Kn,Object(r["toDisplayString"])(e.translate("TagManager_TriggerConditionNode")),1)])])],512),[[r["vShow"],null===(d=e.trigger.typeMetadata)||void 0===d?void 0:d.hasAdvancedSettings]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-warning"},Object(r["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[r["vShow"],e.isTriggerDisabled]]),Object(r["withDirectives"])(Object(r["createVNode"])(s,{class:"createButton",onConfirm:t[3]||(t[3]=function(t){return e.edit?e.updateTrigger():e.createTrigger()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.saveButtonText},null,8,["disabled","saving","value"]),[[r["vShow"],!e.isTriggerDisabled]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Jn,[Object(r["createElementVNode"])("a",{onClick:t[4]||(t[4]=function(t){return e.cancel()})},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])])],544),[[r["vShow"],!e.chooseTriggerType&&e.editTitle]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Yn,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.availableTriggers,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:n},[Object(r["createElementVNode"])("li",Zn,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:Object(r["normalizeClass"])(["collection-item avatar",wn({disabledTemplate:e.isTriggerTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(n){return e.createTriggerType(t)},key:n,title:e.isTriggerTemplateDisabled[t.id]?e.collectionItemAvatarText:""},[t.icon?(Object(r["openBlock"])(),Object(r["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,ea)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("span",ta,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(t.description),513),[[r["vShow"],t.description]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",na,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,aa)],512),[[r["vShow"],!!t.help]])],10,Qn)})),128))])})),128)),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ia,[Object(r["createElementVNode"])("a",{onClick:t[6]||(t[6]=function(t){return e.cancel()})},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])],512),[[r["vShow"],e.chooseTriggerType]])]})),_:1},8,["content-title"])],512)}function oa(e,t){return sa(e)||ca(e,t)||ma(e,t)||la()}function la(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ca(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(r.push(a.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(l)throw i}}return r}}function sa(e){if(Array.isArray(e))return e}function da(e){return da="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},da(e)}function ua(e){return pa(e)||ba(e)||ma(e)||ga()}function ga(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ma(e,t){if(e){if("string"===typeof e)return ha(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ha(e,t):void 0}}function ba(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function pa(e){if(Array.isArray(e))return ha(e)}function ha(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function fa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function va(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ja(e,t,n){return t&&va(e.prototype,t),n&&va(e,n),e}function Oa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Ta=function(){function e(){var t=this;fa(this,e),Oa(this,"privateState",Object(r["reactive"])({triggers:[],isLoadingTriggers:!1,isLoadingSingle:!1,isUpdating:!1})),Oa(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),Oa(this,"isUpdating",Object(r["computed"])((function(){return t.state.value.isUpdating}))),Oa(this,"isLoading",Object(r["computed"])((function(){var e=t.state.value;return e.isLoadingTriggers||e.isLoadingSingle}))),Oa(this,"triggers",Object(r["computed"])((function(){return t.state.value.triggers}))),Oa(this,"fetchPromise",null),Oa(this,"availableTriggersPromises",{})}return ja(e,[{key:"fetchTriggers",value:function(e,t){var n=this;return this.privateState.triggers=[],this.privateState.isLoadingTriggers=!0,this.fetchPromise||(this.fetchPromise=u["AjaxHelper"].fetch({method:"TagManager.getContainerTriggers",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return n.privateState.triggers=e,n.triggers.value})).finally((function(){n.privateState.isLoadingTriggers=!1}))}},{key:"fetchTriggersIfNotLoaded",value:function(e,t){this.fetchPromise||this.fetchTriggers(e,t)}},{key:"fetchAvailableTriggers",value:function(e){return this.availableTriggersPromises[e]||(this.availableTriggersPromises[e]=u["AjaxHelper"].fetch({method:"TagManager.getAvailableTriggerTypesInContext",idContext:e,filter_limit:"-1"})),Promise.resolve(this.availableTriggersPromises[e])}},{key:"findTrigger",value:function(e,t,n){var a=this,i=this.triggers.value.find((function(e){return e.idtrigger===n}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,u["AjaxHelper"].fetch({idTrigger:n,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerTrigger",filter_limit:"-1"}).then((function(e){return a.privateState.triggers=[].concat(ua(a.privateState.triggers),[e]),Object(r["readonly"])(e)})).finally((function(){a.privateState.isLoadingSingle=!1})))}},{key:"suggestNameForType",value:function(e){for(var t=this,n=function(n){var a=e;n&&(a="".concat(a," (").concat(n,")"));var i=!t.triggers.value.some((function(e){return e.name===a}));if(i)return{v:a}},a=0;a<100;a+=1){var i=n(a);if("object"===da(i))return i.v}}},{key:"createOrUpdateTrigger",value:function(e,t,n,a,i){var r=this,o=Object.entries(i).map((function(e){var t=oa(e,2),n=t[0],a=t[1],i=a;return"boolean"===typeof a&&(i=(+a).toString()),[n,i]})),l=Object.fromEntries(o),c=e.conditions.filter((function(e){return e&&e.actual&&e.comparison&&e.expected}));return this.privateState.isUpdating=!0,u["AjaxHelper"].post({idTrigger:e.idtrigger,method:t,idContainer:n,idContainerVersion:a,type:e.type,name:e.name,description:e.description},{parameters:l,conditions:c},{withTokenInUrl:!0}).finally((function(){r.privateState.isUpdating=!1}))}},{key:"reload",value:function(e,t){return this.privateState.triggers=[],this.fetchPromise=null,this.availableTriggersPromises={},this.fetchTriggers(e,t)}},{key:"deleteTrigger",value:function(e,t,n){var a=this;return this.privateState.isUpdating=!0,this.privateState.triggers=[],u["AjaxHelper"].fetch({idTrigger:n,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerTrigger"},{withTokenInUrl:!0}).finally((function(){a.privateState.isUpdating=!1}))}}]),e}(),ya=new Ta,Va="tagvariablemanagement",Ca={AllElementsClick:"ClickId",AllLinksClick:"ClickId",DownloadClick:"ClickId",ElementVisibility:"VisibleElementClasses",FormSubmit:"FormId",JavaScriptError:"ErrorMessage"},Na=Object(r["defineComponent"])({props:{idTrigger:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},newTriggerType:String,isEmbedded:{type:Boolean,default:!1}},components:{ContentBlock:u["ContentBlock"],Field:g["Field"],GroupedSettings:g["GroupedSettings"],SaveButton:g["SaveButton"]},data:function(){return{isDirty:!1,chooseTriggerType:!1,availableTriggers:[],availableVariables:[],variableIdToName:{},editTitle:"",trigger:{},parameterValues:{},isUpdatingTrigger:!1}},emits:["changeTrigger"],created:function(){var e=this;Vt.init(),u["AjaxHelper"].fetch({method:"TagManager.getAvailableContainerVariables",filter_limit:"-1",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion}).then((function(t){t.forEach((function(t){t.types.forEach((function(n){e.variableIdToName[n.id]=n.name,e.availableVariables.push({key:n.id,value:n.name,group:t.name,tooltip:n.description})}))}))})),ya.fetchTriggersIfNotLoaded(this.idContainer,this.idContainerVersion),this.initIdTrigger()},watch:{idTrigger:function(e){null!==e&&this.initIdTrigger()},triggerParameterValues:{handler:function(e,t){e&&t&&(this.isDirty=!0)},deep:!0}},methods:{checkRequiredFieldsAreSet:function(){return!!this.trigger.name||(this.showErrorFieldNotProvidedNotification(Object(u["translate"])("General_Name")),!1)},removeAnyTriggerNotification:function(){u["NotificationsStore"].remove(Va),u["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var n=u["NotificationsStore"].show({message:e,context:t,id:Va,type:"transient"});setTimeout((function(){u["NotificationsStore"].scrollToNotification(n)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(u["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdTrigger:function(){var e=this;this.trigger={},this.chooseTriggerType=!1,this.editTitle="",u["Matomo"].helper.lazyScrollToContent(),this.availableTriggers=[],u["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return ya.fetchAvailableTriggers(e.context)})).then((function(t){e.availableTriggers=t})).then((function(){if(e.edit&&e.idTrigger)return e.editTitle=Object(u["translate"])("TagManager_EditTrigger"),void ya.findTrigger(e.idContainer,e.idContainerVersion,e.idTrigger).then((function(t){var n;t&&(e.trigger=Object(u["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),e.addConditionEntryIfNoneExists(),e.onConditionChange(),e.isDirty=!1,null!==(n=e.trigger.typeMetadata)&&void 0!==n&&n.name&&(e.editTitle+=": ".concat(e.trigger.typeMetadata.name)))}));e.create&&(e.editTitle=Object(u["translate"])("TagManager_ChooseTriggerToContinue"),e.chooseTriggerType=!0)}))},onConditionChange:function(){var e=(this.trigger.conditions||[]).every((function(e){return!(null===e||void 0===e||!e.expected)}));e&&this.addConditionEntry()},addConditionEntryIfNoneExists:function(){this.trigger.conditions&&Array.isArray(this.trigger.conditions)||(this.trigger.conditions=[]),this.trigger.conditions.length||this.trigger.conditions.push(this.makeDefaultCondition())},addConditionEntry:function(){this.trigger.conditions.push(this.makeDefaultCondition()),this.isDirty=!0},removeConditionEntry:function(e){if(e>-1){var t=this.trigger.conditions.length-1;t===e?this.trigger.conditions[e]=this.makeDefaultCondition():this.trigger.conditions.splice(e,1),this.isDirty=!0}},createTriggerType:function(e){var t,n=this;e&&this.isTriggerTemplateDisabled[e.id]||(this.chooseTriggerType=!1,this.editTitle=Object(u["translate"])("TagManager_CreateNewTrigger"),this.trigger={idsite:parseInt("".concat(u["Matomo"].idSite),10),name:ya.suggestNameForType(e.name)||"",description:"",type:e.id,idcontainerversion:this.idContainerVersion,conditions:[],typeMetadata:e},null!==(t=this.trigger.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": ".concat(this.trigger.typeMetadata.name)),this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.addConditionEntry(),this.isDirty=!0,Object(r["nextTick"])((function(){if(n.$refs.root){var e=n.$refs.root;e.scrollIntoView();var t=e.querySelector("#name");t&&t.focus()}})))},cancel:function(){var e=Object.assign({},u["MatomoUrl"].hashParsed.value);delete e.idTrigger,u["MatomoUrl"].updateHash(e)},createTrigger:function(){var e=this;this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,ya.createOrUpdateTrigger(this.trigger,"TagManager.addContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){var n=t.value;e.isDirty=!1,ya.reload(e.idContainer,e.idContainerVersion).then((function(){if(e.isEmbedded)return e.trigger.idtrigger=n,void e.$emit("changeTrigger",{trigger:e.trigger});e.cancel(),setTimeout((function(){var t=Object(u["translate"])("TagManager_CreatedX",Object(u["translate"])("TagManager_Trigger")),n="";e.hasPublishCapability()&&(n=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),e.showNotification("".concat(t," ").concat(n),"success")}),200)}))})).finally((function(){e.isUpdatingTrigger=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateTrigger:function(){var e=this;this.removeAnyTriggerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTrigger=!0,ya.createOrUpdateTrigger(this.trigger,"TagManager.updateContainerTrigger",this.idContainer,this.idContainerVersion,this.parameterValues).then((function(t){if(t){if(e.isEmbedded)return e.$emit("changeTrigger",{trigger:e.trigger}),void ya.reload(e.idContainer,e.idContainerVersion);e.isDirty=!1,ya.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdTrigger()})),e.cancel();var n=Object(u["translate"])("TagManager_UpdatedX",Object(u["translate"])("TagManager_Trigger")),a="";e.hasPublishCapability()&&(a=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),e.showNotification("".concat(n," ").concat(a),"success")}})).finally((function(){e.isUpdatingTrigger=!1})))},makeDefaultCondition:function(){var e,t="PageUrl";if(null!==(e=this.trigger)&&void 0!==e&&e.typeMetadata){var n=this.trigger.typeMetadata.id;Ca[n]&&(t=Ca[n])}return{comparison:"equals",actual:t,expected:""}},hasPublishCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_write")&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")}},computed:{isLoading:function(){return ya.isLoading.value||Vt.isLoading.value},isUpdating:function(){return ya.isUpdating.value||this.isUpdatingTrigger},create:function(){return 0===this.idTrigger},edit:function(){return!this.create},canUseCustomTemplates:function(){return u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTriggerDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.trigger.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},saveButtonText:function(){return this.edit?Object(u["translate"])("CoreUpdater_UpdateTitle"):Object(u["translate"])("TagManager_CreateNewTrigger")},collectionItemAvatarText:function(){return Object(u["translate"])("TagManager_UseCustomTemplateCapabilityRequired",Object(u["translate"])("TagManager_CapabilityUseCustomTemplates"))},triggerInlineHelpText:function(){return Object(u["translate"])("TagManager_TriggerConditionsHelpText",Object(u["externalLink"])("https://matomo.org/faq/tag-manager/create-a-trigger-to-track-interactions-on-all-nested-elements/"),"</a>")},availableComparisons:function(){return Vt.comparisonOptions.value},isTriggerTemplateDisabled:function(){var e=this,t={};return this.availableTriggers.forEach((function(n){n.types.forEach((function(n){t[n.id]=!e.canUseCustomTemplates&&n.isCustomTemplate}))})),t},triggerParameterValues:function(){var e;return null!==(e=this.trigger.typeMetadata)&&void 0!==e&&e.parameters?this.parameterValues:null}}});Na.render=ra;var Ea=Na,Sa={class:"tagManagerManageList tagManagerTriggerList"},wa={class:"triggerSearchFilter"},ka=["title"],Ma=["title"],_a=["title"],Da=["title"],Aa=["title"],xa=["title"],Ba={colspan:"7"},La={class:"loadingPiwik"},Ua=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Pa={colspan:"7"},Ia=["id"],Fa=["title"],Ha=["title"],Ga=["title"],$a={class:"conditions"},Ra={class:"icon-ok"},qa=["title"],za=["onClick","title"],Wa=["onClick","title"],Xa=["onClick","title"],Ka={class:"tableActionBar"},Ja=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Ya={class:"ui-confirm",id:"confirmDeleteTrigger",ref:"confirmDeleteTrigger"},Za=["value"],Qa=["value"],ei={class:"ui-confirm",id:"confirmDeleteTriggerNotPossible",ref:"confirmDeleteTriggerNotPossible"},ti={class:"collection"},ni=["value"];function ai(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("ContentBlock"),s=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Sa,[Object(r["createVNode"])(c,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Triggers")),"help-text":e.triggersHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerUsageBenefits")),1),Object(r["createElementVNode"])("div",wa,[Object(r["withDirectives"])(Object(r["createVNode"])(l,{uicontrol:"text",name:"triggerSearch",title:e.translate("General_Search"),modelValue:e.triggerSearch,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.triggerSearch=t})},null,8,["title","modelValue"]),[[r["vShow"],e.triggers.length>0]])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,ka),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,Ma),Object(r["createElementVNode"])("th",{class:"type",title:e.typeTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Type")),9,_a),Object(r["createElementVNode"])("th",{class:"conditions",title:e.filterTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Filter")),9,Da),Object(r["createElementVNode"])("th",{class:"lastUpdated",title:e.lastUpdatedTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),9,Aa),Object(r["withDirectives"])(Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,xa),[[r["vShow"],e.hasWriteAccess]])])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Ba,[Object(r["createElementVNode"])("span",La,[Ua,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Pa,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoTriggersFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerTriggerNow",onClick:t[1]||(t[1]=function(t){return e.createTrigger()})},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&0===e.triggers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedTriggers,(function(t){var n;return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"trigger".concat(t.idtrigger),class:"triggers",key:t.idtrigger},[Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,Fa),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,Ha),Object(r["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(r["toDisplayString"])(t.typeMetadata.name),9,Ga),Object(r["createElementVNode"])("td",$a,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",Ra,null,512),[[r["vShow"],null===(n=t.conditions)||void 0===n?void 0:n.length]])]),Object(r["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.updated_date_pretty),1)],8,qa),Object(r["withDirectives"])(Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(n){return e.editTrigger(t.idtrigger,t.type)},title:e.translate("TagManager_EditTrigger")},null,8,za),Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(n){return e.deleteTrigger(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Trigger"))},null,8,Wa),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:function(n){return e.openCopyDialog(t)},title:e.translate("TagManager_CopyX",e.translate("TagManager_Trigger"))},null,8,Xa),[[r["vShow"],e.hasPublishCapability()]])],2),[[r["vShow"],e.hasWriteAccess]])],8,Ia)})),128))])],512),[[s]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Ka,[Object(r["createElementVNode"])("a",{class:"createNewTrigger",value:"",onClick:t[2]||(t[2]=function(t){return e.createTrigger()})},[Ja,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTrigger")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("div",Ya,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteTriggerConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Za),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Qa)],512),Object(r["createElementVNode"])("div",ei,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerCannotBeDeleted")),1),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedBy")),1),Object(r["createElementVNode"])("ul",ti,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.triggerReferences,(function(e){return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:"collection-item",key:e.referenceId},Object(r["toDisplayString"])(e.referenceTypeName)+": "+Object(r["toDisplayString"])(e.referenceName),1)})),128))]),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TriggerBeingUsedNeedsRemove")),1),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,ni)],512)])}function ii(e){return ci(e)||li(e)||oi(e)||ri()}function ri(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function oi(e,t){if(e){if("string"===typeof e)return si(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?si(e,t):void 0}}function li(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ci(e){if(Array.isArray(e))return si(e)}function si(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var di=window,ui=di.tagManagerHelper,gi=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},triggersHelpText:String},components:{Field:g["Field"],ContentBlock:u["ContentBlock"]},directives:{ContentTable:u["ContentTable"]},data:function(){return{hasWriteAccess:u["Matomo"].hasUserCapability("tagmanager_write"),triggerReferences:[],triggerSearch:""}},created:function(){ya.fetchTriggers(this.idContainer,this.idContainerVersion)},methods:{createTrigger:function(){this.editTrigger(0)},editTrigger:function(e){u["MatomoUrl"].updateHash(Object.assign(Object.assign({},u["MatomoUrl"].hashParsed.value),{},{idTrigger:e}))},deleteTrigger:function(e){var t=this;u["AjaxHelper"].fetch({method:"TagManager.getContainerTriggerReferences",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,idTrigger:e.idtrigger}).then((function(n){if(n&&n.length)t.triggerReferences=n,u["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteTriggerNotPossible,{});else{t.triggerReferences=[];var a=function(){ya.deleteTrigger(t.idContainer,t.idContainerVersion,e.idtrigger).then((function(){ya.reload(t.idContainer,t.idContainerVersion),u["NotificationsStore"].remove("CopyDialogResultNotification")}))};u["Matomo"].helper.modalConfirm(t.$refs.confirmDeleteTrigger,{yes:a})}}))},truncateText:function(e,t){return ui.truncateText(e,t)},hasPublishCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_write")&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},openCopyDialog:function(e){var t=u["MatomoUrl"].stringify({module:"TagManager",action:"copyTriggerDialog",idSite:e.idsite,idContainer:this.idContainer,idTrigger:e.idtrigger,idContainerVersion:this.idContainerVersion});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyTrigger")}},computed:{isLoading:function(){return ya.isLoading.value},isUpdating:function(){return ya.isUpdating.value},triggers:function(){return ya.triggers.value},sortedTriggers:function(){var e=this.triggerSearch.toLowerCase(),t=ii(this.triggers).filter((function(t){return Object.keys(t).some((function(n){var a=t,i="";if("string"===typeof a[n])i=a[n];else if("typeMetadata"===n){var r=a.typeMetadata;i=r.name}else if("parameters"===n&&"CustomEvent"===a.type){var o=a.parameters;i=o.eventName}return-1!==i.toLowerCase().indexOf(e)}))}));return t.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),t},nameTranslatedText:function(){return this.translate("TagManager_TriggersNameDescription")},descriptionTranslatedText:function(){return this.translate("TagManager_TriggersDescriptionDescription")},typeTranslatedText:function(){return this.translate("TagManager_TriggersTypeDescription")},filterTranslatedText:function(){return this.translate("TagManager_TriggersFilterDescription")},lastUpdatedTranslatedText:function(){return this.translate("TagManager_TriggersLastUpdatedDescription")},actionTranslatedText:function(){return this.translate("TagManager_TriggersActionDescription")},getActionClasses:function(){var e=this.hasPublishCapability()?" hasCopyAction":"";return"action".concat(e)}}});gi.render=ai;var mi=gi,bi={class:"manageTrigger"};function pi(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("TriggerList"),c=Object(r["resolveComponent"])("TriggerEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",bi,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"triggers-help-text":e.triggersHelpText},null,8,["id-container","id-container-version","triggers-help-text"])])],512),[[r["vShow"],!e.editMode]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(c,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"id-trigger":e.idTrigger},null,8,["id-container","id-container-version","id-trigger"])])],512),[[r["vShow"],e.editMode]])])}var hi=Object(r["defineComponent"])({props:{idContainerVersion:Number,idContainer:String,triggersHelpText:String},components:{TriggerList:mi,TriggerEdit:Ea},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(r["watch"])((function(){return u["MatomoUrl"].hashParsed.value.idTrigger}),(function(t){e.onIdTriggerParamChange(t)})),u["NotificationsStore"].remove("triggertriggermanagement"),this.onIdTriggerParamChange(u["MatomoUrl"].hashParsed.value.idTrigger)},methods:{onIdTriggerParamChange:function(e){if("0"===e){var t={isAllowed:!0};u["Matomo"].postEvent("TagManager.initAddTrigger",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idTrigger:function(){var e=u["MatomoUrl"].hashParsed.value.idTrigger;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idTrigger}}});hi.render=pi;var fi=hi;function vi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ji={class:"editTag tagManagerManageEdit",ref:"root"},Oi={class:"loadingPiwik"},Ti=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),yi={class:"loadingPiwik"},Vi=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Ci={class:"form-group row"},Ni={class:"col s12"},Ei={key:0},Si={class:"form-group row"},wi={class:"col s12"},ki={class:"form-group row"},Mi={class:"col s12"},_i={class:"form-group row tagStartDate"},Di={class:"col s12 m6"},Ai={class:"row"},xi={class:"col s12"},Bi={for:"start_date_date",class:"active"},Li={class:"tagStartDate"},Ui={class:"col s12 m6 "},Pi={class:"form-help"},Ii={class:"inline-help"},Fi=["innerHTML"],Hi=Object(r["createElementVNode"])("br",null,null,-1),Gi=["innerHTML"],$i={class:"form-group row tagEndDate"},Ri={class:"col s12 m6"},qi={class:"row"},zi={class:"col s12"},Wi={for:"end_date_date",class:"active"},Xi={class:"tagEndDate"},Ki={class:"col s12 m6"},Ji={class:"form-help"},Yi={class:"inline-help"},Zi=["innerHTML"],Qi=Object(r["createElementVNode"])("br",null,null,-1),er=["innerHTML"],tr={class:"entityCancel"},nr={id:"confirmSelectTagType"},ar={class:"collection-header"},ir=["onClick","title"],rr=["src"],or={class:"title"},lr={class:"secondary-content"},cr=["title"],sr={class:"entityCancel"};function dr(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("GroupedSettings"),s=Object(r["resolveComponent"])("TagTriggerArray"),d=Object(r["resolveComponent"])("TagDateInput"),u=Object(r["resolveComponent"])("SaveButton"),g=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ji,[Object(r["createVNode"])(g,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])((function(){var n,a,i,o,g;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Oi,[Ti,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",yi,[Vi,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("form",{onSubmit:t[18]||(t[18]=function(t){return e.edit?e.updateTag():e.createTag()})},[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-warning"},Object(r["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[r["vShow"],e.isTagDisabled]]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.tag.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.tag.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_TagNameHelpV2"),placeholder:e.translate("TagManager_TagNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.tag.description,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.tag.description=t,e.setValueHasChanged()}),maxlength:1e3,title:e.translate("TagManager_Description"),placeholder:e.translate("TagManager_TagDescriptionPlaceholder")},null,8,["model-value","title","placeholder"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Ci,[Object(r["createElementVNode"])("div",Ni,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureWhatTagDoes")),1)])],512),[[r["vShow"],null===(n=e.tag.typeMetadata)||void 0===n?void 0:n.parameters.length]]),e.tag?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ei,[Object(r["createVNode"])(c,{settings:(null===(a=e.tag.typeMetadata)||void 0===a?void 0:a.parameters)||[],"all-setting-values":e.parameterValues,onChange:t[2]||(t[2]=function(t){e.parameterValues[t.name]=t.value,e.setValueHasChanged()})},null,8,["settings","all-setting-values"])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Si,[Object(r["createElementVNode"])("div",wi,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ConfigureWhenTagDoes")),1)])],512),[[r["vShow"],null===(i=e.tag.typeMetadata)||void 0===i?void 0:i.parameters.length]]),Object(r["createVNode"])(s,{"container-triggers":e.containerTriggers,type:"fire",title:e.translate("TagManager_FireTriggerTitle"),help:e.translate("TagManager_FireTriggerHelp",e.translate("TagManager_FireLimit")),"model-value":e.fireTriggers,"onUpdate:modelValue":t[3]||(t[3]=function(t){e.fireTriggers=t,e.setValueHasChanged(),e.onFireTriggerChange()}),onCreate:t[4]||(t[4]=function(t){return e.onCreateNewFireTrigger()}),onEdit:t[5]||(t[5]=function(t){return e.editTrigger(t)})},null,8,["container-triggers","title","help","model-value"]),Object(r["createVNode"])(s,{"container-triggers":e.containerTriggers,type:"block",title:e.translate("TagManager_BlockTriggerTitle"),help:e.translate("TagManager_BlockTriggerHelp"),"model-value":e.blockTriggers,"onUpdate:modelValue":t[6]||(t[6]=function(t){e.blockTriggers=t,e.setValueHasChanged(),e.onBlockTriggerChange()}),onCreate:t[7]||(t[7]=function(t){return e.onCreateNewBlockTrigger()}),onEdit:t[8]||(t[8]=function(t){return e.editTrigger(t)})},null,8,["container-triggers","title","help","model-value"]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ki,[Object(r["createElementVNode"])("div",Mi,[Object(r["createElementVNode"])("h3",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{href:"",class:"showAdvancedSettings",onClick:t[9]||(t[9]=Object(r["withModifiers"])((function(t){return e.showAdvanced=!0}),["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_ShowAdvancedSettings")),513),[[r["vShow"],!e.showAdvanced]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{href:"",class:"hideAdvancedSettings",onClick:t[10]||(t[10]=Object(r["withModifiers"])((function(t){return e.showAdvanced=!1}),["prevent"]))},Object(r["toDisplayString"])(e.translate("TagManager_HideAdvancedSettings")),513),[[r["vShow"],e.showAdvanced]])])])],512),[[r["vShow"],null===(o=e.tag.typeMetadata)||void 0===o?void 0:o.hasAdvancedSettings]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"radio",name:"fire_limit","model-value":e.tag.fire_limit,"onUpdate:modelValue":t[11]||(t[11]=function(t){e.tag.fire_limit=t,e.setValueHasChanged()}),options:e.availableFireLimits,title:e.translate("TagManager_FireLimit"),"inline-help":e.fireLimitHelp},null,8,["model-value","options","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"fire_delay","model-value":e.tag.fire_delay,"onUpdate:modelValue":t[12]||(t[12]=function(t){e.tag.fire_delay=t,e.setValueHasChanged()}),maxlength:8,title:e.translate("TagManager_FireDelay"),"inline-help":e.translate("TagManager_FireDelayHelp"),placeholder:e.translate("TagManager_PlaceholderZero")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"priority","model-value":e.tag.priority,"onUpdate:modelValue":t[13]||(t[13]=function(t){e.tag.priority=t,e.setValueHasChanged()}),maxlength:4,title:e.translate("TagManager_Priority"),"inline-help":e.translate("TagManager_PriorityHelp"),placeholder:e.translate("TagManager_PriorityPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",_i,[Object(r["createElementVNode"])("div",Di,[Object(r["createElementVNode"])("div",Ai,[Object(r["createElementVNode"])("div",xi,[Object(r["createElementVNode"])("label",Bi,Object(r["toDisplayString"])(e.translate("TagManager_StartDate"))+":",1)]),Object(r["createElementVNode"])("div",Li,[Object(r["createVNode"])(d,{name:"start_date","model-value":e.tag.start_date,"onUpdate:modelValue":t[14]||(t[14]=function(t){e.tag.start_date=t,e.setValueHasChanged()}),"default-time":"00:00:00"},null,8,["model-value"])])])]),Object(r["createElementVNode"])("div",Ui,[Object(r["createElementVNode"])("div",Pi,[Object(r["createElementVNode"])("span",Ii,[Object(r["createElementVNode"])("span",null,[Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_TagStartDateHelp","<strong>","</strong>"))},null,8,Fi),Hi,Object(r["createElementVNode"])("span",{class:"currentLocalTime",innerHTML:e.$sanitize(e.translate("TagManager_CurrentTimeInLocalTimezone","<strong>",e.currentTime,"</strong>"))},null,8,Gi)])])])])]),Object(r["createElementVNode"])("div",$i,[Object(r["createElementVNode"])("div",Ri,[Object(r["createElementVNode"])("div",qi,[Object(r["createElementVNode"])("div",zi,[Object(r["createElementVNode"])("label",Wi,Object(r["toDisplayString"])(e.translate("TagManager_EndDate"))+":",1)]),Object(r["createElementVNode"])("div",Xi,[Object(r["createVNode"])(d,{name:"end_date","model-value":e.tag.end_date,"onUpdate:modelValue":t[15]||(t[15]=function(t){e.tag.end_date=t,e.setValueHasChanged()}),"default-time":"23:59:59"},null,8,["model-value"])])])]),Object(r["createElementVNode"])("div",Ki,[Object(r["createElementVNode"])("div",Ji,[Object(r["createElementVNode"])("span",Yi,[Object(r["createElementVNode"])("span",null,[Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_TagEndDateHelp","<strong>","</strong>"))},null,8,Zi),Qi,Object(r["createElementVNode"])("span",{class:"currentLocalTime",innerHTML:e.$sanitize(e.translate("TagManager_CurrentTimeInLocalTimezone","<strong>",e.currentTime,"</strong>"))},null,8,er)])])])])])],512),[[r["vShow"],e.showAdvanced&&(null===(g=e.tag.typeMetadata)||void 0===g?void 0:g.hasAdvancedSettings)]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-warning"},Object(r["toDisplayString"])(e.translate("TagManager_UseCustomTemplateCapabilityRequired",e.translate("TagManager_CapabilityUseCustomTemplates"))),513),[[r["vShow"],e.isTagDisabled]]),Object(r["withDirectives"])(Object(r["createVNode"])(u,{class:"createButton",onConfirm:t[16]||(t[16]=function(t){return e.edit?e.updateTag():e.createTag()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewTag")},null,8,["disabled","saving","value"]),[[r["vShow"],!e.isTagDisabled]]),Object(r["createElementVNode"])("div",tr,[Object(r["createElementVNode"])("a",{onClick:t[17]||(t[17]=function(t){return e.cancel()})},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)])])],544),[[r["vShow"],!e.chooseTagType&&e.editTitle]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",nr,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.availableTags,(function(t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("ul",{class:"collection with-header",key:t.name},[Object(r["createElementVNode"])("li",ar,[Object(r["createElementVNode"])("h4",null,Object(r["toDisplayString"])(t.name),1)]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.types,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:n,class:Object(r["normalizeClass"])(["collection-item avatar",vi({disabledTemplate:e.isTagTemplateDisabled[t.id]},"templateType".concat(t.id),!0)]),onClick:function(n){return e.createTagType(t)},title:e.isTagTemplateDisabled[t.id]?e.collectionItemAvatarText:""},[t.icon?(Object(r["openBlock"])(),Object(r["createElementBlock"])("img",{key:0,alt:"",class:"circle",src:t.icon},null,8,rr)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("span",or,Object(r["toDisplayString"])(t.name),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(t.description),513),[[r["vShow"],t.description]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",lr,[Object(r["createElementVNode"])("i",{class:"icon-help",title:t.help},null,8,cr)],512),[[r["vShow"],!!t.help]])],10,ir)})),128))])})),128)),Object(r["createElementVNode"])("div",sr,[Object(r["createElementVNode"])("a",{onClick:t[19]||(t[19]=function(t){return e.cancel()})},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)])],512),[[r["vShow"],e.chooseTagType]])]})),_:1},8,["content-title"])],512)}function ur(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gr(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function mr(e,t,n){return t&&gr(e.prototype,t),n&&gr(e,n),e}function br(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var pr=function(){function e(){var t=this;ur(this,e),br(this,"privateState",Object(r["reactive"])({fireLimits:[],isLoading:!1})),br(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),br(this,"isLoading",Object(r["computed"])((function(){return t.state.value.isLoading}))),br(this,"fireLimits",Object(r["computed"])((function(){return t.state.value.fireLimits}))),br(this,"fireLimitsOptions",Object(r["computed"])((function(){return t.fireLimits.value.map((function(e){var t=e.id,n=e.name;return{key:t,value:n}}))}))),br(this,"initializePromise",null)}return mr(e,[{key:"init",value:function(){return this.initializePromise||(this.initializePromise=this.fetchAvailableFireLimits()),this.initializePromise}},{key:"fetchAvailableFireLimits",value:function(){var e=this;return this.privateState.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getAvailableTagFireLimits",filter_limit:"-1"}).then((function(t){var n;n=Array.isArray(t)?t:Object.values(t),e.privateState.fireLimits=n})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),hr=new pr,fr={class:"col s12 m6"},vr=["for"],jr=Object(r["createElementVNode"])("br",null,null,-1),Or=["name"],Tr=["onClick","title"],yr=["onClick","title"],Vr={class:"col s12 m6"},Cr={class:"form-help"},Nr={class:"inline-help"},Er=Object(r["createElementVNode"])("br",null,null,-1),Sr=Object(r["createElementVNode"])("br",null,null,-1);function wr(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{class:Object(r["normalizeClass"])(["form-group row","".concat(e.type,"Triggers")])},[Object(r["createElementVNode"])("div",fr,[Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("label",{for:"".concat(e.type,"_triggers")},Object(r["toDisplayString"])(e.title),9,vr),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[jr,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_NoTriggersFound"))+". ",1),Object(r["createElementVNode"])("a",{class:"createNewTrigger",onClick:t[0]||(t[0]=function(t){return e.$emit("create")})},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),1)],512),[[r["vShow"],0===e.containerTriggers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.modelValue,(function(t,n){return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{class:Object(r["normalizeClass"])(["multiple valign-wrapper","".concat(e.type,"Trigger ").concat(e.type,"Trigger").concat(n)]),key:n},[Object(r["createElementVNode"])("div",{class:"innerFormField",name:"".concat(e.type,"_triggers")},[Object(r["createVNode"])(l,{uicontrol:"select",name:"".concat(e.type,"_triggers"),"model-value":t,"onUpdate:modelValue":function(t){return e.onChangeTrigger(t,n)},"full-width":!0,options:e.containerTriggers},null,8,["name","model-value","onUpdate:modelValue","options"])],8,Or),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"icon-edit valign",onClick:function(n){return e.$emit("edit",t)},title:e.translate("General_Edit")},null,8,Tr),[[r["vShow"],t]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"icon-minus valign",onClick:function(t){return e.removeTrigger(n)},title:e.translate("General_Remove")},null,8,yr),[[r["vShow"],n+1!==e.modelValue.length]])],2)),[[r["vShow"],e.containerTriggers.length]])})),128))])]),Object(r["createElementVNode"])("div",Vr,[Object(r["createElementVNode"])("div",Cr,[Object(r["createElementVNode"])("span",Nr,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.help)+" ",1),Er,Sr,Object(r["createElementVNode"])("a",{class:"createTriggerInHelp",onClick:t[1]||(t[1]=function(t){return e.$emit("create")})},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTriggerNow")),1)])])])],2)}function kr(e){return Ar(e)||Dr(e)||_r(e)||Mr()}function Mr(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _r(e,t){if(e){if("string"===typeof e)return xr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xr(e,t):void 0}}function Dr(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ar(e){if(Array.isArray(e))return xr(e)}function xr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Br=Object(r["defineComponent"])({props:{type:{type:String,required:!0},help:{type:String,required:!0},title:{type:String,required:!0},containerTriggers:{type:Array,required:!0},modelValue:{type:Array,required:!0}},components:{Field:g["Field"]},emits:["update:modelValue","create","edit"],methods:{onChangeTrigger:function(e,t){var n=kr(this.modelValue);n[t]=parseInt(e,10),this.$emit("update:modelValue",n)},removeTrigger:function(e){var t=kr(this.modelValue);t.splice(e,1),this.$emit("update:modelValue",t)}}});Br.render=wr;var Lr=Br,Ur={class:"col s12 m6 input-field"},Pr=["name","id","value"],Ir={class:"col s12 m6 input-field"},Fr=["name","id","value"];function Hr(e,t,n,a,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[Object(r["createElementVNode"])("div",Ur,[Object(r["createElementVNode"])("input",{ref:"dateInput",type:"text",name:"".concat(e.name,"_date"),id:"".concat(e.name,"_date"),class:"dateInput",value:e.dateText,onKeydown:t[0]||(t[0]=function(t){return e.onDateKeydown(t)}),onChange:t[1]||(t[1]=function(t){return e.onDateKeydown(t)})},null,40,Pr)]),Object(r["createElementVNode"])("div",Ir,[Object(r["createElementVNode"])("input",{ref:"timeInput",type:"text",name:"".concat(e.name,"_time"),id:"".concat(e.name,"_time"),class:"timeInput",value:e.timeText,onKeydown:t[2]||(t[2]=function(t){return e.onTimeKeydown(t)})},null,40,Fr)])],64)}function Gr(e){var t=String(e);return 1===t.length&&(t="0".concat(t)),t}function $r(e){if(e){var t=e;if(t){t="".concat(t).replace(/-/g,"/");try{return new Date("".concat(t," UTC"))}catch(c){try{return new Date(Date.parse("".concat(t," UTC")))}catch(s){var n=t.substr(0,10),a=t.substr(11),i=n.split("/"),r=a.split(":");if(3===i.length&&3===r.length){var o=new Date(parseInt(i[0],10),parseInt(i[1],10)-1,parseInt(i[2],10),parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)),l=o.getTime()+6e4*o.getTimezoneOffset();return new Date(l)}}}}}}function Rr(e){var t=$r(e);if(t){var n=Gr(t.getMonth()+1),a=Gr(t.getDate());return"".concat(t.getFullYear(),"-").concat(n,"-").concat(a)}var i=e.split(" ");return i[0]}function qr(e){var t=$r(e);if(t){var n=Gr(t.getHours()),a=Gr(t.getMinutes()),i=Gr(t.getSeconds());return"".concat(n,":").concat(a,":").concat(i)}var r=e.split(" ");return r[1]}function zr(e){var t=e;t&&(t=t.replace(/-/g,"/"));try{var n=new Date(t),a=Gr(n.getUTCMonth()+1),i=Gr(n.getUTCDate()),r=Gr(n.getUTCHours()),o=Gr(n.getUTCMinutes()),l=Gr(n.getUTCSeconds()),c="";return c+="".concat(n.getUTCFullYear(),"-").concat(a,"-").concat(i),c+=" ",c+="".concat(r,":").concat(o,":").concat(l),c}catch(s){return t}}var Wr=window,Xr=Wr.$,Kr=Object(r["defineComponent"])({props:{name:{type:String,required:!0},defaultTime:{type:String,required:!0},modelValue:String},mounted:function(){var e=this,t=Object.assign(Object.assign({},u["Matomo"].getBaseDatePickerOptions(null)),{},{minDate:new Date});delete t.maxDate,Xr(this.$refs.dateInput).datepicker(Object.assign({},t)),Xr(this.$refs.timeInput).timepicker({timeFormat:"H:i:s"}).on("change",(function(t){e.onTimeKeydown(t)}))},computed:{dateText:function(){return this.modelValue?Rr(this.modelValue):""},timeText:function(){return this.modelValue?qr(this.modelValue):""}},methods:{onDateKeydown:function(e){var t=this;setTimeout((function(){var n=e.target.value;t.dateText!==n&&t.onChange(n,t.timeText)}))},onTimeKeydown:function(e){var t=this;setTimeout((function(){var n=e.target.value;t.timeText!==n&&t.onChange(t.dateText,n)}))},onChange:function(e,t){if(e){var n=t||this.defaultTime,a=zr("".concat(e," ").concat(n));this.$emit("update:model-value",a)}else this.$emit("update:model-value",null)}}});Kr.render=Hr;var Jr=Kr;function Yr(e){return Yr="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yr(e)}function Zr(e,t){return to(e)||eo(e,t)||io(e,t)||Qr()}function Qr(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function eo(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(r.push(a.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(l)throw i}}return r}}function to(e){if(Array.isArray(e))return e}function no(e){return oo(e)||ro(e)||io(e)||ao()}function ao(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function io(e,t){if(e){if("string"===typeof e)return lo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lo(e,t):void 0}}function ro(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function oo(e){if(Array.isArray(e))return lo(e)}function lo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function co(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function so(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function uo(e,t,n){return t&&so(e.prototype,t),n&&so(e,n),e}function go(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var mo=function(){function e(){var t=this;co(this,e),go(this,"privateState",Object(r["reactive"])({tags:[],isLoadingTags:!1,isLoadingSingle:!1,isUpdating:!1})),go(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),go(this,"isLoading",Object(r["computed"])((function(){var e=t.state.value;return e.isLoadingTags||e.isLoadingSingle}))),go(this,"isUpdating",Object(r["computed"])((function(){return t.state.value.isUpdating}))),go(this,"tags",Object(r["computed"])((function(){return t.state.value.tags}))),go(this,"fetchPromise",null),go(this,"availableTagsPromises",{})}return uo(e,[{key:"fetchTags",value:function(e,t){var n=this;return this.privateState.isLoadingTags=!0,this.privateState.tags=[],this.fetchPromise||(this.fetchPromise=u["AjaxHelper"].fetch({method:"TagManager.getContainerTags",idContainer:e,idContainerVersion:t,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return n.privateState.tags=e,n.privateState.isLoadingTags=!1,n.tags.value})).finally((function(){n.privateState.isLoadingTags=!1}))}},{key:"reload",value:function(e,t){return this.privateState.tags=[],this.fetchPromise=null,this.availableTagsPromises={},this.fetchTags(e,t)}},{key:"findTag",value:function(e,t,n){var a=this,i=this.tags.value.find((function(e){return e.idtag===n}));return i?Promise.resolve(i):(this.privateState.isLoadingSingle=!0,u["AjaxHelper"].fetch({idTag:n,idContainer:e,idContainerVersion:t,method:"TagManager.getContainerTag",filter_limit:"-1"}).then((function(e){return a.privateState.tags=[].concat(no(a.privateState.tags),[e]),Object(r["readonly"])(e)})).finally((function(){a.privateState.isLoadingSingle=!1})))}},{key:"fetchAvailableTags",value:function(e){return this.availableTagsPromises[e]||(this.availableTagsPromises[e]=u["AjaxHelper"].fetch({method:"TagManager.getAvailableTagTypesInContext",idContext:e,filter_limit:"-1"}).then((function(e){return Object(r["readonly"])(e)}))),Promise.resolve(this.availableTagsPromises[e])}},{key:"createOrUpdateTag",value:function(e,t,n,a,i,r,o){var l=this;this.privateState.isUpdating=!0;var c=Object.entries(i).map((function(e){var t=Zr(e,2),n=t[0],a=t[1],i=a;return"boolean"===typeof a&&(i=(+a).toString()),[n,i]})),s=Object.fromEntries(c);return u["AjaxHelper"].post({idTag:e.idtag,method:t,idContainer:n,idContainerVersion:a,type:e.type,name:e.name,description:e.description,startDate:e.start_date,endDate:e.end_date,fireLimit:e.fire_limit,fireDelay:e.fire_delay,priority:e.priority},{parameters:s,fireTriggerIds:r,blockTriggerIds:o},{withTokenInUrl:!0}).finally((function(){l.privateState.isUpdating=!1}))}},{key:"deleteTag",value:function(e,t,n){var a=this;return this.privateState.isUpdating=!0,this.privateState.tags=[],u["AjaxHelper"].fetch({idTag:n,idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerTag"},{withTokenInUrl:!0}).finally((function(){a.privateState.isUpdating=!1}))}},{key:"pauseTag",value:function(e,t,n){var a=this;return this.privateState.isUpdating=!0,this.privateState.tags=[],u["AjaxHelper"].fetch({idTag:n,idContainerVersion:t,idContainer:e,method:"TagManager.pauseContainerTag"},{withTokenInUrl:!0}).finally((function(){a.privateState.isUpdating=!1}))}},{key:"resumeTag",value:function(e,t,n){var a=this;return this.privateState.isUpdating=!0,this.privateState.tags=[],u["AjaxHelper"].fetch({idTag:n,idContainerVersion:t,idContainer:e,method:"TagManager.resumeContainerTag"},{withTokenInUrl:!0}).finally((function(){a.privateState.isUpdating=!1}))}},{key:"suggestNameForType",value:function(e){for(var t=this,n=function(n){var a=e;n&&(a="".concat(a," (").concat(n,")"));var i=!t.tags.value.some((function(e){return e.name===a}));if(i)return{v:a}},a=0;a<100;a+=1){var i=n(a);if("object"===Yr(i))return i.v}}}]),e}(),bo=new mo;function po(e){return jo(e)||vo(e)||fo(e)||ho()}function ho(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fo(e,t){if(e){if("string"===typeof e)return Oo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Oo(e,t):void 0}}function vo(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function jo(e){if(Array.isArray(e))return Oo(e)}function Oo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function To(){var e=new Date;return e&&e.toString?e.toString():null}var yo=window,Vo=yo.$,Co=yo.tagManagerHelper,No="tagtagmanagement",Eo=Object(r["defineComponent"])({props:{idTag:Number,idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},newTagType:null},components:{TagDateInput:Jr,ContentBlock:u["ContentBlock"],Field:g["Field"],SaveButton:g["SaveButton"],GroupedSettings:g["GroupedSettings"],TagTriggerArray:Lr},data:function(){return{isDirty:!1,showAdvanced:!1,chooseTagType:!1,availableTags:[],containerTriggers:[],currentTime:null,tag:{},editTitle:"",parameterValues:{},isUpdatingTag:!1,fireTriggers:[],blockTriggers:[],currentTimeTimeout:null}},created:function(){var e=this;hr.init(),this.updateAvailableTriggers(),this.setCurrentTime(),bo.reload(this.idContainer,this.idContainerVersion).then((function(){e.initIdTag()}))},unmounted:function(){this.currentTimeTimeout&&clearTimeout(this.currentTimeTimeout)},watch:{idTag:function(e){null!==e&&this.initIdTag()}},methods:{setCurrentTime:function(){this.currentTime=To(),this.currentTimeTimeout=setTimeout(this.setCurrentTime.bind(this),1e4)},updateAvailableTriggers:function(){var e=this;u["AjaxHelper"].fetch({method:"TagManager.getContainerTriggers",idContainer:this.idContainer,idContainerVersion:this.idContainerVersion,filter_limit:"-1"}).then((function(t){e.containerTriggers=t.map((function(e){return{key:e.idtrigger,value:e.name}}))}))},removeAnyTagNotification:function(){u["NotificationsStore"].remove(No),u["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var n=u["NotificationsStore"].show({message:e,context:t,id:No,type:"transient"});setTimeout((function(){u["NotificationsStore"].scrollToNotification(n)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(u["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdTag:function(){var e=this;this.tag={},this.chooseTagType=!1,this.editTitle="",u["Matomo"].helper.lazyScrollToContent(),this.availableTags=[],u["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}).then((function(e){return bo.fetchAvailableTags(e.context)})).then((function(t){e.availableTags=t})).then((function(){if(e.edit&&e.idTag)return e.editTitle=Object(u["translate"])("TagManager_EditTag"),void bo.findTag(e.idContainer,e.idContainerVersion,e.idTag).then((function(t){var n;t&&(e.tag=Object(u["clone"])(t),e.parameterValues=Object.fromEntries(t.typeMetadata.parameters.map((function(e){return[e.name,e.value]}))),e.blockTriggers=po(e.tag.block_trigger_ids||[]),e.blockTriggers.length||e.blockTriggers.push(null),e.fireTriggers=po(e.tag.fire_trigger_ids||[]),e.fireTriggers.length||e.fireTriggers.push(null),e.onFireTriggerChange(),e.onBlockTriggerChange(),e.isDirty=!1,e.editTitle=Object(u["translate"])("TagManager_EditTag"),null!==(n=e.tag.typeMetadata)&&void 0!==n&&n.name&&(e.editTitle+=": ".concat(e.tag.typeMetadata.name)))}));e.create&&(e.editTitle=Object(u["translate"])("TagManager_ChooseTagToContinue"),e.chooseTagType=!0)}))},onCreateNewBlockTrigger:function(){var e=this;this.openEditTrigger((function(t){var n=e.blockTriggers.length-1;e.blockTriggers[n]?e.blockTriggers.push(t.idtrigger):e.blockTriggers[n]=t.idtrigger,e.onBlockTriggerChange()}),0)},onCreateNewFireTrigger:function(){var e=this;this.openEditTrigger((function(t){var n=e.fireTriggers.length-1;e.fireTriggers[n]?e.fireTriggers.push(t.idtrigger):e.fireTriggers[n]=t.idtrigger,e.onFireTriggerChange()}),0)},editTrigger:function(e){this.openEditTrigger((function(){return null}),e)},openEditTrigger:function(e,t){var n=this;Co.editTrigger(this.idContainer,this.idContainerVersion,t,(function(t){n.updateAvailableTriggers(),e(t)}))},onBlockTriggerChange:function(){var e=this.blockTriggers.every((function(e){return!!e}));e&&this.addBlockTrigger()},addBlockTrigger:function(){this.blockTriggers.push(null),this.isDirty=!0},removeBlockTrigger:function(e){if(e>-1){var t=this.blockTriggers.length-1;t===e?this.blockTriggers[e]=null:this.blockTriggers.splice(e,1),this.isDirty=!0}},onFireTriggerChange:function(){var e=this.fireTriggers.every((function(e){return!!e}));e&&this.addFireTrigger()},addFireTrigger:function(){this.fireTriggers.push(null),this.isDirty=!0},removeFireTrigger:function(e){if(e>-1){var t=this.fireTriggers.length-1;t===e?this.fireTriggers[e]=null:this.fireTriggers.splice(e,1),this.isDirty=!0}},createTagType:function(e){var t,n=this;e&&this.isTagTemplateDisabled[e.id]||(this.chooseTagType=!1,this.tag={idsite:parseInt("".concat(u["Matomo"].idSite),10),name:bo.suggestNameForType(e.name)||"",type:e.id,fire_limit:"unlimited",priority:"GoogleTag"===e.id||"GoogleAnalytics4"===e.id?1:999,fire_delay:0,typeMetadata:e},this.editTitle=Object(u["translate"])("TagManager_CreateNewTag"),null!==(t=this.tag.typeMetadata)&&void 0!==t&&t.name&&(this.editTitle+=": ".concat(this.tag.typeMetadata.name)),this.blockTriggers=[null],this.fireTriggers=[null],this.parameterValues=Object.fromEntries(e.parameters.map((function(e){return[e.name,e.value]}))),this.isDirty=!1,setTimeout((function(){var e=Vo(n.$refs.root);e.length&&e[0]&&e[0].scrollIntoView(),e.find("#name").focus()}),1))},cancel:function(){var e=Object.assign({},u["MatomoUrl"].hashParsed.value);delete e.idTag,u["MatomoUrl"].updateHash(e)},createTag:function(){var e=this;this.removeAnyTagNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTag=!0,bo.createOrUpdateTag(this.tag,"TagManager.addContainerTag",this.idContainer,this.idContainerVersion,this.parameterValues,this.fireTriggers.filter((function(e){return!!e})),this.blockTriggers.filter((function(e){return!!e}))).then((function(t){t&&(e.isDirty=!1,bo.reload(e.idContainer,e.idContainerVersion).then((function(){e.cancel(),setTimeout((function(){var t=Object(u["translate"])("TagManager_CreatedX",Object(u["translate"])("TagManager_Tag")),n="";e.hasPublishCapability()&&(n=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),e.showNotification("".concat(t," ").concat(n),"success")}),200)})))})).finally((function(){e.isUpdatingTag=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateTag:function(){var e=this;this.removeAnyTagNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingTag=!0,bo.createOrUpdateTag(this.tag,"TagManager.updateContainerTag",this.idContainer,this.idContainerVersion,this.parameterValues,this.fireTriggers.filter((function(e){return!!e})),this.blockTriggers.filter((function(e){return!!e}))).then((function(t){if(t){e.isDirty=!1,bo.reload(e.idContainer,e.idContainerVersion).then((function(){e.initIdTag()})),e.cancel();var n=Object(u["translate"])("TagManager_UpdatedX",Object(u["translate"])("TagManager_Tag")),a="";e.hasPublishCapability()&&(a=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),e.showNotification("".concat(n," ").concat(a),"success")}})).finally((function(){e.isUpdatingTag=!1})))},checkRequiredFieldsAreSet:function(){if(!this.tag.name){var e=Object(u["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}return!(!this.fireTriggers||!this.fireTriggers.length)||(this.showNotification(Object(u["translate"])("TagManager_TagFireTriggerRequirement"),"error"),!1)},hasPublishCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_write")&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")}},computed:{availableFireLimits:function(){return hr.fireLimitsOptions.value},isLoading:function(){return ya.isLoading.value||hr.isLoading.value},isUpdating:function(){return ya.isUpdating.value||this.isUpdatingTag},create:function(){return 0===this.idTag},edit:function(){return!this.create},canUseCustomTemplates:function(){return u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},isTagDisabled:function(){var e;return!this.canUseCustomTemplates&&(null===(e=this.tag.typeMetadata)||void 0===e?void 0:e.isCustomTemplate)},isTagTemplateDisabled:function(){var e=this,t={};return this.availableTags.forEach((function(n){n.types.forEach((function(n){t[n.id]=!e.canUseCustomTemplates&&n.isCustomTemplate}))})),t},collectionItemAvatarText:function(){return Object(u["translate"])("TagManager_UseCustomTemplateCapabilityRequired",Object(u["translate"])("TagManager_CapabilityUseCustomTemplates"))},fireLimitHelp:function(){return Object(u["translate"])("TagManager_FireLimitHelp",Object(u["translate"])("TagManager_Unlimited"),Object(u["translate"])("TagManager_OncePage"),Object(u["translate"])("TagManager_Once24Hours"),Object(u["translate"])("TagManager_OnceLifetime"))}}});Eo.render=dr;var So=Eo,wo={class:"tagManagerManageList tagManagerTagList"},ko={class:"tagSearchFilter"},Mo=["title"],_o=["title"],Do=["title"],Ao=["title"],xo=["title"],Bo=["title"],Lo={colspan:"6"},Uo={class:"loadingPiwik"},Po=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Io={colspan:"6"},Fo=["id"],Ho=["title"],Go=["title"],$o=["title"],Ro={class:"triggers"},qo=["onClick","title"],zo=["title"],Wo=["onClick","title"],Xo=["title"],Ko=["title"],Jo=["onClick","title"],Yo=["onClick","title"],Zo=["onClick","title"],Qo=["onClick","title"],el=["onClick","title"],tl={class:"tableActionBar"},nl=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),al={class:"ui-confirm",id:"confirmDeleteTag",ref:"confirmDeleteTag"},il=["value"],rl=["value"],ol={class:"ui-confirm",id:"confirmPauseTag",ref:"confirmPauseTag"},ll=["value"],cl=["value"],sl={class:"ui-confirm",id:"confirmResumeTag",ref:"confirmResumeTag"},dl=["value"],ul=["value"];function gl(e,t,n,a,i,o){var l=this,c=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("ContentBlock"),d=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",wo,[Object(r["createVNode"])(s,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Tags")),"help-text":e.tagsHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_TagUsageBenefits")),1),Object(r["createElementVNode"])("div",ko,[Object(r["withDirectives"])(Object(r["createVNode"])(c,{uicontrol:"text",name:"tagSearch",title:e.translate("General_Search"),modelValue:e.tagSearch,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.tagSearch=t})},null,8,["title","modelValue"]),[[r["vShow"],e.tags.length>0]])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,Mo),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,_o),Object(r["createElementVNode"])("th",{class:"type",title:e.typeTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Type")),9,Do),Object(r["createElementVNode"])("th",{class:"triggers",title:e.triggersTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Triggers")),9,Ao),Object(r["createElementVNode"])("th",{class:"lastUpdated",title:e.lastUpdatedTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),9,xo),Object(r["withDirectives"])(Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,Bo),[[r["vShow"],e.hasWriteAccess]])])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Lo,[Object(r["createElementVNode"])("span",Uo,[Po,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Io,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoTagsFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerTagNow",onClick:t[1]||(t[1]=function(t){return e.createTag()})},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTagNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&0===e.tags.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedTags,(function(t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{class:"tags",key:t.idtag,id:"tag".concat(t.idtag)},[Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,Ho),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,Go),Object(r["createElementVNode"])("td",{class:"type",title:t.typeMetadata.description},Object(r["toDisplayString"])(t.typeMetadata.name),9,$o),Object(r["createElementVNode"])("td",Ro,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.fire_trigger_ids,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n,style:{"margin-right":"3.5px"}},[e.hasWriteAccess?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,style:{display:"inline-block","vertical-align":"top !important"},class:"chip",href:"",onClick:Object(r["withModifiers"])((function(n){return e.editTrigger(t)}),["prevent"]),title:l.triggers[t]},Object(r["toDisplayString"])(e.truncateText(l.triggers[t],e.triggerTruncateLength)),9,qo)):Object(r["createCommentVNode"])("",!0),e.hasWriteAccess?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:1,class:"chip",title:l.triggers[t]},Object(r["toDisplayString"])(e.truncateText(l.triggers[t],e.triggerTruncateLength)),9,zo))])})),128)),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Except"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.block_trigger_ids,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n,style:{"margin-right":"3.5px"}},[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"chip",href:"",onClick:Object(r["withModifiers"])((function(n){return e.editTrigger(t)}),["prevent"]),title:l.triggers[t]},Object(r["toDisplayString"])(e.truncateText(l.triggers[t],e.triggerTruncateLength)),9,Wo),[[r["vShow"],e.hasWriteAccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{class:"chip",title:l.triggers[t]},Object(r["toDisplayString"])(e.truncateText(l.triggers[t],e.triggerTruncateLength)),9,Xo),[[r["vShow"],!e.hasWriteAccess]])])})),128))],512),[[r["vShow"],t.block_trigger_ids.length]])]),Object(r["createElementVNode"])("td",{class:"lastUpdated",title:e.translate("TagManager_CreatedOnX",t.created_date_pretty)},[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.updated_date_pretty),1)],8,Ko),Object(r["withDirectives"])(Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-pause",onClick:function(n){return e.pauseTag(t)},title:e.translate("TagManager_PauseX",e.translate("TagManager_Tag"))},null,8,Jo),[[r["vShow"],"active"===t.status]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-play",onClick:function(n){return e.resumeTag(t)},title:e.translate("TagManager_ResumeX",e.translate("TagManager_Tag"))},null,8,Yo),[[r["vShow"],"paused"===t.status]]),Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(n){return e.editTag(t.idtag,t.type)},title:e.translate("TagManager_EditTag")},null,8,Zo),Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(n){return e.deleteTag(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Tag"))},null,8,Qo),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:function(n){return e.openCopyDialog(t)},title:e.translate("TagManager_CopyX",e.translate("TagManager_Tag"))},null,8,el),[[r["vShow"],e.hasPublishCapability()]])],2),[[r["vShow"],e.hasWriteAccess]])],8,Fo)})),128))])],512),[[d]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",tl,[Object(r["createElementVNode"])("a",{class:"createNewTag",value:"",onClick:t[2]||(t[2]=function(t){return e.createTag()})},[nl,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTag")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("div",al,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteTagConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,il),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,rl)],512),Object(r["createElementVNode"])("div",ol,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_PauseTagConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,ll),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,cl)],512),Object(r["createElementVNode"])("div",sl,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_ResumeTagConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,dl),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,ul)],512)])}function ml(e){return fl(e)||hl(e)||pl(e)||bl()}function bl(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function pl(e,t){if(e){if("string"===typeof e)return vl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vl(e,t):void 0}}function hl(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function fl(e){if(Array.isArray(e))return vl(e)}function vl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var jl=window,Ol=jl.tagManagerHelper,Tl="tagtagmanagementlist",yl=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},idContainerVersion:{type:Number,required:!0},tagsHelpText:String},components:{ContentBlock:u["ContentBlock"],Field:g["Field"]},directives:{ContentTable:u["ContentTable"]},data:function(){return{hasWriteAccess:u["Matomo"].hasUserCapability("tagmanager_write"),triggerTruncateLength:40,tagSearch:""}},created:function(){var e=this;Object(r["watch"])((function(){return bo.tags.value}),(function(){e.reloadTriggers()})),this.reloadTriggers(),bo.fetchTags(this.idContainer,this.idContainerVersion)},methods:{reloadTriggers:function(){ya.reload(this.idContainer,this.idContainerVersion)},createTag:function(){this.editTag(0)},editTrigger:function(e){var t=this;Ol.editTrigger(this.idContainer,this.idContainerVersion,e,(function(){t.reloadTriggers()}))},editTag:function(e){u["MatomoUrl"].updateHash(Object.assign(Object.assign({},u["MatomoUrl"].hashParsed.value),{},{idTag:e}))},pauseTag:function(e){var t=this,n=function(){bo.pauseTag(t.idContainer,t.idContainerVersion,e.idtag).then((function(){bo.reload(t.idContainer,t.idContainerVersion).then((function(){setTimeout((function(){t.showDeployNotification("pause")}),200)}))}))};u["Matomo"].helper.modalConfirm("#confirmPauseTag",{yes:n})},resumeTag:function(e){var t=this,n=function(){bo.resumeTag(t.idContainer,t.idContainerVersion,e.idtag).then((function(){bo.reload(t.idContainer,t.idContainerVersion).then((function(){setTimeout((function(){t.showDeployNotification("resume")}),200)}))}))};u["Matomo"].helper.modalConfirm("#confirmResumeTag",{yes:n})},deleteTag:function(e){var t=this,n=function(){bo.deleteTag(t.idContainer,t.idContainerVersion,e.idtag).then((function(){bo.reload(t.idContainer,t.idContainerVersion),u["NotificationsStore"].remove("CopyDialogResultNotification")}))};u["Matomo"].helper.modalConfirm("#confirmDeleteTag",{yes:n})},truncateText:function(e,t){return Ol.truncateText(e,t)},hasPublishCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_write")&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},showDeployNotification:function(e){var t="pause"===e?"TagManager_PausedTag":"TagManager_ResumedTag",n=Object(u["translate"])(t,Object(u["translate"])("TagManager_Tag")),a="";this.hasPublishCapability()&&(a=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),this.showNotification("".concat(n," ").concat(a),"success")},showNotification:function(e,t){var n=u["NotificationsStore"].show({message:e,context:t,id:Tl,type:"transient"});setTimeout((function(){u["NotificationsStore"].scrollToNotification(n)}),200)},openCopyDialog:function(e){var t=u["MatomoUrl"].stringify({module:"TagManager",action:"copyTagDialog",idSite:e.idsite,idContainer:this.idContainer,idTag:e.idtag,idContainerVersion:this.idContainerVersion});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyTag")}},computed:{triggers:function(){var e={};return ya.triggers.value.forEach((function(t){e["".concat(t.idtrigger)]=t.name})),e},isLoading:function(){return bo.isLoading.value},isUpdating:function(){return bo.isUpdating.value},tags:function(){return bo.tags.value},sortedTags:function(){var e=this,t=this.tagSearch.toLowerCase(),n=ml(this.tags).filter((function(n){return Object.keys(n).some((function(a){var i=n,r="";if("string"===typeof i[a])r=i[a];else if("typeMetadata"===a){var o=i.typeMetadata;r=o.name}else if("fire_trigger_ids"===a)e.triggers&&i.fire_trigger_ids&&Object.values(i.fire_trigger_ids).forEach((function(t){e.triggers[t]&&(r+="".concat(e.triggers[t]," "))}));else if("parameters"===a&&"CustomHtml"===i.type){var l=i.parameters;r=l.customHtml}return-1!==r.toLowerCase().indexOf(t)}))}));return n.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),n},nameTranslatedText:function(){return this.translate("TagManager_TagsNameDescription")},descriptionTranslatedText:function(){return this.translate("TagManager_TagsDescriptionDescription")},typeTranslatedText:function(){return this.translate("TagManager_TagsTypeDescription")},triggersTranslatedText:function(){return this.translate("TagManager_TagsTriggersDescription")},lastUpdatedTranslatedText:function(){return this.translate("TagManager_TagsLastUpdatedDescription")},actionTranslatedText:function(){return this.translate("TagManager_TagsActionDescription")},getActionClasses:function(){var e=this.hasPublishCapability()?" hasCopyAction":"";return"action".concat(e)}}});yl.render=gl;var Vl=yl,Cl={class:"manageTag"},Nl={key:0},El={key:1};function Sl(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("TagList"),c=Object(r["resolveComponent"])("TagEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Cl,[e.editMode?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Nl,[Object(r["createVNode"])(l,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"tags-help-text":e.tagsHelpText},null,8,["id-container","id-container-version","tags-help-text"])])),e.editMode?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",El,[Object(r["createVNode"])(c,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion,"id-tag":e.idTag},null,8,["id-container","id-container-version","id-tag"])])):Object(r["createCommentVNode"])("",!0)])}var wl=Object(r["defineComponent"])({props:{idContainerVersion:Number,idContainer:String,tagsHelpText:String},components:{TagList:Vl,TagEdit:So},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(r["watch"])((function(){return u["MatomoUrl"].hashParsed.value.idTag}),(function(t){e.onIdTagParamChange(t)})),u["NotificationsStore"].remove("tagtagmanagement"),this.onIdTagParamChange(u["MatomoUrl"].hashParsed.value.idTag)},methods:{onIdTagParamChange:function(e){if("0"===e){var t={isAllowed:!0};u["Matomo"].postEvent("TagManager.initAddTag",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idTag:function(){var e=u["MatomoUrl"].hashParsed.value.idTag;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idTag}}});wl.render=Sl;var kl=wl,Ml={class:"editVersion tagManagerManageEdit"},_l={class:"loadingPiwik"},Dl=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Al={class:"loadingPiwik"},xl=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Bl={key:0},Ll={key:0},Ul={key:1},Pl=["innerHTML"],Il={key:2,class:"versionChanges"},Fl={key:0},Hl={colspan:"4"},Gl={key:1},$l={colspan:"4"},Rl={class:"lastUpdated"},ql={class:"entityCancel"};function zl(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("SaveButton"),s=Object(r["resolveComponent"])("ActivityIndicator"),d=Object(r["resolveComponent"])("ContentBlock"),u=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ml,[Object(r["createVNode"])(d,{feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])((function(){var n;return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",_l,[Dl,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Al,[xl,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["createElementVNode"])("form",{onSubmit:t[6]||(t[6]=function(t){return e.edit?e.updateVersion():e.createVersion()})},[Object(r["createElementVNode"])("div",null,[e.hasPublishCapability()||e.hasWriteCapability()&&e.hasPublishToLiveCapability()?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Bl,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","inline-help":e.versionNameHelpText,"inline-help-bind":{lastVersion:e.lastVersion},"model-value":e.version.name,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.version.name=t,e.setValueHasChanged()}),maxlength:50,title:e.translate("TagManager_VersionName"),placeholder:e.translate("TagManager_VersionNamePlaceholder")},null,8,["inline-help","inline-help-bind","model-value","title","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.version.description,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.version.description=t,e.setValueHasChanged()}),title:e.translate("TagManager_VersionDescriptionOptional"),"inline-help":e.translate("TagManager_VersionDescriptionHelp"),placeholder:e.translate("TagManager_VersionDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createVNode"])(c,{class:"createButton no-publish",onConfirm:t[2]||(t[2]=function(t){return e.edit?e.updateVersion():e.createVersion()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateVersionWithoutPublishing")},null,8,["disabled","saving","value"]),e.create&&e.environments.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ll,[Object(r["createVNode"])(l,{uicontrol:"select",name:"environment","inline-help":e.selectTagManagerEnvironmentHelp,"inline-help-bind":{canPublishToLive:e.canPublishToLive},"model-value":null===(n=e.version.environments)||void 0===n?void 0:n[0],"onUpdate:modelValue":t[3]||(t[3]=function(t){e.version.environments[0]=t,e.setValueHasChanged()}),options:e.environments,introduction:e.translate("TagManager_OrCreateAndPublishVersion"),title:e.translate("TagManager_Environment")},null,8,["inline-help","inline-help-bind","model-value","options","introduction","title"])])):Object(r["createCommentVNode"])("",!0),e.create&&e.environments.length?(Object(r["openBlock"])(),Object(r["createBlock"])(c,{key:1,class:"publishButton",onConfirm:t[4]||(t[4]=function(t){return e.createVersionAndPublish()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.translate("TagManager_CreateVersionAndPublishRelease")},null,8,["disabled","saving","value"])):Object(r["createCommentVNode"])("",!0)])):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ul,[Object(r["createElementVNode"])("div",{class:"alert alert-warning",innerHTML:e.$sanitize(e.showNoAccessErrorMessage)},null,8,Pl)])),e.lastVersion?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Il,[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("TagManager_ChangesSinceLastVersion"))+":",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("SitesManager_Type")),1),Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("General_Name")),1),Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("TagManager_Change")),1),Object(r["createElementVNode"])("th",null,Object(r["toDisplayString"])(e.translate("TagManager_LastUpdated")),1)])]),Object(r["createElementVNode"])("tbody",null,[e.isLoadingVersionChanges?(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Fl,[Object(r["createElementVNode"])("td",Hl,[Object(r["createVNode"])(s,{"loading-message":e.translate("TagManager_DetectingChanges"),loading:!0},null,8,["loading-message"])])])):Object(r["createCommentVNode"])("",!0),e.versionChanges.length||e.isLoadingVersionChanges?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Gl,[Object(r["createElementVNode"])("td",$l,Object(r["toDisplayString"])(e.translate("UserCountryMap_None")),1)])),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.versionChanges,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:n},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.translate(t.entityType)),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(t.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.translate(t.type)),1),Object(r["createElementVNode"])("td",Rl,[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.lastChanged),1)])])})),128))])],512),[[u]])])):Object(r["createCommentVNode"])("",!0),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",ql,[Object(r["createElementVNode"])("a",{onClick:t[5]||(t[5]=function(t){return e.cancel()})},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)],512),[[r["vShow"],!e.isEmbedded]])])],32)]})),_:1},8,["content-title"])])}function Wl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xl(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Kl(e,t,n){return t&&Xl(e.prototype,t),n&&Xl(e,n),e}function Jl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Yl=function(){function e(){var t=this;Wl(this,e),Jl(this,"privateState",Object(r["reactive"])({environmentsWithPublish:[],isLoading:!1})),Jl(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),Jl(this,"isLoading",Object(r["computed"])((function(){return t.state.value.isLoading}))),Jl(this,"environmentsWithPublish",Object(r["computed"])((function(){return t.state.value.environmentsWithPublish}))),Jl(this,"environmentsWithPublishOptions",Object(r["computed"])((function(){return t.environmentsWithPublish.value.map((function(e){var t=e.id,n=e.name;e.disabled;return{key:t,value:n,disabled:!1}}))}))),Jl(this,"initializePromise",null)}return Kl(e,[{key:"init",value:function(){return this.initializePromise||(this.initializePromise=this.fetchEnvironments()),this.initializePromise}},{key:"fetchEnvironments",value:function(){var e=this;return this.privateState.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getAvailableEnvironmentsWithPublishCapability",filter_limit:"-1"}).then((function(t){var n;n=Array.isArray(t)?t:Object.values(t),e.privateState.environmentsWithPublish=n})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),Zl=new Yl;function Ql(e){return nc(e)||tc(e)||rc(e)||ec()}function ec(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function tc(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function nc(e){if(Array.isArray(e))return oc(e)}function ac(e,t){return cc(e)||lc(e,t)||rc(e,t)||ic()}function ic(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function rc(e,t){if(e){if("string"===typeof e)return oc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?oc(e,t):void 0}}function oc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function lc(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(r.push(a.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(l)throw i}}return r}}function cc(e){if(Array.isArray(e))return e}
/**
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function sc(e,t,n){function a(e,t){return e.find((function(e){return e.name===t}))}function i(e,t,n,i){var r=[];return t.forEach((function(t){var o=a(n,t.name);o?i.some((function(n){return JSON.stringify(t[n])!==JSON.stringify(o[n])&&(r.push({entityType:e,type:"status"===n&&"paused"===t[n]?"TagManager_DiffPaused":"TagManager_DiffModified",name:t.name,lastChanged:t.updated_date_pretty}),!0)})):"paused"===t.status?r.push({entityType:e,type:"TagManager_DiffAddedPaused",name:t.name,lastChanged:t.updated_date_pretty}):r.push({entityType:e,type:"TagManager_DiffAdded",name:t.name,lastChanged:t.updated_date_pretty})})),n.forEach((function(n){a(t,n.name)||r.push({entityType:e,type:"TagManager_DiffDeleted",name:n.name,lastChanged:n.updated_date_pretty})})),r}function r(e,t){e.forEach((function(e){e.fire_triggers=[],e.block_triggers=[],e.fire_trigger_ids.forEach((function(n){var a=t.find((function(e){return e.idtrigger===n}));a&&e.fire_triggers.push(a.name)})),e.block_trigger_ids.forEach((function(n){var a=t.find((function(e){return e.idtrigger===n}));a&&e.block_triggers.push(a.name)}))}))}var o={module:"API",method:"TagManager.exportContainerVersion",format:"json",idContainer:e,filter_limit:-1};t&&(o.idContainerVersion=t);var l={module:"API",method:"TagManager.exportContainerVersion",format:"json",idContainer:e,idContainerVersion:n,filter_limit:-1};return u["AjaxHelper"].fetch([o,l]).then((function(e){var t=ac(e,2),n=t[0],a=t[1];r(n.tags,n.triggers),r(a.tags,a.triggers);var o=i("TagManager_Tag",n.tags,a.tags,["name","type","fire_limit","priority","fire_delay","fire_triggers","block_triggers","parameters","status"]),l=i("TagManager_Trigger",n.triggers,a.triggers,["name","type","conditions","parameters"]),c=i("TagManager_Variable",n.variables,a.variables,["name","type","lookup_table","default_value","parameters"]);return[].concat(Ql(o),Ql(l),Ql(c))}))}function dc(e){return bc(e)||mc(e)||gc(e)||uc()}function uc(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function gc(e,t){if(e){if("string"===typeof e)return pc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pc(e,t):void 0}}function mc(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function bc(e){if(Array.isArray(e))return pc(e)}function pc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function hc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fc(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function vc(e,t,n){return t&&fc(e.prototype,t),n&&fc(e,n),e}function jc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Oc=function(){function e(){var t=this;hc(this,e),jc(this,"privateState",Object(r["reactive"])({versions:[],isLoadingVersions:!1,isLoadingSingle:!1,isUpdating:!1})),jc(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),jc(this,"isLoading",Object(r["computed"])((function(){var e=t.state.value;return e.isLoadingVersions||e.isLoadingSingle}))),jc(this,"isUpdating",Object(r["computed"])((function(){return t.state.value.isUpdating}))),jc(this,"versions",Object(r["computed"])((function(){return t.state.value.versions}))),jc(this,"fetchPromise",null)}return vc(e,[{key:"reload",value:function(e){return this.privateState.versions=[],this.fetchPromise=null,this.fetchVersions(e)}},{key:"fetchVersions",value:function(e){var t=this;return this.privateState.isLoadingVersions=!0,this.privateState.versions=[],this.fetchPromise||(this.fetchPromise=u["AjaxHelper"].fetch({method:"TagManager.getContainerVersions",idContainer:e,filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(e){return t.privateState.versions=e,t.privateState.isLoadingVersions=!1,t.versions.value})).finally((function(){t.privateState.isLoadingVersions=!1}))}},{key:"findVersion",value:function(e,t){var n=this,a=this.versions.value.find((function(e){return e.idcontainerversion===t}));return a?Promise.resolve(a):(this.privateState.isLoadingSingle=!0,u["AjaxHelper"].fetch({idContainerVersion:t,idContainer:e,method:"TagManager.getContainerVersion",filter_limit:"-1"}).then((function(e){return n.privateState.versions=[].concat(dc(n.privateState.versions),[e]),Object(r["readonly"])(e)})).finally((function(){n.privateState.isLoadingSingle=!1})))}},{key:"deleteVersion",value:function(e,t){var n=this;return this.privateState.isUpdating=!0,this.privateState.versions=[],u["AjaxHelper"].fetch({idContainerVersion:t,idContainer:e,method:"TagManager.deleteContainerVersion"},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}},{key:"publishVersion",value:function(e,t,n){var a=this;return this.privateState.isUpdating=!0,u["AjaxHelper"].fetch({idContainer:e,idContainerVersion:t,environment:n,method:"TagManager.publishContainerVersion"}).finally((function(){a.privateState.isUpdating=!1}))}},{key:"createOrUpdateVersion",value:function(e,t,n){var a=this;return this.privateState.isUpdating=!0,u["AjaxHelper"].post({method:t,idContainer:n,idContainerVersion:e.idcontainerversion},{name:e.name,description:e.description},{withTokenInUrl:!0}).finally((function(){a.privateState.isUpdating=!1}))}}]),e}(),Tc=new Oc,yc={id:"versionNameHelpText",class:"inline-help-node"},Vc=Object(r["createElementVNode"])("br",null,null,-1),Cc=Object(r["createElementVNode"])("br",null,null,-1),Nc=["innerHTML"];function Ec(e,t,n,a,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",yc,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_VersionNameHelp"))+" ",1),Vc,Cc,Object(r["withDirectives"])(Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_NameOfLatestVersion","<strong>".concat(e.lastVersion,"</strong>")))},null,8,Nc),[[r["vShow"],e.lastVersion]])])}var Sc=Object(r["defineComponent"])({props:{lastVersion:String}});Sc.render=Ec;var wc=Sc,kc={id:"selectTagManagerEnvironmentHelp",class:"inline-help-node"};function Mc(e,t,n,a,i,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",kc,[Object(r["createElementVNode"])("div",null,Object(r["toDisplayString"])(e.translate("TagManager_VersionEnvironmentHelp")),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{class:"alert alert-info",style:{"margin-bottom":"0","padding-bottom":"0"}},Object(r["toDisplayString"])(e.translate("TagManager_PublishLiveEnvironmentCapabilityRequired",e.translate("TagManager_CapabilityPublishLiveContainer"))),513),[[r["vShow"],!e.canPublishToLive]])])}var _c=Object(r["defineComponent"])({props:{canPublishToLive:Boolean}});_c.render=Mc;var Dc=_c;function Ac(e){return Uc(e)||Lc(e)||Bc(e)||xc()}function xc(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Bc(e,t){if(e){if("string"===typeof e)return Pc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pc(e,t):void 0}}function Lc(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Uc(e){if(Array.isArray(e))return Pc(e)}function Pc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Ic="versiontagmanagement",Fc=Object(r["defineComponent"])({props:{idContainerVersion:{type:Number,required:!0},idContainer:{type:String,required:!0},isEmbedded:{type:Boolean,default:!1}},components:{ContentBlock:u["ContentBlock"],Field:g["Field"],SaveButton:g["SaveButton"],ActivityIndicator:u["ActivityIndicator"]},directives:{ContentTable:u["ContentTable"]},data:function(){return{isDirty:!1,lastVersion:null,versionChanges:[],isLoadingVersionChanges:!1,isUpdatingVersion:!1,version:{}}},emits:["changeVersion"],created:function(){Vt.init(),Zl.init(),this.initIdContainerVersion()},watch:{idContainerVersion:function(e){null!==e&&this.initIdContainerVersion()}},methods:{removeAnyVersionNotification:function(){u["NotificationsStore"].remove(Ic),u["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var n=u["NotificationsStore"].show({message:e,context:t,id:Ic,type:"transient"});setTimeout((function(){u["NotificationsStore"].scrollToNotification(n)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(u["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdContainerVersion:function(){var e=this;if(this.version={},this.lastVersion=null,this.versionChanges=[],this.isLoadingVersionChanges=!0,Tc.fetchVersions(this.idContainer).then((function(){var t;e.isLoadingVersionChanges=!1,e.lastVersion=null;var n=Ac(Tc.versions.value);if(null!==n&&void 0!==n&&n.length){n.sort((function(e,t){return e.revision<t.revision?1:0}));var a=null;e.create&&null!==(t=n[0])&&void 0!==t&&t.name?(e.lastVersion=u["Matomo"].helper.htmlEntities(n[0].name),a=n[0].idcontainerversion):e.edit&&n.forEach((function(t,i){i>=n.length-1||t.idcontainerversion===e.idContainerVersion&&n[i+1]&&(e.lastVersion=u["Matomo"].helper.htmlEntities(n[i+1].name),a=n[i+1].idcontainerversion)})),e.lastVersion&&(e.isLoadingVersionChanges=!0,sc(e.idContainer,e.idContainerVersion,a).then((function(t){t.sort((function(e,t){return new Date(t.lastChanged).valueOf()-new Date(e.lastChanged).valueOf()})),e.versionChanges=t,e.isLoadingVersionChanges=!1})),e.create&&!e.version.name&&/^\d+$/.test(e.lastVersion)&&(e.version.name="".concat(parseInt(e.lastVersion,10)+1),e.isDirty=!0))}})),u["Matomo"].helper.lazyScrollToContent(),this.edit&&this.idContainerVersion)Tc.findVersion(this.idContainer,this.idContainerVersion).then((function(t){t&&(e.version=Object(u["clone"])(t),e.isDirty=!1)}));else if(this.create){if(this.version={idSite:u["Matomo"].idSite,idcontainer:this.idContainer,name:"",description:""},this.canPublishToLive)this.version.environments=["live"];else{var t=this.environments.find((function(e){return"live"!==e.key}));this.version.environments=t?[t.key]:[]}this.isDirty=!1}},cancel:function(){var e=Object.assign({},u["MatomoUrl"].hashParsed.value);delete e.idContainerVersion,u["MatomoUrl"].updateHash(e)},createVersion:function(){var e=this;this.removeAnyVersionNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,Tc.createOrUpdateVersion(this.version,"TagManager.createContainerVersion",this.idContainer).then((function(t){if(t){e.isDirty=!1;var n=t.value;if(e.isEmbedded)return e.version.idcontainerversion=n,void e.$emit("changeVersion",{version:e.version});Tc.reload(e.idContainer).then((function(){u["MatomoUrl"].updateHash(Object.assign(Object.assign({},u["MatomoUrl"].hashParsed.value),{},{idContainerVersion:n})),setTimeout((function(){var t=Object(u["translate"])("TagManager_CreatedX",Object(u["translate"])("TagManager_Version")),n="";e.hasPublishCapability()&&(n=Object(u["translate"])("TagManager_WantToDeployThisChangeCreateVersion",'<a class="createNewVersionLink">',"</a>")),e.showNotification("".concat(t," ").concat(n),"success")}),200)}))}})).finally((function(){e.isUpdatingVersion=!1})))},createVersionAndPublish:function(){var e=this;this.removeAnyVersionNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,Tc.createOrUpdateVersion(this.version,"TagManager.createContainerVersion",this.idContainer).then((function(t){if(!t)return null;var n=t.value;return e.version.idcontainerversion=n,Tc.publishVersion(e.idContainer,n,e.version.environments[0]).then((function(){e.isDirty=!1,e.isEmbedded?e.$emit("changeVersion",{version:e.version}):Tc.reload(e.idContainer).then((function(){u["MatomoUrl"].updateHash(Object.assign(Object.assign({},u["MatomoUrl"].hashParsed.value),{},{idContainerVersion:n})),setTimeout((function(){e.showNotification(Object(u["translate"])("TagManager_VersionPublishSuccess"),"success")}),200)}))}))})).finally((function(){e.isUpdatingVersion=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateVersion:function(){var e=this;this.removeAnyVersionNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,Tc.createOrUpdateVersion(this.version,"TagManager.updateContainerVersion",this.idContainer).then((function(t){t&&(e.isEmbedded?e.$emit("changeVersion",{version:e.version}):(e.isDirty=!1,e.version={},Tc.reload(e.idContainer).then((function(){e.initIdContainerVersion()})),e.showNotification(Object(u["translate"])("TagManager_UpdatedX",Object(u["translate"])("TagManager_Version")),"success")))})).finally((function(){e.isUpdatingVersion=!1})))},checkRequiredFieldsAreSet:function(){if(!this.version.name){var e=Object(u["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}return!0},hasPublishCapability:function(){return this.hasWriteCapability()&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},hasWriteCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_write")},hasPublishToLiveCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_publish_live_container")}},computed:{create:function(){return 0===this.idContainerVersion},edit:function(){return!this.create},isLoading:function(){return ft.isLoading.value||Vt.isLoading.value},isUpdating:function(){return ft.isUpdating.value||this.isUpdatingVersion},environments:function(){var e=Zl.environmentsWithPublishOptions.value;if(!this.canPublishToLive){var t=e.findIndex((function(e){return"live"===e.key}));t>-1&&(e[t].disabled=!0)}return e},canPublishToLive:function(){return u["Matomo"].hasUserCapability("tagmanager_publish_live_container")},versionNameHelpText:function(){return Object(r["markRaw"])(wc)},selectTagManagerEnvironmentHelp:function(){return Object(r["markRaw"])(Dc)},editTitle:function(){return this.create?Object(u["translate"])("TagManager_CreateNewVersion"):Object(u["translate"])("TagManager_EditVersion")},showNoAccessErrorMessage:function(){return Object(u["translate"])("TagManager_VersionEditWithNoAccessMessage",Object(u["externalLink"])("https://matomo.org/faq/tag-manager/faq_26547/"),"</a>")}}});Fc.render=zl;var Hc=Fc,Gc={class:"tagManagerManageList tagManagerVersionList"},$c={class:"versionSearchFilter"},Rc=["title"],qc=["title"],zc=["title"],Wc=["title"],Xc=["title"],Kc=["title"],Jc={colspan:"7"},Yc={class:"loadingPiwik"},Zc=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Qc={colspan:"7"},es=["id"],ts={class:"index"},ns=["title"],as=["title"],is={class:"environments"},rs=["title"],os={class:"created"},ls={class:"action"},cs=["onClick","title"],ss=["onClick","title"],ds=["onClick","href","title"],us=["onClick","title"],gs=["onClick","title"],ms={class:"tableActionBar"},bs=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),ps=["href"],hs=Object(r["createElementVNode"])("span",{class:"icon-export"}," ",-1),fs=Object(r["createElementVNode"])("span",{class:"icon-upload"}," ",-1),vs={class:"ui-confirm",id:"confirmDeleteVersion",ref:"confirmDeleteVersion"},js=["value"],Os=["value"],Ts={class:"ui-confirm",id:"confirmPublishVersion",ref:"confirmPublishVersion"},ys={key:0,class:"alert alert-info",style:{"margin-top":"16px"}},Vs=["value"],Cs=["value"];function Ns(e,t,n,a,i,o){var l,c=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("ContentBlock"),d=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Gc,[Object(r["createVNode"])(s,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Versions")),"help-text":e.versionsHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_VersionUsageBenefits"))+" "+Object(r["toDisplayString"])(e.translate("TagManager_ConfigureEnvironmentsSuperUser")),1),Object(r["createElementVNode"])("div",$c,[Object(r["withDirectives"])(Object(r["createVNode"])(c,{uicontrol:"text",name:"versionSearch",title:e.translate("General_Search"),modelValue:e.versionSearch,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.versionSearch=t})},null,8,["title","modelValue"]),[[r["vShow"],e.versions.length>0]])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",{class:"index",title:e.revisionTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Revision")),9,Rc),Object(r["createElementVNode"])("th",{class:"name",title:e.nameTranslatedText},Object(r["toDisplayString"])(e.translate("General_Name")),9,qc),Object(r["createElementVNode"])("th",{class:"description",title:e.descriptionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Description")),9,zc),Object(r["createElementVNode"])("th",{class:"environments",title:e.environmentTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Environments")),9,Wc),Object(r["createElementVNode"])("th",{class:"created",title:e.createdTranslatedText},Object(r["toDisplayString"])(e.translate("TagManager_Created")),9,Xc),Object(r["createElementVNode"])("th",{class:"action",title:e.actionTranslatedText},Object(r["toDisplayString"])(e.translate("General_Actions")),9,Kc)])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Jc,[Object(r["createElementVNode"])("span",Yc,[Zc,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Qc,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoVersionsFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerVersionNow",onClick:t[1]||(t[1]=function(t){return e.createVersion()})},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVersionNow")),513),[[r["vShow"],e.hasWriteAccess&&e.hasCustomTemplatesCapability]])])],512),[[r["vShow"],!e.isLoading&&0===e.versions.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedVersions,(function(t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"version".concat(t.idcontainerversion),class:"versions",key:t.revision},[Object(r["createElementVNode"])("td",ts,Object(r["toDisplayString"])(t.revision),1),Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,ns),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,as),Object(r["createElementVNode"])("td",is,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(t.releases,(function(n,a){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:a,title:e.translate("TagManager_ReleaseInfo",n.release_login,n.release_date_pretty)},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.ucfirst(n.environment)),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,", ",512),[[r["vShow"],a!==t.releases.length-1]])],8,rs)})),128))]),Object(r["createElementVNode"])("td",os,[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.created_date_pretty),1)]),Object(r["createElementVNode"])("td",ls,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-rocket",onClick:function(n){return e.publishVersion(t)},title:e.translate("TagManager_PublishVersion",t.name)},null,8,cs),[[r["vShow"],e.hasWriteAccess&&(e.hasCustomTemplatesCapability||e.canPublishToLive)]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-bug",onClick:function(n){return e.enableDebugMode(t.idcontainerversion)},title:e.translate("TagManager_EnablePreviewDebug")},null,8,ss),[[r["vShow"],e.hasWriteAccess]]),Object(r["createElementVNode"])("a",{target:"_blank",class:"table-action icon-export",onClick:Object(r["withModifiers"])((function(n){e.exportVersion(t.idcontainerversion,t.name)}),["prevent"]),href:e.getExportUrl(t),title:e.translate("TagManager_ExportX",e.translate("TagManager_Version"))},null,8,ds),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(n){return e.editVersion(t.idcontainerversion)},title:e.translate("TagManager_EditX",e.translate("TagManager_Version"))},null,8,us),[[r["vShow"],e.hasWriteAccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(n){return e.deleteVersion(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Version"))},null,8,gs),[[r["vShow"],0===t.releases.length&&e.hasWriteAccess&&e.hasCustomTemplatesCapability]])])],8,es)})),128))])],512),[[d]]),Object(r["createElementVNode"])("div",ms,[Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createNewVersion",onClick:t[2]||(t[2]=function(t){return e.createVersion()})},[bs,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVersion")),1)],512),[[r["vShow"],e.hasWriteAccess&&e.hasCustomTemplatesCapability]]),Object(r["createElementVNode"])("a",{class:"exportDraft",target:"_blank",onClick:t[3]||(t[3]=function(t){e.exportVersion(null,"draft"),t.preventDefault()}),href:e.getExportDraftUrl()},[hs,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_ExportDraft")),1)],8,ps),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"importVersion",onClick:t[4]||(t[4]=function(t){return e.importVersion()})},[fs,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Import")),1)],512),[[r["vShow"],e.hasWriteAccess&&e.hasCustomTemplatesCapability]])])]})),_:1},8,["content-title","help-text"]),Object(r["createElementVNode"])("div",vs,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteVersionConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,js),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Os)],512),Object(r["createElementVNode"])("div",Ts,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_PublishVersion",null===(l=e.versionToBePublished)||void 0===l?void 0:l.name)),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(c,{uicontrol:"select",name:"environment",modelValue:e.availableEnvironmentsToPublish.deployEnvironment,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.availableEnvironmentsToPublish.deployEnvironment=t}),options:e.availableEnvironmentsToPublish.environnments,"full-width":!0,title:e.translate("TagManager_Environment")},null,8,["modelValue","options","title"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",{style:{"margin-bottom":"0"},class:"alert alert-info"},Object(r["toDisplayString"])(e.translate("TagManager_PublishLiveEnvironmentCapabilityRequired",e.translate("TagManager_CapabilityPublishLiveContainer"))),513),[[r["vShow"],!e.canPublishToLive]])],512),[[r["vShow"],e.availableEnvironmentsToPublish.environnments.length]]),e.availableEnvironmentsToPublish.environnments.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ys,Object(r["toDisplayString"])(e.translate("TagManager_VersionAlreadyPublishedToAllEnvironments")),1)),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("TagManager_PublishRelease")},null,8,Vs),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_Cancel")},null,8,Cs)],512)])}function Es(e){return Ms(e)||ks(e)||ws(e)||Ss()}function Ss(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ws(e,t){if(e){if("string"===typeof e)return _s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_s(e,t):void 0}}function ks(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ms(e){if(Array.isArray(e))return _s(e)}function _s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Ds=window,As=Ds.tagManagerHelper,xs=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0},versionsHelpText:String},components:{ContentBlock:u["ContentBlock"],Field:g["Field"]},directives:{ContentTable:u["ContentTable"]},data:function(){return{versionToBePublished:null,versionSearch:""}},created:function(){Zl.init(),Tc.fetchVersions(this.idContainer)},methods:{createVersion:function(){this.editVersion(0)},truncateText:function(e,t){return As.truncateText(e,t)},publishVersion:function(e){var t=this;this.versionToBePublished=e,u["Matomo"].helper.modalConfirm(this.$refs.confirmPublishVersion,{yes:function(){var n=t.availableEnvironmentsToPublish.deployEnvironment;n&&Tc.publishVersion(e.idcontainer,e.idcontainerversion,n).then((function(){Tc.reload(t.idContainer)}))}})},enableDebugMode:function(e){As.enablePreviewMode(this.idContainer,e)},exportVersion:function(e,t){var n={module:"API",method:"TagManager.exportContainerVersion",format:"json",idContainer:this.idContainer,filter_limit:-1};e&&(n.idContainerVersion=e);var a="container_".concat(this.idContainer);t&&(a+="_".concat(t)),u["AjaxHelper"].fetch(n).then((function(e){u["Matomo"].helper.sendContentAsDownload("".concat(a,".json"),JSON.stringify(e))}))},editVersion:function(e){u["MatomoUrl"].updateHash(Object.assign(Object.assign({},u["MatomoUrl"].hashParsed.value),{},{idContainerVersion:e}))},importVersion:function(){As.importVersion(this.idContainer)},deleteVersion:function(e){var t=this,n=function(){Tc.deleteVersion(t.idContainer,e.idcontainerversion).then((function(){Tc.reload(t.idContainer)}))};u["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteVersion,{yes:n})},ucfirst:function(e){return"".concat(e.substring(0,1).toUpperCase()).concat(e.substring(1))},getExportUrl:function(e){return"?module=TagManager&action=exportContainerVersion&idContainer=".concat(this.idContainer)+"&idContainerVersion=".concat(e.idcontainerversion,"&idSite=").concat(e.idsite)+"&period=day&date=yesterday"},getExportDraftUrl:function(){return"?module=TagManager&action=exportContainerVersion&idContainer=".concat(this.idContainer)+"&idSite=".concat(this.idSite,"&period=day&date=yesterday")}},computed:{environments:function(){return Zl.environmentsWithPublishOptions.value},availableEnvironmentsToPublish:function(){var e=this,t="",n=this.environments.filter((function(n){var a,i;if(null===(a=e.versionToBePublished)||void 0===a||!a.releases)return!0;var r=null===(i=e.versionToBePublished)||void 0===i?void 0:i.releases.some((function(e){return e.environment===(null===n||void 0===n?void 0:n.key)}));return r||t||(t=n.key),!r}));return{deployEnvironment:t,environnments:n}},idSite:function(){return u["Matomo"].idSite},isLoading:function(){return Tc.isLoading.value},isUpdating:function(){return Tc.isUpdating.value},versions:function(){return Tc.versions.value},sortedVersions:function(){var e=this.versionSearch.toLowerCase(),t=Es(this.versions).filter((function(t){return Object.keys(t).some((function(n){var a=t,i="";return"string"===typeof a[n]?i=a[n]:"releases"===n&&Object.values(a.releases).forEach((function(e){e.environment&&(i+="".concat(e.environment," "))})),-1!==i.toLowerCase().indexOf(e)}))}));return t.sort((function(e,t){return e.revision<t.revision?1:e.revision>t.revision?0:1})),t},hasWriteAccess:function(){return u["Matomo"].hasUserCapability("tagmanager_write")},hasCustomTemplatesCapability:function(){return u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},canPublishToLive:function(){return u["Matomo"].hasUserCapability("tagmanager_publish_live_container")},revisionTranslatedText:function(){return this.translate("TagManager_VersionsRevisionDescription")},nameTranslatedText:function(){return this.translate("TagManager_VersionsNameDescription")},descriptionTranslatedText:function(){return this.translate("TagManager_VersionsDescriptionDescription")},environmentTranslatedText:function(){return this.translate("TagManager_VersionsEnvironmentsDescription")},createdTranslatedText:function(){return this.translate("TagManager_VersionsCreatedDescription")},actionTranslatedText:function(){return this.translate("TagManager_VersionsActionDescription")}}});xs.render=Ns;var Bs=xs,Ls={class:"manageVersion"},Us={key:0},Ps={key:1};function Is(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("VersionList"),c=Object(r["resolveComponent"])("VersionEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ls,[e.editMode?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Us,[Object(r["createVNode"])(l,{"id-container":e.idContainer,"versions-help-text":e.versionsHelpText},null,8,["id-container","versions-help-text"])])),e.editMode?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Ps,[Object(r["createVNode"])(c,{"id-container":e.idContainer,"id-container-version":e.idContainerVersion},null,8,["id-container","id-container-version"])])):Object(r["createCommentVNode"])("",!0)])}var Fs=Object(r["defineComponent"])({props:{idContainer:String,versionsHelpText:String},components:{VersionList:Bs,VersionEdit:Hc},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(r["watch"])((function(){return u["MatomoUrl"].hashParsed.value.idContainerVersion}),(function(t){e.onIdContainerVersionParamChange(t)})),u["NotificationsStore"].remove("versiontagmanagement"),this.onIdContainerVersionParamChange(u["MatomoUrl"].hashParsed.value.idContainerVersion)},methods:{onIdContainerVersionParamChange:function(e){if("0"===e){var t={isAllowed:!0};u["Matomo"].postEvent("TagManager.initAddVersion",t),this.isAddAllowed=!!t.isAllowed}}},computed:{idContainerVersion:function(){var e=u["MatomoUrl"].hashParsed.value.idContainerVersion;return this.isAddAllowed||"0"!==e?e?parseInt(e,10):e:null},editMode:function(){return"number"===typeof this.idContainerVersion}}});Fs.render=Is;var Hs=Fs,Gs={class:"loadingPiwik"},$s=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Rs={class:"loadingPiwik"},qs=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),zs={class:"entityCancel"};function Ws(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("SaveButton"),s=Object(r["resolveComponent"])("ContentBlock");return Object(r["openBlock"])(),Object(r["createBlock"])(s,{class:"editContainer tagManagerManageEdit",feature:"Tag Manager","content-title":e.editTitle},{default:Object(r["withCtx"])((function(){return[Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Gs,[$s,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[r["vShow"],e.isLoading]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("p",null,[Object(r["createElementVNode"])("span",Rs,[qs,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_UpdatingData")),1)])],512),[[r["vShow"],e.isUpdating]]),Object(r["createElementVNode"])("form",{onSubmit:t[8]||(t[8]=function(t){return e.edit?e.updateContainer():e.createContainer()})},[Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createVNode"])(l,{uicontrol:"text",name:"idcontainer","model-value":e.container.idcontainer,disabled:!0,title:e.translate("General_Id")},null,8,["model-value","title"]),[[r["vShow"],e.edit]])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"select",name:"context","model-value":e.container.context,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.container.context=t,e.setValueHasChanged()}),disabled:!0,options:e.contexts,title:e.translate("TagManager_Context"),"inline-help":e.translate("TagManager_ContainerContextHelp")},null,8,["model-value","options","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"name","model-value":e.container.name,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.container.name=t,e.setValueHasChanged()}),maxlength:255,title:e.translate("General_Name"),"inline-help":e.translate("TagManager_ContainerNameHelp"),placeholder:e.translate("TagManager_ContainerNamePlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"textarea",name:"description","model-value":e.container.description,"onUpdate:modelValue":t[2]||(t[2]=function(t){e.container.description=t,e.setValueHasChanged()}),title:e.translate("TagManager_Description"),"inline-help":e.translate("TagManager_ContainerDescriptionHelp"),placeholder:e.translate("TagManager_ContainerDescriptionPlaceholder")},null,8,["model-value","title","inline-help","placeholder"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"ignoreGtmDataLayer","model-value":e.container.ignoreGtmDataLayer,"onUpdate:modelValue":t[3]||(t[3]=function(t){e.container.ignoreGtmDataLayer=t,e.setValueHasChanged()}),title:e.translate("TagManager_IgnoreGtmDataLaterTitle"),"inline-help":e.translate("TagManager_IgnoreGtmDataLaterDescription")},null,8,["model-value","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"activelySyncGtmDataLayer","model-value":e.container.activelySyncGtmDataLayer,"onUpdate:modelValue":t[4]||(t[4]=function(t){e.container.activelySyncGtmDataLayer=t,e.setValueHasChanged()}),title:e.translate("TagManager_ActivelySyncGtmDataLayerTitle"),"inline-help":e.translate("TagManager_ActivelySyncGtmDataLayerDescription")},null,8,["model-value","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"isTagFireLimitAllowedInPreviewMode","model-value":e.container.isTagFireLimitAllowedInPreviewMode,"onUpdate:modelValue":t[5]||(t[5]=function(t){e.container.isTagFireLimitAllowedInPreviewMode=t,e.setValueHasChanged()}),title:e.translate("TagManager_TagFireLimitAllowedInPreviewModeTitle"),"inline-help":e.translate("TagManager_TagFireLimitAllowedInPreviewModeDescription")},null,8,["model-value","title","inline-help"])]),Object(r["createVNode"])(c,{class:"createButton",onConfirm:t[6]||(t[6]=function(t){return e.edit?e.updateContainer():e.createContainer()}),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.edit?e.translate("CoreUpdater_UpdateTitle"):e.translate("TagManager_CreateNewContainer")},null,8,["disabled","saving","value"]),Object(r["createElementVNode"])("div",zs,[Object(r["createElementVNode"])("a",{onClick:t[7]||(t[7]=function(t){return e.cancel()})},Object(r["toDisplayString"])(e.translate("General_Cancel")),1)])])],32)]})),_:1},8,["content-title"])}function Xs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ks(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Js(e,t,n){return t&&Ks(e.prototype,t),n&&Ks(e,n),e}function Ys(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var Zs=function(){function e(){var t=this;Xs(this,e),Ys(this,"privateState",Object(r["reactive"])({contexts:[],isLoading:!1})),Ys(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),Ys(this,"isLoading",Object(r["computed"])((function(){return t.state.value.isLoading}))),Ys(this,"contexts",Object(r["computed"])((function(){return t.state.value.contexts}))),Ys(this,"contextsOptions",Object(r["computed"])((function(){return t.contexts.value.map((function(e){var t=e.id,n=e.name;return{key:t,value:n}}))}))),Ys(this,"initializePromise",null)}return Js(e,[{key:"init",value:function(){return this.initializePromise||(this.initializePromise=this.fetchAvailableContexts()),this.initializePromise}},{key:"fetchAvailableContexts",value:function(){var e=this;return this.privateState.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getAvailableContexts",filter_limit:"-1"}).then((function(t){var n;n=Array.isArray(t)?t:Object.values(t),e.privateState.contexts=n})).finally((function(){e.privateState.isLoading=!1}))}}]),e}(),Qs=new Zs;function ed(e){return id(e)||ad(e)||nd(e)||td()}function td(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function nd(e,t){if(e){if("string"===typeof e)return rd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rd(e,t):void 0}}function ad(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function id(e){if(Array.isArray(e))return rd(e)}function rd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function od(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ld(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function cd(e,t,n){return t&&ld(e.prototype,t),n&&ld(e,n),e}function sd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var dd=function(){function e(){var t=this;od(this,e),sd(this,"privateState",Object(r["reactive"])({containers:[],isLoadingContainers:!1,isLoadingSingle:!1,isUpdating:!1})),sd(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),sd(this,"isLoading",Object(r["computed"])((function(){var e=t.state.value;return e.isLoadingContainers||e.isLoadingSingle}))),sd(this,"isUpdating",Object(r["computed"])((function(){return t.state.value.isUpdating}))),sd(this,"containers",Object(r["computed"])((function(){return t.state.value.containers}))),sd(this,"fetchPromise",null)}return cd(e,[{key:"reload",value:function(){return this.privateState.containers=[],this.fetchPromise=null,this.fetchContainers()}},{key:"fetchContainers",value:function(){var e=this;return this.privateState.isLoadingContainers=!0,this.privateState.containers=[],this.fetchPromise||(this.fetchPromise=u["AjaxHelper"].fetch({method:"TagManager.getContainers",filter_limit:"-1"})),Promise.resolve(this.fetchPromise).then((function(t){return e.privateState.containers=t,e.privateState.isLoadingContainers=!1,e.containers.value})).finally((function(){e.privateState.isLoadingContainers=!1}))}},{key:"findContainer",value:function(e){var t=this,n=this.containers.value.find((function(t){return t.idcontainer===e}));return n?Promise.resolve(n):(this.privateState.isLoadingSingle=!0,u["AjaxHelper"].fetch({idContainer:e,method:"TagManager.getContainer",filter_limit:"-1"}).then((function(e){return t.privateState.containers=[].concat(ed(t.privateState.containers),[e]),Object(r["readonly"])(e)})).finally((function(){t.privateState.isLoadingSingle=!1})))}},{key:"deleteContainer",value:function(e){var t=this;return this.privateState.isUpdating=!0,this.privateState.containers=[],u["AjaxHelper"].fetch({idContainer:e,method:"TagManager.deleteContainer"},{withTokenInUrl:!0}).finally((function(){t.privateState.isUpdating=!1}))}},{key:"createOrUpdateContainer",value:function(e,t){var n=this;return this.privateState.isUpdating=!0,u["AjaxHelper"].post({method:t,idContainer:e.idcontainer},{name:e.name,description:e.description,ignoreGtmDataLayer:e.ignoreGtmDataLayer,activelySyncGtmDataLayer:e.activelySyncGtmDataLayer,isTagFireLimitAllowedInPreviewMode:e.isTagFireLimitAllowedInPreviewMode,context:e.context},{withTokenInUrl:!0}).finally((function(){n.privateState.isUpdating=!1}))}}]),e}(),ud=new dd,gd="containertagmanagement",md=Object(r["defineComponent"])({props:{idContainer:String},components:{ContentBlock:u["ContentBlock"],Field:g["Field"],SaveButton:g["SaveButton"]},data:function(){return{isDirty:!1,editTitle:"",isUpdatingVersion:!1,container:{}}},created:function(){Qs.init(),Vt.init(),this.initIdContainer()},watch:{idContainer:function(e){null!==e&&this.initIdContainer()}},methods:{removeAnyContainerNotification:function(){u["NotificationsStore"].remove(gd),u["NotificationsStore"].remove("ajaxHelper")},showNotification:function(e,t){var n=u["NotificationsStore"].show({message:e,context:t,id:gd,type:"transient"});setTimeout((function(){u["NotificationsStore"].scrollToNotification(n)}),200)},showErrorFieldNotProvidedNotification:function(e){var t=Object(u["translate"])("TagManager_ErrorXNotProvided",[e]);this.showNotification(t,"error")},initIdContainer:function(){var e=this;this.container={},u["Matomo"].helper.lazyScrollToContent(),this.edit&&this.idContainer?(this.editTitle=Object(u["translate"])("TagManager_EditContainer"),ud.findContainer(this.idContainer).then((function(t){t&&(e.container=Object(u["clone"])(t),e.isDirty=!1)}))):this.create&&(this.editTitle=Object(u["translate"])("TagManager_CreateNewContainer"),this.container={idSite:u["Matomo"].idSite,name:"",context:"web",description:"",activelySyncGtmDataLayer:!0},this.isDirty=!1)},cancel:function(){var e=Object.assign({},u["MatomoUrl"].hashParsed.value);delete e.idContainer,u["MatomoUrl"].updateHash(e)},createContainer:function(){var e=this;this.removeAnyContainerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdatingVersion=!0,ud.createOrUpdateContainer(this.container,"TagManager.addContainer").then((function(t){if(e.isUpdatingVersion=!1,t){e.isDirty=!1;var n=t.value;e.showNotification(Object(u["translate"])("TagManager_CreatedX",Object(u["translate"])("TagManager_Container")),"success"),u["MatomoUrl"].updateUrl(Object.assign(Object.assign({},u["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:"dashboard",idContainer:n}))}})).finally((function(){e.isUpdatingVersion=!1})))},setValueHasChanged:function(){this.isDirty=!0},updateContainer:function(){var e=this;this.removeAnyContainerNotification(),this.checkRequiredFieldsAreSet()&&(this.isUpdating=!0,ud.createOrUpdateContainer(this.container,"TagManager.updateContainer").then((function(t){t&&(e.isDirty=!1,e.container={},ud.reload().then((function(){e.initIdContainer()})),e.showNotification(Object(u["translate"])("TagManager_UpdatedX",Object(u["translate"])("TagManager_Container")),"success"))})))},checkRequiredFieldsAreSet:function(){if(!this.container.name){var e=Object(u["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}return!0}},computed:{contexts:function(){return Qs.contextsOptions.value},create:function(){return"0"===this.idContainer},edit:function(){return!this.create},isLoading:function(){return ft.isLoading.value||Vt.isLoading.value},isUpdating:function(){return ft.isUpdating.value||this.isUpdatingVersion}}});md.render=Ws;var bd=md,pd={class:"tagManagerManageList tagManagerContainerList"},hd=["innerHTML"],fd={class:"index"},vd={class:"name"},jd={class:"description"},Od={class:"created"},Td={class:"action"},yd={colspan:"5"},Vd={class:"loadingPiwik"},Cd=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Nd={colspan:"5"},Ed=["id"],Sd=["title"],wd=["title"],kd=["title"],Md={class:"created"},_d=["href","title"],Dd=["onClick","title"],Ad=["onClick","title"],xd=["onClick","title"],Bd=["onClick","title"],Ld={class:"tableActionBar"},Ud=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Pd={class:"ui-confirm",id:"confirmDeleteContainer",ref:"confirmDeleteContainer"},Id=["value"],Fd=["value"];function Hd(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("ContentBlock"),c=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",pd,[Object(r["createVNode"])(l,{feature:"Tag Manager","content-title":e.translate("TagManager_ManageX",e.translate("TagManager_Containers"))},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",{innerHTML:e.$sanitize(e.getManageContainersIntro)},null,8,hd),Object(r["withDirectives"])(Object(r["createElementVNode"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",fd,Object(r["toDisplayString"])(e.translate("General_Id")),1),Object(r["createElementVNode"])("th",vd,Object(r["toDisplayString"])(e.translate("General_Name")),1),Object(r["createElementVNode"])("th",jd,Object(r["toDisplayString"])(e.translate("General_Description")),1),Object(r["createElementVNode"])("th",Od,Object(r["toDisplayString"])(e.translate("TagManager_CreatedDate")),1),Object(r["createElementVNode"])("th",Td,Object(r["toDisplayString"])(e.translate("General_Actions")),1)])]),Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",yd,[Object(r["createElementVNode"])("span",Vd,[Cd,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[r["vShow"],e.isLoading||e.isUpdating]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Nd,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoContainersFound"))+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"createContainerNow",onClick:t[0]||(t[0]=function(t){return e.createContainer()})},Object(r["toDisplayString"])(e.translate("TagManager_CreateNewContainerNow")),513),[[r["vShow"],e.hasWriteAccess]])])],512),[[r["vShow"],!e.isLoading&&0===e.containers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedContainers,(function(t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{id:"container".concat(t.idcontainer),class:"containers",key:t.idcontainer},[Object(r["createElementVNode"])("td",{class:"index",title:"".concat(e.translate("TagManager_Context"),": ")+e.contexts[t.context]},Object(r["toDisplayString"])(t.idcontainer),9,Sd),Object(r["createElementVNode"])("td",{class:"name",title:t.name},Object(r["toDisplayString"])(e.truncateText(t.name,50)),9,wd),Object(r["createElementVNode"])("td",{class:"description",title:t.description},Object(r["toDisplayString"])(e.truncateText(t.description,75)),9,kd),Object(r["createElementVNode"])("td",Md,[Object(r["createElementVNode"])("span",null,Object(r["toDisplayString"])(t.created_date_pretty),1)]),Object(r["createElementVNode"])("td",{class:Object(r["normalizeClass"])(e.getActionClasses)},[Object(r["createElementVNode"])("a",{class:"table-action icon-configure",href:"?module=TagManager&action="+e.containerDefaultAction+"&idContainer="+t.idcontainer+"&idSite="+t.idsite+"&period=day&date=yesterday",title:e.translate("TagManager_ConfigureX",e.translate("TagManager_Container"))},null,8,_d),Object(r["createElementVNode"])("a",{class:"table-action installCode icon-embed",onClick:function(n){return e.installCode(t.idcontainer)},title:e.translate("TagManager_InstallCode")},null,8,Dd),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-edit",onClick:function(n){return e.editContainer(t.idcontainer)},title:e.translate("TagManager_EditX",e.translate("TagManager_Container"))},null,8,Ad),[[r["vShow"],e.hasWriteAccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-delete",onClick:function(n){return e.deleteContainer(t)},title:e.translate("TagManager_DeleteX",e.translate("TagManager_Container"))},null,8,xd),[[r["vShow"],e.hasWriteAccess]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("a",{class:"table-action icon-content-copy",onClick:function(n){return e.openCopyDialog(t)},title:e.translate("TagManager_CopyX",e.translate("TagManager_Container"))},null,8,Bd),[[r["vShow"],e.canCopyContainer]])],2)],8,Ed)})),128))])],512),[[c]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Ld,[Object(r["createElementVNode"])("a",{class:"createNewContainer",value:"",onClick:t[1]||(t[1]=function(t){return e.createContainer()})},[Ud,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewContainer")),1)])],512),[[r["vShow"],e.hasWriteAccess]])]})),_:1},8,["content-title"]),Object(r["createElementVNode"])("div",Pd,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_DeleteContainerConfirm")),1),Object(r["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Id),Object(r["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Fd)],512)])}function Gd(e){return zd(e)||qd(e)||Rd(e)||$d()}function $d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Rd(e,t){if(e){if("string"===typeof e)return Wd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wd(e,t):void 0}}function qd(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function zd(e){if(Array.isArray(e))return Wd(e)}function Wd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Xd=window,Kd=Xd.tagManagerHelper,Jd=Object(r["defineComponent"])({props:{isSuperUser:{type:Boolean,required:!0}},components:{ContentBlock:u["ContentBlock"]},directives:{ContentTable:u["ContentTable"]},created:function(){Qs.init(),ud.fetchContainers()},computed:{contexts:function(){var e={};return Qs.contexts.value.forEach((function(t){var n=t.id,a=t.name;e[n]=a})),e},hasWriteAccess:function(){return u["Matomo"].hasUserCapability("tagmanager_write")},containerDefaultAction:function(){return this.hasWriteAccess?"dashboard":"manageTags"},isLoading:function(){return Tc.isLoading.value},isUpdating:function(){return Tc.isUpdating.value},containers:function(){return ud.containers.value},sortedContainers:function(){var e=Gd(this.containers);return e.sort((function(e,t){return e.created_date<t.created_date?1:e.created_date>t.created_date?-1:0})),e},getManageContainersIntro:function(){var e=Object(u["externalLink"])("https://matomo.org/guide/tag-manager/getting-started-with-tag-manager/");return Object(u["translate"])("TagManager_ManageContainersIntro",e,"</a>")},canCopyContainer:function(){return u["Matomo"].hasUserCapability("tagmanager_write")&&u["Matomo"].hasUserCapability("tagmanager_use_custom_templates")},getActionClasses:function(){var e=this.canCopyContainer?" hasCopyAction":"";return"action".concat(e)}},methods:{createContainer:function(){this.editContainer("0")},editContainer:function(e){u["MatomoUrl"].updateHash(Object.assign(Object.assign({},u["MatomoUrl"].hashParsed.value),{},{idContainer:e}))},installCode:function(e){Kd.showInstallCode(e)},deleteContainer:function(e){function t(){ud.deleteContainer(e.idcontainer).then((function(){ud.reload(),u["NotificationsStore"].remove("CopyDialogResultNotification")}))}u["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteContainer,{yes:t})},truncateText:function(e,t){return e.length>t?"".concat(e.substr(0,t-3),"..."):e},openCopyDialog:function(e){var t=u["MatomoUrl"].stringify({module:"TagManager",action:"copyContainerDialog",idSite:e.idsite,idContainer:e.idcontainer});window.Piwik_Popover.createPopupAndLoadUrl(t,"","mtmCopyContainer")}}});Jd.render=Hd;var Yd=Jd,Zd={class:"manageContainer"};function Qd(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("ContainerList"),c=Object(r["resolveComponent"])("ContainerEdit");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Zd,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{"is-super-user":e.isSuperUser},null,8,["is-super-user"])],512),[[r["vShow"],!e.editMode]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(c,{"id-container":e.idContainer},null,8,["id-container"])],512),[[r["vShow"],e.editMode]])])}var eu=Object(r["defineComponent"])({props:{isSuperUser:{type:Boolean,required:!0}},components:{ContainerList:Yd,ContainerEdit:bd},data:function(){return{isAddAllowed:!1}},created:function(){var e=this;Object(r["watch"])((function(){return u["MatomoUrl"].hashParsed.value.idContainer}),(function(t){e.onIdContainerParamChange(t)})),u["NotificationsStore"].remove("containertagmanagement"),this.onIdContainerParamChange(u["MatomoUrl"].hashParsed.value.idContainer)},computed:{idContainer:function(){var e=u["MatomoUrl"].hashParsed.value.idContainer;return this.isAddAllowed||""!==e?e:null},editMode:function(){return!!this.idContainer}},methods:{onIdContainerParamChange:function(e){if("0"===e){var t={isAllowed:!0};u["Matomo"].postEvent("TagManager.initAddVersion",t),this.isAddAllowed=!!t.isAllowed}}}});eu.render=Qd;var tu=eu,nu={class:"containerDashboard"},au={key:0},iu={class:"dashboardCreationDate"},ru={key:0},ou=Object(r["createElementVNode"])("br",null,null,-1),lu=["innerHTML"],cu={class:"row",style:{"margin-left":"-0.75rem"}},su={class:"col m6 s12"},du={key:0},uu=["href","title"],gu={key:0},mu=Object(r["createElementVNode"])("hr",null,null,-1),bu=["href"],pu=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),hu=["href"],fu=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),vu={class:"col m6 s12"},ju={key:0},Ou=["href","title"],Tu=Object(r["createElementVNode"])("hr",null,null,-1),yu=["href"],Vu=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),Cu=["href"],Nu=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Eu={class:"row",style:{"margin-left":"-0.75rem"}},Su={class:"col m6 s12"},wu=["href","title"],ku={key:0},Mu=Object(r["createElementVNode"])("hr",null,null,-1),_u=["href"],Du=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),Au=["href"],xu=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1),Bu={class:"col m6 s12"},Lu=["title","href"],Uu={key:0},Pu=Object(r["createElementVNode"])("br",null,null,-1),Iu=["title"],Fu={key:0},Hu=Object(r["createElementVNode"])("hr",null,null,-1),Gu=["href"],$u=Object(r["createElementVNode"])("span",{class:"icon-edit"}," ",-1),Ru=["href"],qu=Object(r["createElementVNode"])("span",{class:"icon-add"}," ",-1);function zu(e,t,n,a,i,o){var l,c,s=Object(r["resolveComponent"])("ActivityIndicator"),d=Object(r["resolveComponent"])("EnrichedHeadline"),u=Object(r["resolveComponent"])("ContentBlock"),g=Object(r["resolveDirective"])("content-intro");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",nu,[Object(r["createVNode"])(s,{loading:e.isLoading},null,8,["loading"]),e.isLoading?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",au,[Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("h2",null,[Object(r["createVNode"])(d,{"feature-name":"Tag Manager","inline-help":e.dashboardHelpText},{default:Object(r["withCtx"])((function(){var t;return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_ContainerX",null===(t=e.container)||void 0===t?void 0:t.name)),1)]})),_:1},8,["inline-help"])]),Object(r["createElementVNode"])("p",iu,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.containerMetaInformation)+" ",1),null!==(l=e.containerVersion)&&void 0!==l&&l.description?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",ru,[ou,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_Description"))+": "+Object(r["toDisplayString"])(null===(c=e.containerVersion)||void 0===c?void 0:c.description),1)])):Object(r["createCommentVNode"])("",!0)]),Object(r["createElementVNode"])("p",{innerHTML:e.$sanitize(e.containerDashboardDescription)},null,8,lu)],512),[[g]]),Object(r["createElementVNode"])("div",cu,[Object(r["createElementVNode"])("div",su,[Object(r["createVNode"])(u,{feature:"Tag Manager","content-title":"".concat(e.tagCount," ").concat(e.translate("TagManager_Tags")),"help-text":e.tagsHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,[e.tagCount?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",du,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Names"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedContainerVersionTags,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n},[Object(r["createElementVNode"])("a",{href:e.linkTo("manageTags",{idTag:t.idtag}),title:e.translate("TagManager_EntityDateTypeMetaInformation",t.created_date_pretty,t.updated_date_pretty,t.type)},Object(r["toDisplayString"])(t.name),9,uu),n!==e.sortedContainerVersionTags.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",gu,", ")):Object(r["createCommentVNode"])("",!0)])})),128))])):Object(r["createCommentVNode"])("",!0)]),mu,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTags")},[pu,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditTags")),1)],8,bu),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTags",{idTag:0})},[fu,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTag")),1)],8,hu)]})),_:1},8,["content-title","help-text"])]),Object(r["createElementVNode"])("div",vu,[Object(r["createVNode"])(u,{feature:"Tag Manager","content-title":"".concat(e.triggerCount," ").concat(e.translate("TagManager_Triggers")),"help-text":e.triggersHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,[e.triggerCount?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",ju,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Names"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedTriggers,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n},[Object(r["createElementVNode"])("a",{href:e.linkTo("manageTriggers",{idTrigger:t.idtrigger}),title:e.translate("TagManager_EntityDateTypeMetaInformation",t.created_date_pretty,t.updated_date_pretty,t.type)},Object(r["toDisplayString"])(t.name),9,Ou),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,", ",512),[[r["vShow"],n!==e.sortedTriggers.length-1]])])})),128))])):Object(r["createCommentVNode"])("",!0)]),Tu,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTriggers")},[Vu,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditTriggers")),1)],8,yu),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageTriggers",{idTrigger:0})},[Nu,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewTrigger")),1)],8,Cu)]})),_:1},8,["content-title","help-text"])])]),Object(r["createElementVNode"])("div",Eu,[Object(r["createElementVNode"])("div",Su,[Object(r["createVNode"])(u,{feature:"Tag Manager","content-title":"".concat(e.variableCount," ").concat(e.translate("TagManager_Variables")),"help-text":e.variablesHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_Names"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedVariables,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n},[Object(r["createElementVNode"])("a",{href:e.linkTo("manageVariables",{idVariable:t.idvariable}),title:e.translate("TagManager_EntityDateTypeMetaInformation",t.created_date_pretty,t.updated_date_pretty,t.type)},Object(r["toDisplayString"])(t.name),9,wu),n!==e.sortedVariables.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",ku,", ")):Object(r["createCommentVNode"])("",!0)])})),128))],512),[[r["vShow"],e.variableCount]])]),Mu,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVariables")},[Du,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditVariables")),1)],8,_u),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVariables",{idVariable:0})},[xu,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVariable")),1)],8,Au)]})),_:1},8,["content-title","help-text"])]),Object(r["createElementVNode"])("div",Bu,[Object(r["createVNode"])(u,{feature:"Tag Manager","content-title":"".concat(e.versionCount," ").concat(e.translate("TagManager_Versions")),"help-text":e.versionsHelpText},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_LastVersions"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.lastVersions,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n},[Object(r["createElementVNode"])("a",{title:e.lastVersionLinkTitle(t),href:e.linkTo("manageVersions",{idContainerVersion:t.idcontainerversion})},Object(r["toDisplayString"])(t.name),9,Lu),n!==e.lastVersions.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Uu,", ")):Object(r["createCommentVNode"])("",!0)])})),128))],512),[[r["vShow"],e.lastVersions.length]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",null,[Pu,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("TagManager_Environments"))+": ",1),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.container.releases,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:n},[Object(r["createElementVNode"])("span",{title:e.releaseTooltip(t)},Object(r["toDisplayString"])(e.ucfirst(t.environment)),9,Iu),n!==e.container.releases.length-1?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",Fu,", ")):Object(r["createCommentVNode"])("",!0)])})),128))],512),[[r["vShow"],e.container.releases.length]])]),Hu,Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVersions")},[$u,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_EditVersions")),1)],8,Gu),Object(r["createElementVNode"])("a",{class:"btn-flat",href:e.linkTo("manageVersions",{idContainerVersion:0})},[qu,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_CreateNewVersion")),1)],8,Ru)]})),_:1},8,["content-title","help-text"])])])]))])}function Wu(e){e.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}))}var Xu=Object(r["defineComponent"])({props:{idContainer:String,dashboardHelpText:String,tagsHelpText:String,triggersHelpText:String,variablesHelpText:String,versionsHelpText:String},components:{ActivityIndicator:u["ActivityIndicator"],EnrichedHeadline:u["EnrichedHeadline"],ContentBlock:u["ContentBlock"]},directives:{ContentIntro:u["ContentIntro"]},data:function(){return{container:null,containerVersion:null,isLoading:!1}},created:function(){var e=this;Qs.init(),this.isLoading=!0;var t=u["AjaxHelper"].fetch({method:"TagManager.getContainer",idContainer:this.idContainer}).then((function(t){e.container=t})),n=u["AjaxHelper"].fetch({method:"TagManager.exportContainerVersion",idContainer:this.idContainer}).then((function(t){e.containerVersion=t}));Promise.all([t,n]).finally((function(){e.isLoading=!1}))},methods:{linkTo:function(e,t){var n=u["MatomoUrl"].stringify(Object.assign(Object.assign({},u["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:e}));return t&&(n+="#?".concat(u["MatomoUrl"].stringify(t))),"?".concat(n)},lastVersionLinkTitle:function(e){return"Created on ".concat(e.created_date_pretty)+", description: '".concat(e.description,"'")},releaseTooltip:function(e){var t=Object(u["translate"])("TagManager_ReleaseInfo",e.release_login,e.release_date_pretty),n=Object(u["translate"])("TagManager_ReleaseVersionInfo",e.version_name);return"".concat(t," ").concat(n)},ucfirst:function(e){return"".concat(e.substr(0,1).toUpperCase()).concat(e.substr(1))}},computed:{lastVersions:function(){var e,t;return null!==(e=this.container)&&void 0!==e&&null!==(t=e.versions)&&void 0!==t&&t.length?this.container.versions.slice(0,5):[]},contexts:function(){var e={};return Qs.contexts.value.forEach((function(t){var n=t.id,a=t.name;e[n]=a})),e},containerMetaInformation:function(){var e;return Object(u["translate"])("TagManager_ContainerIdInformation",(null===(e=this.containerVersion)||void 0===e?void 0:e.idcontainer)||"")},containerDashboardDescription:function(){var e=Object(u["externalLink"])("https://matomo.org/guide/tag-manager/getting-started-with-tag-manager/");return Object(u["translate"])("TagManager_ContainerDashboardDescription",e,"</a>")},sortedContainerVersionTags:function(){var e,t=(null===(e=this.containerVersion)||void 0===e?void 0:e.tags)||[];return Wu(t),t},sortedTriggers:function(){var e,t=(null===(e=this.containerVersion)||void 0===e?void 0:e.triggers)||[];return Wu(t),t},sortedVariables:function(){var e,t=(null===(e=this.containerVersion)||void 0===e?void 0:e.variables)||[];return Wu(t),t},tagCount:function(){var e;return null===(e=this.containerVersion)||void 0===e?void 0:e.tags.length},triggerCount:function(){var e;return null===(e=this.containerVersion)||void 0===e?void 0:e.triggers.length},versionCount:function(){var e;return null===(e=this.container)||void 0===e?void 0:e.versions.length},variableCount:function(){var e;return null===(e=this.containerVersion)||void 0===e?void 0:e.variables.length}}});Xu.render=zu;var Ku=Xu,Ju=["title"],Yu={class:"title"},Zu=Object(r["createElementVNode"])("span",{class:"icon icon-chevron-down"}," ",-1),Qu={class:"dropdown positionInViewport"},eg={class:"custom_select_container"},tg={class:"custom_select_ul_list"},ng=["title"],ag=["href"];function ig(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("ActivityIndicator"),c=Object(r["resolveDirective"])("focus-anywhere-but-here");return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{class:Object(r["normalizeClass"])(["tagContainerSelector piwikSelector borderedControl",{expanded:e.showContainerList}]),onClick:t[1]||(t[1]=function(t){e.fetchContainers(),e.showContainerList=!e.showContainerList}),title:e.translate("TagManager_ChooseContainer")},[Object(r["createElementVNode"])("a",Yu,[Zu,Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.truncateText(e.actualContainerName,50)),1)]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",Qu,[Object(r["createVNode"])(l,{loading:e.isLoading},null,8,["loading"]),Object(r["createElementVNode"])("div",eg,[Object(r["createElementVNode"])("ul",tg,[Object(r["withDirectives"])(Object(r["createElementVNode"])("li",null,[Object(r["createElementVNode"])("a",{tabindex:"-1",onClick:t[0]||(t[0]=Object(r["withModifiers"])((function(){}),["prevent","stop"]))},Object(r["toDisplayString"])(e.translate("TagManager_NoContainersFound")),1)],512),[[r["vShow"],!e.isLoading&&0===e.containers.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.containers,(function(t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{title:"".concat(t.name," (").concat(t.idcontainer,")"),key:t.idcontainer},[Object(r["createElementVNode"])("a",{href:e.linkTo(t.idcontainer)},Object(r["toDisplayString"])(t.name)+" ("+Object(r["toDisplayString"])(t.idcontainer)+") ",9,ag)],8,ng)})),128))])])],512),[[r["vShow"],e.showContainerList]])],10,Ju)),[[c,{blur:e.onBlur}]])}var rg=window,og=rg.tagManagerHelper,lg=Object(r["defineComponent"])({props:{containerName:String},components:{ActivityIndicator:u["ActivityIndicator"]},directives:{FocusAnywhereButHere:u["FocusAnywhereButHere"]},data:function(){return{containers:[],isLoading:!1,showContainerList:!1}},created:function(){setTimeout((function(){window.initTopControls()}))},methods:{fetchContainers:function(){var e=this;this.isLoading=!0,this.containers=[],u["AjaxHelper"].fetch({method:"TagManager.getContainers"}).then((function(t){e.containers=t})).finally((function(){e.isLoading=!1}))},linkTo:function(e){var t=u["MatomoUrl"].urlParsed.value.action;t&&"manageContainers"!==t||(t=this.hasWriteAccess?"dashboard":"manageTags");var n=u["MatomoUrl"].stringify(Object.assign(Object.assign({},u["MatomoUrl"].urlParsed.value),{},{idContainer:e,action:t}));return"".concat(window.location.pathname,"?").concat(n)},onBlur:function(){this.showContainerList=!1},truncateText:function(e,t){return og.truncateText(e,t)}},computed:{actualContainerName:function(){return this.containerName?Object(u["translate"])("TagManager_ContainerX",this.containerName):Object(u["translate"])("TagManager_ChooseContainer")},hasWriteAccess:function(){return u["Matomo"].hasUserCapability("tagmanager_write")}}});lg.render=ig;var cg=lg,sg={style:{"margin-left":"-0.75rem"}},dg=Object(r["createElementVNode"])("br",null,null,-1),ug=["href"],gg=["textContent"],mg={style:{"margin-top":"1rem"}},bg=["innerHTML"],pg=Object(r["createElementVNode"])("br",null,null,-1),hg=["href"],fg={class:"environment"},vg={class:"name"},jg={class:"name"},Og={class:"released_by"},Tg={class:"released_on"},yg={key:0},Vg={colspan:"7"},Cg={class:"loadingPiwik"},Ng=Object(r["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),Eg={key:1},Sg={colspan:"7"},wg={class:"environment"},kg={class:"name"},Mg={class:"revision"},_g={class:"released_by"},Dg={class:"released_on"},Ag={class:"date"};function xg(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveComponent"])("ActivityIndicator"),s=Object(r["resolveComponent"])("ContentBlock"),d=Object(r["resolveDirective"])("copy-to-clipboard"),u=Object(r["resolveDirective"])("content-table");return Object(r["openBlock"])(),Object(r["createBlock"])(s,{class:"manageInstallTagCode",feature:"Tag Manager","content-title":"Install Code"},{default:Object(r["withCtx"])((function(){var n,a;return[Object(r["createElementVNode"])("div",sg,[Object(r["createVNode"])(l,{uicontrol:"select",name:"environment","model-value":e.environment,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.environment=t,e.fetchInstallInstructions(e.environment)}),options:e.environments,title:e.translate("TagManager_Environment")},null,8,["model-value","options","title"])]),Object(r["createVNode"])(c,{loading:e.isLoading},null,8,["loading"]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.installInstructions,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:n},[Object(r["createElementVNode"])("p",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.description)+" ",1),dg,t.helpUrl?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,target:"_blank",href:t.helpUrl},Object(r["toDisplayString"])(e.translate("TagManager_LearnMore")),9,ug)):Object(r["createCommentVNode"])("",!0)]),Object(r["createElementVNode"])("div",null,[t.embedCode?Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("pre",{key:0,textContent:Object(r["toDisplayString"])(t.embedCode)},null,8,gg)),[[d,{}]]):Object(r["createCommentVNode"])("",!0)])])})),128)),Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_InstallCodePublishEnvironmentNote","preview"))+" "+Object(r["toDisplayString"])(e.translate("TagManager_ConfigureEnvironmentsSuperUser")),1),Object(r["createElementVNode"])("p",mg,[Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.translate("TagManager_InstallCodeDataLayerNote","<strong>","</strong>"))},null,8,bg),pg,Object(r["createElementVNode"])("a",{target:"_blank",href:e.externalRawLink("https://matomo.org/faq/tag-manager/data-layer-in-matomo-tag-manager/")},Object(r["toDisplayString"])(e.translate("TagManager_LearnMore")),9,hg)]),Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.translate("TagManager_ReleasesOverview")),1),Object(r["withDirectives"])(Object(r["createElementVNode"])("table",null,[Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",fg,Object(r["toDisplayString"])(e.translate("TagManager_Environment")),1),Object(r["createElementVNode"])("th",vg,Object(r["toDisplayString"])(e.translate("TagManager_VersionName")),1),Object(r["createElementVNode"])("th",jg,Object(r["toDisplayString"])(e.translate("TagManager_VersionRevision")),1),Object(r["createElementVNode"])("th",Og,Object(r["toDisplayString"])(e.translate("TagManager_ReleasedBy")),1),Object(r["createElementVNode"])("th",Tg,Object(r["toDisplayString"])(e.translate("TagManager_ReleasedOn")),1)])]),Object(r["createElementVNode"])("tbody",null,[e.isLoading?(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",yg,[Object(r["createElementVNode"])("td",Vg,[Object(r["createElementVNode"])("span",Cg,[Ng,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("General_LoadingData")),1)])])])):Object(r["createCommentVNode"])("",!0),e.isLoading||0!==(null===(n=e.container)||void 0===n||null===(a=n.releases)||void 0===a?void 0:a.length)?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Eg,[Object(r["createElementVNode"])("td",Sg,Object(r["toDisplayString"])(e.translate("TagManager_NoReleasesFound")),1)])),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.sortedReleases,(function(t){var n,a;return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t.idcontainerrelease},[Object(r["createElementVNode"])("td",wg,Object(r["toDisplayString"])(e.ucfirst(t.environment)),1),Object(r["createElementVNode"])("td",kg,Object(r["toDisplayString"])(null===(n=e.releaseVersions[t.idcontainerrelease])||void 0===n?void 0:n.name),1),Object(r["createElementVNode"])("td",Mg,Object(r["toDisplayString"])(null===(a=e.releaseVersions[t.idcontainerrelease])||void 0===a?void 0:a.revision),1),Object(r["createElementVNode"])("td",_g,Object(r["toDisplayString"])(t.release_login),1),Object(r["createElementVNode"])("td",Dg,[Object(r["createElementVNode"])("span",Ag,Object(r["toDisplayString"])(t.release_date_pretty),1)])])})),128))])],512),[[u]])]})),_:1})}function Bg(e){return Pg(e)||Ug(e)||Hg(e)||Lg()}function Lg(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ug(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Pg(e){if(Array.isArray(e))return Gg(e)}function Ig(e,t){return Rg(e)||$g(e,t)||Hg(e,t)||Fg()}function Fg(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Hg(e,t){if(e){if("string"===typeof e)return Gg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gg(e,t):void 0}}function Gg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function $g(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(r.push(a.value),t&&r.length===t)break}catch(c){l=!0,i=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(l)throw i}}return r}}function Rg(e){if(Array.isArray(e))return e}var qg=window,zg=qg.$,Wg=Object(r["defineComponent"])({props:{idContainer:{type:String,required:!0}},components:{ContentBlock:u["ContentBlock"],Field:g["Field"],ActivityIndicator:u["ActivityIndicator"]},directives:{SelectOnFocus:u["SelectOnFocus"],ContentTable:u["ContentTable"],CopyToClipboard:u["CopyToClipboard"]},data:function(){return{container:null,environments:[],environment:"live",installInstructions:[],isLoading:!1,isLoadingInstructions:!1}},created:function(){var e=this;this.isLoading=!0,this.fetchReleases().finally((function(){e.isLoading=!1}))},methods:{fetchInstallInstructions:function(e){var t=this;return this.installInstructions=[],this.isLoadingInstructions=!0,u["AjaxHelper"].fetch({method:"TagManager.getContainerInstallInstructions",filter_limit:"-1",idContainer:this.idContainer,environment:e}).then((function(e){t.installInstructions=e,Object(r["nextTick"])((function(){var e=Array.isArray(t.$refs.codeblock)?t.$refs.codeblock:[t.$refs.codeblock];e.forEach((function(e){zg(e).effect("highlight",{},1500)}))}))})).finally((function(){t.isLoadingInstructions=!1}))},fetchReleases:function(){var e=this;return u["AjaxHelper"].fetch([{method:"TagManager.getAvailableEnvironments",filter_limit:"-1"},{method:"TagManager.getContainer",idContainer:this.idContainer,filter_limit:"-1"}]).then((function(t){var n,a,i=Ig(t,2),r=i[0],o=i[1];e.environments=r.map((function(e){return{key:e.id,value:e.name}})),e.container=o;var l=o.releases.some((function(e){return"live"===e.environment}));if(!l&&null!==(n=e.environments)&&void 0!==n&&null!==(a=n[0])&&void 0!==a&&a.key?e.environment=e.environments[0].key:l||(e.environment=""),e.environment)return e.fetchInstallInstructions(e.environment)}))},ucfirst:function(e){return"".concat(e.substr(0,1).toUpperCase()).concat(e.substr(1))}},computed:{releaseVersions:function(){var e,t=this,n={};return((null===(e=this.container)||void 0===e?void 0:e.releases)||[]).forEach((function(e){n[e.idcontainerrelease]=t.container.versions.find((function(t){return t.idcontainerversion===e.idcontainerversion}))})),n},sortedReleases:function(){var e,t=Bg(((null===(e=this.container)||void 0===e?void 0:e.releases)||[]).map((function(e,t){return Object.assign(Object.assign({},e),{},{index:t})})));return t.sort((function(e,t){return e.release_date<t.release_date?1:e.release_date>t.release_date?-1:t.index-e.index})),t}}});Wg.render=xg;var Xg=Wg,Kg={class:"tagManagerTrackingCode"},Jg={key:0},Yg={class:"trackingCodeAdvancedOptions"},Zg={class:"advance-option"},Qg=Object(r["createElementVNode"])("span",{class:"icon-chevron-down"},null,-1),em=Object(r["createElementVNode"])("span",{class:"icon-chevron-up"},null,-1),tm={id:"mtm-advanced-options"},nm=["innerHTML"],am={key:1,class:"row"},im={class:"col s12 m4 "},rm={class:"form-group row"},om={class:"col s12 input-field"},lm={for:"tagManagerTrackingCodeSite",class:"siteSelectorLabel"},cm={class:"sites_autocomplete"},sm={class:"col s12 m4"},dm={class:"col s12 m4"},um=["innerHTML"],gm={key:1,class:"alert alert-info"},mm={href:""},bm={key:0},pm=["href"],hm=Object(r["createTextVNode"])(". "),fm=["innerHTML"],vm=["textContent"],jm=["innerHTML"],Om={key:1};function Tm(e,t,n,a,i,o){var l=this,c=Object(r["resolveComponent"])("ActivityIndicator"),s=Object(r["resolveComponent"])("SiteSelector"),d=Object(r["resolveComponent"])("Field"),u=Object(r["resolveDirective"])("copy-to-clipboard");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Kg,[e.showContainerRow?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",Jg,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_OptionallyCustomiseContainer"))+" ",1),Object(r["createElementVNode"])("div",Yg,[Object(r["createElementVNode"])("div",Zg,[Object(r["createElementVNode"])("span",null,[e.isAdvancedDisplayed?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,href:"javascript:;",onClick:t[0]||(t[0]=Object(r["withModifiers"])((function(t){return e.isAdvancedDisplayed=!0}),["prevent"]))},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("CoreAdminHome_ShowAdvancedOptions"))+" ",1),Qg])),e.isAdvancedDisplayed?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:1,href:"javascript:;",onClick:t[1]||(t[1]=Object(r["withModifiers"])((function(t){return e.isAdvancedDisplayed=!1}),["prevent"]))},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("CoreAdminHome_HideAdvancedOptions"))+" ",1),em])):Object(r["createCommentVNode"])("",!0)])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",tm,[Object(r["createElementVNode"])("ul",null,[Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.getAdvancedStepText)},null,8,nm),e.showContainerRow||e.environments.length>1?Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createBlock"])(c,{key:0,loading:!0},null,512)),[[r["vShow"],e.isLoading]]):Object(r["createCommentVNode"])("",!0),e.showContainerRow||e.environments.length>1?Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",am,[Object(r["createElementVNode"])("div",im,[Object(r["createElementVNode"])("div",rm,[Object(r["createElementVNode"])("div",om,[Object(r["createElementVNode"])("label",lm,Object(r["toDisplayString"])(e.translate("General_Website")),1),Object(r["createElementVNode"])("div",cm,[Object(r["createVNode"])(s,{id:"tagManagerTrackingCodeSite",modelValue:e.site,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.site=t}),"show-all-sites-item":!1,"switch-site-on-select":!1,"show-selected-site":!0},null,8,["modelValue"])])])])]),Object(r["createElementVNode"])("div",sm,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(d,{uicontrol:"select",name:"containers","model-value":e.idContainer,"onUpdate:modelValue":t[3]||(t[3]=function(t){e.idContainer=t,e.onContainerChange()}),options:e.containerOptions,disabled:e.containerOptions.length<=1,"full-width":!0,title:e.translate("TagManager_Container")},null,8,["model-value","options","disabled","title"])])]),Object(r["createElementVNode"])("div",dm,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(d,{uicontrol:"select",name:"environment","model-value":e.environment,"onUpdate:modelValue":t[4]||(t[4]=function(t){e.environment=t,l.$emit("fetchInstallInstructions")}),options:e.environments,disabled:e.environments.length<=1,"full-width":!0,title:e.translate("TagManager_Environment")},null,8,["model-value","options","disabled","title"])])])],512)),[[r["vShow"],!e.isLoading]]):Object(r["createCommentVNode"])("",!0),e.idContainer?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:2,innerHTML:e.$sanitize(e.getAdvancedStepInfo)},null,8,um)):Object(r["createCommentVNode"])("",!0)])],512),[[r["vShow"],e.isAdvancedDisplayed]])])])):Object(r["createCommentVNode"])("",!0),e.idContainer&&e.noReleaseFound?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",gm,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("TagManager_NoReleasesFoundForContainer"))+" ",1),Object(r["createElementVNode"])("a",mm,Object(r["toDisplayString"])(e.translate("TagManager_PublishVersionToEnvironmentToViewEmbedCode")),1)])):Object(r["createCommentVNode"])("",!0),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.installInstructions,(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:n},[e.showDescription?(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",bm,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.description)+" ",1),t.helpUrl?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,target:"_blank",href:t.helpUrl},Object(r["toDisplayString"])(e.translate("TagManager_LearnMore")),9,pm)):Object(r["createCommentVNode"])("",!0),hm])):Object(r["createCommentVNode"])("",!0),e.showPlainMtmSteps?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{key:1,innerHTML:e.$sanitize(e.getMtmStep3)},null,8,fm)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("div",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("pre",{class:"codeblock",textContent:Object(r["toDisplayString"])(t.embedCode),ref:"codeblock"},null,8,vm),[[u,{}]])])],64)})),128)),e.showBottom&&!e.noReleaseFound&&e.idContainer?(Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:2},[e.showTestSection?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",Om,[(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])(e.testComponent),{site:e.site},null,8,["site"]))])):(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",{key:0,innerHTML:e.$sanitize(e.getCongratulationsText)},null,8,jm))],64)):Object(r["createCommentVNode"])("",!0)])}function ym(e){return"".concat(e.substr(0,1).toUpperCase()).concat(e.substr(1))}var Vm=Object(r["defineComponent"])({props:{showContainerRow:Boolean,showBottom:Boolean,showDescription:Boolean,showPlainMtmSteps:Boolean,showTestSection:Boolean,showAdvancedOptions:{required:!1,type:Boolean,default:!1}},components:{ActivityIndicator:u["ActivityIndicator"],SiteSelector:u["SiteSelector"],Field:g["Field"]},emits:["fetchInstallInstructions"],directives:{CopyToClipboard:u["CopyToClipboard"]},data:function(){return{containerVariables:[],isLoading:!1,idContainer:"",environment:"",environments:[],environmentNameMap:{},containerMap:{},containerOptions:[],site:{id:u["Matomo"].idSite,name:u["Matomo"].helper.htmlDecode(u["Matomo"].siteName)},matomoConfigs:[],releases:[],installInstructions:[],noReleaseFound:!1,isAdvancedDisplayed:!1}},created:function(){var e=this;u["AjaxHelper"].fetch({method:"TagManager.getAvailableEnvironments",filter_limit:"-1"}).then((function(t){var n;n=Array.isArray(t)?t:Object.values(t),e.environmentNameMap=Object.fromEntries(n.map((function(e){var t=e.id,n=e.name;return[t,n]})))})),this.onSiteChange(),this.isAdvancedDisplayed=this.showAdvancedOptions},watch:{site:function(){this.onSiteChange()}},methods:{onSiteChange:function(){var e,t=this;this.installInstructions=[],this.containerOptions=[],this.containerMap={},this.environments=[],this.matomoConfigs=[],this.idContainer="",null!==(e=this.site)&&void 0!==e&&e.id&&(this.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getContainers",filter_limit:"-1",idSite:this.site.id}).then((function(e){if(t.containerOptions=[],null===e||void 0===e||!e.length)return t.idContainer="",t.isAdvancedDisplayed=!0,void t.containerOptions.push({key:"",value:t.translate("TagManager_NoContainersFound")});e.forEach((function(e){t.idContainer||(t.idContainer=e.idcontainer),t.containerMap[e.idcontainer]=e,t.containerOptions.push({key:e.idcontainer,value:e.name})})),t.onContainerChange()})).finally((function(){t.isLoading=!1})))},onContainerChange:function(){var e=this;if(this.noReleaseFound=!1,this.idContainer){this.installInstructions=[];var t=this.containerMap[this.idContainer],n=t.draft.idcontainerversion;this.environment="",this.environments=[];var a=t.releases||[];a.find((function(e){return"live"===e.environment}))&&(this.environment="live"),a.forEach((function(t){if("preview"!==t.environment){e.environment||(e.environment=t.environment);var n=ym(t.environment);t.environment in e.environmentNameMap&&(n=e.environmentNameMap[t.environment]),e.environments.push({key:t.environment,value:n})}})),this.environments.length||(this.noReleaseFound=!0,this.environments.push({key:"",value:this.translate("TagManager_NoReleasesFound")})),this.$emit("fetchInstallInstructions"),this.fetchVariables(n)}},linkTo:function(e,t,n,a){var i=u["MatomoUrl"].stringify(Object.assign(Object.assign({},u["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:e,idSite:t,idContainer:n})),r="".concat(window.location.pathname,"?").concat(i);return a&&(r+="#?".concat(u["MatomoUrl"].stringify(a))),r},fetchVariables:function(e){var t,n=this;this.matomoConfigs=[],this.idContainer&&null!==(t=this.site)&&void 0!==t&&t.id&&e&&u["AjaxHelper"].fetch({method:"TagManager.getContainerVariables",filter_limit:"-1",idContainer:this.idContainer,idContainerVersion:e,idSite:this.site.id}).then((function(e){n.matomoConfigs=e.filter((function(e){return"MatomoConfiguration"===e.type}))})).finally((function(){n.isLoading=!1}))}},computed:{getLearnMoreLink:function(){return Object(u["translate"])("TagManager_CustomHtmlTagHelpText",Object(u["externalLink"])("https://matomo.org/faq/tag-manager/container-dashboard-in-matomo-tag-manager/"),"</a>")},getMtmStep3:function(){return Object(u["translate"])("TagManager_CopyCodePasteInHeader","&lt;/head&gt;")},getCongratulationsText:function(){return Object(u["translate"])("TagManager_SiteWithoutDataReactFollowStepCompleted","<strong>","</strong>")},testComponent:function(){return this.showTestSection?Object(u["useExternalPluginComponent"])("JsTrackerInstallCheck","JsTrackerInstallCheck"):""},getAdvancedStepText:function(){var e,t=Object(u["translate"])("TagManager_SelectContainerForWebsite","<strong>","</strong>");if(this.idContainer)return t;var n=this.linkTo("manageContainers",String(null===(e=this.site)||void 0===e?void 0:e.id),""),a=Object(u["translate"])("TagManager_ManageContainersLink",'<a href="'.concat(n,'" target="_blank" rel="noreferrer noopener">'),"</a>");return"".concat(t," ").concat(a)},getAdvancedStepInfo:function(){var e=this.site&&this.site.id?this.site.id:"",t=this.linkTo("dashboard",e,this.idContainer,[]);return Object(u["translate"])("TagManager_CustomiseContainer",'<a href="'.concat(t,'">'),"</a>",Object(u["externalLink"])("https://matomo.org/faq/tag-manager/container-dashboard-in-matomo-tag-manager/"),"</a>")}}});Vm.render=Tm;var Cm=Vm,Nm=Object(r["createElementVNode"])("br",null,null,-1),Em={class:"followStepsHeading"},Sm={style:{"list-style":"inside decimal"}};function wm(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("TrackingCodeCommon");return Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])("getTrackingMethodsForSite"===e.currentAction?"div":"ContentBlock"),{anchor:"tagmanager","content-title":e.translate("TagManager_MatomoTagManager")},{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("p",null,Object(r["toDisplayString"])(e.translate("TagManager_MtmTrackingCodeIntro")),1),Nm,Object(r["createElementVNode"])("p",Em,[Object(r["createElementVNode"])("strong",null,Object(r["toDisplayString"])(e.translate("SitesManager_SiteWithoutDataCloudflareFollowStepsIntro")),1)]),Object(r["createElementVNode"])("ol",Sm,[Object(r["createVNode"])(l,{"show-container-row":e.showContainerRow,showBottom:!0,showDescription:!1,showPlainMtmSteps:!0,showAdvancedOptions:"trackingCodeGenerator"===e.currentAction,showTestSection:"getTrackingMethodsForSite"===e.currentAction&&e.isJsTrackerInstallCheckAvailable,onFetchInstallInstructions:e.fetchInstallInstructions,ref:"trackingCodeCommon"},null,8,["show-container-row","showAdvancedOptions","showTestSection","onFetchInstallInstructions"])])]})),_:1},8,["content-title"])}var km=Object(r["defineComponent"])({props:{currentAction:String,showContainerRow:Boolean,isJsTrackerInstallCheckAvailable:Boolean},components:{ContentBlock:u["ContentBlock"],TrackingCodeCommon:Cm},methods:{fetchInstallInstructions:function(){var e,t,n=this,a=this.$refs.trackingCodeCommon;a.installInstructions=[],null!==a&&void 0!==a&&null!==(e=a.site)&&void 0!==e&&e.id&&null!==a&&void 0!==a&&a.environment&&(a.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getContainerInstallInstructions",filter_limit:"-1",idContainer:null===a||void 0===a?void 0:a.idContainer,environment:null===a||void 0===a?void 0:a.environment,idSite:null===a||void 0===a||null===(t=a.site)||void 0===t?void 0:t.id}).then((function(e){a.installInstructions=e,Object(r["nextTick"])((function(){var e=Array.isArray(n.$refs.codeblock)?n.$refs.codeblock:[n.$refs.codeblock];e.forEach((function(e){$(e).effect("highlight",{},1500)}))}))})).finally((function(){a.isLoading=!1})))}}});km.render=wm;var Mm=km,_m={class:"list-style-decimal"},Dm={ref:"step1"},Am=["innerHTML"],xm=["innerHTML"],Bm=["textContent"],Lm=["innerHTML"],Um=["textContent"],Pm=["innerHTML"],Im=["innerHTML"],Fm=["innerHTML"],Hm=["textContent"],Gm={style:{"list-style":"lower-alpha","list-style-position":"inside"}},$m=["innerHTML"],Rm=["innerHTML"],qm=["innerHTML"],zm=["textContent"],Wm=["textContent"],Xm=["innerHTML"],Km=["textContent"],Jm=["innerHTML"],Ym=["innerHTML"],Zm=["textContent"];function Qm(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("TrackingCodeCommon"),c=Object(r["resolveDirective"])("copy-to-clipboard");return Object(r["openBlock"])(),Object(r["createElementBlock"])("ol",_m,[Object(r["withDirectives"])(Object(r["createElementVNode"])("li",Dm,[Object(r["createVNode"])(l,{"show-container-row":e.showContainerRow,showBottom:!1,showDescription:!1,onFetchInstallInstructions:e.fetchInstallInstructionsSPA,ref:"trackingCodeCommon"},null,8,["show-container-row","onFetchInstallInstructions"])],512),[[r["vShow"],e.step1HasContent]]),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.setupStep2)},null,8,Am),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep3)},null,8,xm),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchClickX("TagManager_CreateNewTrigger"))},null,8,Bm),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep5)},null,8,Lm),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchClickX("TagManager_CreateNewTrigger"))},null,8,Um),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.setupStep7)},null,8,Pm),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep8)},null,8,Im),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep9)},null,8,Fm),Object(r["createElementVNode"])("li",null,[Object(r["createElementVNode"])("span",{textContent:Object(r["toDisplayString"])(e.fetchFollowStep10)},null,8,Hm),Object(r["createElementVNode"])("ol",Gm,[Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep10a)},null,8,$m),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep10b)},null,8,Rm)])]),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep11)},null,8,qm),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchClickX("General_Update"))},null,8,zm),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchFollowStep13)},null,8,Wm),Object(r["createElementVNode"])("li",{innerHTML:e.$sanitize(e.fetchFollowStep14)},null,8,Xm),Object(r["createElementVNode"])("li",{textContent:Object(r["toDisplayString"])(e.fetchFollowStep15)},null,8,Km),Object(r["createElementVNode"])("li",null,["react"===e.jsFramework?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:0,innerHTML:e.$sanitize(e.fetchFollowStep16React)},null,8,Jm)):(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:1,innerHTML:e.$sanitize(e.fetchFollowStep16SPA)},null,8,Ym)),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.installInstructions,(function(e,t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:t},[Object(r["withDirectives"])(Object(r["createElementVNode"])("pre",{class:"codeblock",textContent:Object(r["toDisplayString"])(e.embedCode),ref:"codeblock"},null,8,Zm),[[c,{}]])])})),128))])])}var eb=Object(r["defineComponent"])({props:{showContainerRow:Boolean,jsFramework:String},components:{TrackingCodeCommon:Cm},directives:{CopyToClipboard:u["CopyToClipboard"]},data:function(){return{setupStep1:"",setupStep2:"",setupStep7:"",installInstructions:[]}},methods:{fetchInstallInstructionsSPA:function(){var e,t,n=this,a=this.$refs.trackingCodeCommon;if(this.installInstructions=[],null!==a&&void 0!==a&&a.idContainer&&null!==a&&void 0!==a&&a.environment&&null!==a&&void 0!==a&&null!==(e=a.site)&&void 0!==e&&e.id){var i=this.linkTo("manageContainers",a.site.id,a.idContainer);this.setupStep1=Object(u["translate"])("TagManager_SPAFollowStep1","<br><strong>","</strong>",'<a href="'.concat(i,'" target="_blank" rel="noreferrer noopener">'),"</a>");var o=this.linkTo("manageTriggers",a.site.id,a.idContainer);this.setupStep2=Object(u["translate"])("TagManager_SPAFollowStep2",'<a href="'.concat(o,'" target="_blank" rel="noreferrer noopener">'),"</a>");var l=this.linkTo("manageTags",a.site.id,a.idContainer);this.setupStep7=Object(u["translate"])("TagManager_SPAFollowStep7",'<a href="'.concat(l,'" target="_blank" rel="noreferrer noopener">'),"</a>"),a.isLoading=!0,u["AjaxHelper"].fetch({method:"TagManager.getContainerInstallInstructions",filter_limit:"-1",idContainer:null===a||void 0===a?void 0:a.idContainer,environment:null===a||void 0===a?void 0:a.environment,idSite:null===a||void 0===a||null===(t=a.site)||void 0===t?void 0:t.id,jsFramework:this.jsFramework}).then((function(e){n.installInstructions=e,Object(r["nextTick"])((function(){var e=Array.isArray(n.$refs.codeblock)?n.$refs.codeblock:[n.$refs.codeblock];e.forEach((function(e){$(e).effect("highlight",{},1500)}))}))})).finally((function(){a.isLoading=!1}))}},linkTo:function(e,t,n,a){var i=u["MatomoUrl"].stringify(Object.assign(Object.assign({},u["MatomoUrl"].urlParsed.value),{},{module:"TagManager",action:e,idSite:t,idContainer:n}));return a&&(i+="#?".concat(u["MatomoUrl"].stringify(a))),"?".concat(i)},fetchClickX:function(e){return Object(u["translate"])("General_ClickX",Object(u["translate"])(e))}},computed:{step1HasContent:function(){var e=this.$refs.step1;return e&&""!==e.textContent},fetchFollowStep3:function(){return Object(u["translate"])("TagManager_SPAFollowStep3","<strong>".concat(Object(u["translate"])("TagManager_PageViewTriggerName"),"</strong>"),Object(u["translate"])("TagManager_PageViewTriggerName"),Object(u["externalLink"])("https://matomo.org/faq/tag-manager/how-do-i-track-pageviews-of-my-website-using-matomo-tag-manager/#create-pageview-trigger"),"</a>")},fetchFollowStep5:function(){return Object(u["translate"])("TagManager_SPAFollowStep5","<strong>".concat(Object(u["translate"])("TagManager_HistoryChangeTriggerName"),"</strong>"),Object(u["translate"])("TagManager_CategoryUserEngagement"))},fetchFollowStep8:function(){return Object(u["translate"])("TagManager_SPAFollowStep8","<strong>".concat(Object(u["translate"])("TagManager_PageViewTriggerName"),"</strong>"),"<strong>".concat(Object(u["translate"])("TagManager_MatomoTagName"),"</strong>"),Object(u["translate"])("TagManager_PageViewTriggerName"),Object(u["externalLink"])("https://matomo.org/faq/tag-manager/how-do-i-track-pageviews-of-my-website-using-matomo-tag-manager/#create-pageview-tag"),"</a>")},fetchFollowStep9:function(){return Object(u["translate"])("TagManager_SPAFollowStep9",Object(u["translate"])("TagManager_ConfigureWhatTagDoes"),Object(u["translate"])("TagManager_CustomTitle"),"<strong>","</strong>")},fetchFollowStep10:function(){return Object(u["translate"])("TagManager_SPAFollowStep10",Object(u["translate"])("TagManager_CustomUrl"))},fetchFollowStep10a:function(){return Object(u["translate"])("TagManager_SPAFollowStep10a","<strong>","</strong>",Object(u["translate"])("TagManager_CustomUrl"))},fetchFollowStep10b:function(){return Object(u["translate"])("TagManager_SPAFollowStep10b",Object(u["translate"])("TagManager_CustomUrl"),"<strong>","</strong>")},fetchFollowStep11:function(){return Object(u["translate"])("TagManager_SPAFollowStep11",Object(u["translate"])("TagManager_ConfigureWhenTagDoes"),Object(u["translate"])("TagManager_FireTriggerTitle"),"<strong>".concat(Object(u["translate"])("TagManager_HistoryChangeTriggerName"),"</strong>"),"<strong>".concat(Object(u["translate"])("TagManager_PageViewTriggerName"),"</strong>"))},fetchFollowStep13:function(){return Object(u["translate"])("TagManager_SPAFollowStep13",Object(u["translate"])("TagManager_Publish"))},fetchFollowStep14:function(){return Object(u["translate"])("TagManager_SPAFollowStep14",Object(u["translate"])("TagManager_VersionName"),"<strong>","</strong>")},fetchFollowStep15:function(){return Object(u["translate"])("TagManager_SPAFollowStep15",Object(u["translate"])("TagManager_CreateVersionAndPublishRelease"))},fetchFollowStep16SPA:function(){return Object(u["translate"])("TagManager_SPAFollowStep16","&lt;/head&gt;",Object(u["externalLink"])("https://developer.matomo.org/guides/tagmanager/embedding"),"</a>")},fetchFollowStep16React:function(){return Object(u["translate"])("TagManager_ReactFollowStep16","<strong>","</strong>","<strong>App.js</strong>","<strong>React.useEffect</strong>","<strong>Hello World</strong>","<strong>React.js</strong>")}}});eb.render=Qm;var tb,nb,ab=eb,ib={class:"nav-wrapper"},rb={class:"pull-right"},ob=Object(r["createElementVNode"])("svg",{class:"tm-icon tm-icon-close"},[Object(r["createElementVNode"])("use",{"xlink:href":"#tm-icon-close"})],-1),lb=[ob],cb={class:"pull-right"},sb=Object(r["createElementVNode"])("svg",{"aria-hidden":"true",style:{position:"absolute",width:"0",height:"0",overflow:"hidden"},version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},[Object(r["createElementVNode"])("defs",null,[Object(r["createElementVNode"])("symbol",{id:"tm-icon-checkmark",viewBox:"0 0 32 32"},[Object(r["createElementVNode"])("path",{d:"M27 4l-15 15-7-7-5 5 12 12 20-20z"})])])],-1),db=Object(r["createElementVNode"])("svg",{"aria-hidden":"true",style:{position:"absolute",width:"0",height:"0",overflow:"hidden"},version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},[Object(r["createElementVNode"])("symbol",{id:"tm-icon-close",viewBox:"0 0 32 32"},[Object(r["createElementVNode"])("path",{d:"M31.33 0.67c0.893 0.893 0.893 2.34 0 3.232l-27.427 27.427c-0.893 0.893-2.34\n          0.893-3.232 0s-0.893-2.34 0-3.232l27.427-27.427c0.892-0.893 2.34-0.893 3.232 0z"}),Object(r["createElementVNode"])("path",{d:"M0.67 0.67c0.893-0.893 2.34-0.893 3.232 0l27.427 27.427c0.893 0.892 0.893\n          2.34 0 3.232s-2.34 0.892-3.232 0l-27.427-27.427c-0.893-0.893-0.893-2.34 0-3.232z"})])],-1),ub={class:"page",style:{clear:"both"}},gb={key:0,id:"secondNavBar",class:"Menu--dashboard z-depth-1"},mb={class:"navbar",role:"menu",style:{padding:"0"}},bb={class:"menuTab",role:"menuitem"},pb={class:"item",style:{"font-weight":"normal"}},hb=Object(r["createTextVNode"])(" Events "),fb={key:0},vb=Object(r["createElementVNode"])("br",null,null,-1),jb=Object(r["createElementVNode"])("br",null,null,-1),Ob=Object(r["createElementVNode"])("label",{for:"onlyfiredTags",class:"lbl-onlyfiredTags"},"Only fired tags",-1),Tb={key:0,style:{padding:"0 0 1rem 1.2rem"}},yb=["onClick","title"],Vb={title:"This tag was fired"},Cb=Object(r["createElementVNode"])("svg",{class:"tm-icon tm-icon-checkmark"},[Object(r["createElementVNode"])("use",{"xlink:href":"#tm-icon-checkmark"})],-1),Nb=[Cb],Eb={class:"pageWrap"},Sb={class:"home",id:"content"},wb=Object(r["createElementVNode"])("h3",null,"Fired Tags",-1),kb={class:"entityTable"},Mb=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Action"),Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type"),Object(r["createElementVNode"])("th",null,"Fired count")])],-1),_b={key:0},Db=Object(r["createElementVNode"])("td",{colspan:"4"},"No tags",-1),Ab=[Db],xb=Object(r["createElementVNode"])("h3",{style:{"margin-top":"30px"}},"Not Yet Fired Tags",-1),Bb={class:"entityTable"},Lb=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type")])],-1),Ub=Object(r["createElementVNode"])("td",{colspan:"4"},"No tags",-1),Pb=[Ub],Ib=Object(r["createElementVNode"])("h3",null,"Triggers",-1),Fb={class:"entityTable"},Hb=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type")])],-1),Gb={key:0},$b=Object(r["createElementVNode"])("td",{colspan:"4"},"No trigger",-1),Rb=[$b],qb={key:1},zb=Object(r["createElementVNode"])("h3",null,"Pushed data by this event",-1),Wb={class:"entityTable"},Xb={style:{"word-break":"break-all"}},Kb=Object(r["createElementVNode"])("br",null,null,-1),Jb=Object(r["createElementVNode"])("h3",null,"Content after this event",-1),Yb={class:"entityTable"},Zb={style:{"word-break":"break-all"}},Qb={class:"entityTable"},ep=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Name"),Object(r["createElementVNode"])("th",null,"Type"),Object(r["createElementVNode"])("th",null,"Value")])],-1),tp={key:0},np=Object(r["createElementVNode"])("td",{colspan:"3"},"No variables",-1),ap=[np],ip={style:{"word-break":"break-all"}},rp={class:"entityTable"},op=Object(r["createElementVNode"])("thead",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("th",null,"Time"),Object(r["createElementVNode"])("th",null,"Message")])],-1),lp={style:{"word-break":"break-all"}},cp=Object(r["createElementVNode"])("br",null,null,-1);function sp(e,t,n,a,i,o){var l,c,s,d,u,g,m,b,p,h;return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",null,[Object(r["createElementVNode"])("nav",null,[Object(r["createElementVNode"])("div",ib,[Object(r["createElementVNode"])("ul",null,[Object(r["createElementVNode"])("li",null,[Object(r["renderSlot"])(e.$slots,"logo")]),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"tags"===e.contentTab||!e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[0]||(t[0]=function(t){return e.contentTab="tags"})},"Tags")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"triggers"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[1]||(t[1]=function(t){return e.contentTab="triggers"})},"Triggers")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"variables"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[2]||(t[2]=function(t){return e.contentTab="variables"})},"Variables")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"dataLayer"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[3]||(t[3]=function(t){return e.contentTab="dataLayer"})},"Data Layer")],2),Object(r["createElementVNode"])("li",{class:Object(r["normalizeClass"])({active:"logs"===e.contentTab})},[Object(r["createElementVNode"])("a",{onClick:t[4]||(t[4]=function(t){return e.contentTab="logs"})},"Logs")],2),Object(r["createElementVNode"])("li",rb,[Object(r["createElementVNode"])("a",{id:"mtmCloseDebug",onClick:t[5]||(t[5]=function(t){return e.mtmCloseDebugWindow()})},lb)]),Object(r["createElementVNode"])("li",cb,[Object(r["createElementVNode"])("a",{id:"mtmUpdateDebugPosition",onClick:t[6]||(t[6]=function(t){return e.mtmUpdateDebugPosition()})},Object(r["toDisplayString"])(e.positionText),1)])])])]),sb,db,Object(r["createElementVNode"])("div",ub,["logs"!==e.contentTab?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",gb,[Object(r["createElementVNode"])("ul",mb,[Object(r["createElementVNode"])("li",bb,[Object(r["createElementVNode"])("span",pb,[hb,e.mtmEvents.length>0?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",fb,[vb,jb,Object(r["withDirectives"])(Object(r["createElementVNode"])("input",{type:"checkbox",class:"onlyFiredTags-chk",name:"onlyfiredTags",id:"onlyfiredTags",value:"1","onUpdate:modelValue":t[7]||(t[7]=function(t){return e.onlyfiredTags=t}),style:{"margin-right":"3.5px"}},null,512),[[r["vModelCheckbox"],e.onlyfiredTags]]),Ob])):Object(r["createCommentVNode"])("",!0)])]),0===e.mtmEvents.length?(Object(r["openBlock"])(),Object(r["createElementBlock"])("li",Tb,"No event executed")):Object(r["createCommentVNode"])("",!0),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.mtmEventsReversed,(function(t,n){var a,i;return Object(r["openBlock"])(),Object(r["createElementBlock"])("li",{class:Object(r["normalizeClass"])(["menuTab",{active:n===e.selectedEventIndex}]),role:"menuitem",key:n},[(t.tags||[]).length||!e.onlyfiredTags?(Object(r["openBlock"])(),Object(r["createElementBlock"])("a",{key:0,class:"item",onClick:function(n){return e.selectEvent(t.index0)},title:"Time: ".concat(t.time,". Trigger: ").concat(null===(a=t.metTrigger)||void 0===a?void 0:a.name)},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.index)+": "+Object(r["toDisplayString"])(t.name)+" ",1),Object(r["withDirectives"])(Object(r["createElementVNode"])("span",Vb,Nb,512),[[r["vShow"],null===(i=t.tags)||void 0===i?void 0:i.length]])],8,yb)):Object(r["createCommentVNode"])("",!0)],2)})),128))])])):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("div",Eb,[Object(r["createElementVNode"])("div",Sb,[Object(r["withDirectives"])(Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.homeTabTitle),513),[[r["vShow"],"logs"!==e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[wb,Object(r["createElementVNode"])("table",kb,[Mb,Object(r["createElementVNode"])("tbody",null,[null!==(l=e.selectedEvent)&&void 0!==l&&null!==(c=l.tags)&&void 0!==c&&c.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",_b,Ab)),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])((null===(s=e.selectedEvent)||void 0===s?void 0:s.tags)||[],(function(e,t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.action),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.type),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.numExecuted),1)])})),128))])]),xb,Object(r["createElementVNode"])("table",Bb,[Lb,Object(r["createElementVNode"])("tbody",null,[Object(r["withDirectives"])(Object(r["createElementVNode"])("tr",null,Pb,512),[[r["vShow"],0===e.notFiredTags.length]]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.notFiredTags,(function(e,t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.type),1)])})),128))])])],512),[[r["vShow"],"tags"===e.contentTab||!e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Ib,Object(r["createElementVNode"])("table",Fb,[Hb,Object(r["createElementVNode"])("tbody",null,[null!==(d=e.selectedEvent)&&void 0!==d&&d.metTrigger?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",Gb,Rb)),null!==(u=e.selectedEvent)&&void 0!==u&&u.metTrigger?(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",qb,[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.selectedEvent.metTrigger.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.selectedEvent.metTrigger.type),1)])):Object(r["createCommentVNode"])("",!0)])])],512),[[r["vShow"],"triggers"===e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[zb,Object(r["createElementVNode"])("table",Wb,[Object(r["createElementVNode"])("tbody",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Xb,Object(r["toDisplayString"])(e.selectedEventData),1)])])]),Kb,Jb,Object(r["createElementVNode"])("table",Yb,[Object(r["createElementVNode"])("tbody",null,[Object(r["createElementVNode"])("tr",null,[Object(r["createElementVNode"])("td",Zb,Object(r["toDisplayString"])(e.selectedEventContainerDataLayer),1)])])])],512),[[r["vShow"],"dataLayer"===e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("table",Qb,[ep,Object(r["createElementVNode"])("tbody",null,[null!==(g=e.selectedEvent)&&void 0!==g&&null!==(m=g.container)&&void 0!==m&&null!==(b=m.variables)&&void 0!==b&&b.length?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",tp,ap)),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])((null===(p=e.selectedEvent)||void 0===p||null===(h=p.container)||void 0===h?void 0:h.variables)||[],(function(t,n){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:n},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(t.name),1),Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(t.type),1),Object(r["createElementVNode"])("td",ip,Object(r["toDisplayString"])(e.stringifySelectedVariable(t)),1)])})),128))])])],512),[[r["vShow"],"variables"===e.contentTab]]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("table",rp,[op,Object(r["createElementVNode"])("tbody",null,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.mtmLogs,(function(e,t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("tr",{key:t},[Object(r["createElementVNode"])("td",null,Object(r["toDisplayString"])(e.time),1),Object(r["createElementVNode"])("td",lp,[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(e.messages,(function(e,t){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span",{key:t},[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e),1),cp])})),128))])])})),128))])])],512),[[r["vShow"],"logs"===e.contentTab]])])])])])}function dp(e){return bp(e)||mp(e)||gp(e)||up()}function up(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function gp(e,t){if(e){if("string"===typeof e)return pp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pp(e,t):void 0}}function mp(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function bp(e){if(Array.isArray(e))return pp(e)}function pp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function hp(e){return hp="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hp(e)}window.mtmDbgData=Object(r["reactive"])({mtmEvents:(null===(tb=window.mtmDbgData)||void 0===tb?void 0:tb.mtmEvents)||[],mtmLogs:(null===(nb=window.mtmDbgData)||void 0===nb?void 0:nb.mtmLogs)||[]});var fp="mtmPreviewPosition",vp="Stick to Top",jp="Stick to Bottom";function Op(){var e=new WeakSet;function t(t,n){if("object"===hp(n)&&null!==n){if(e.has(n))return"";e.add(n)}return n}return t}var Tp=Object(r["defineComponent"])({data:function(){return{contentTab:"tags",selectedEventIndex:0,onlyfiredTags:!1,positionText:"top"===Object(u["getCookie"])(fp)?jp:vp}},methods:{mtmUpdateDebugPosition:function(){var e=6048e5,t=Object(u["getCookie"])(fp),n="top"===t?"bottom":"top";Object(u["setCookie"])(fp,n,e);var a=window.parent.document.getElementById("mtmDebugFrame");"top"===n?(this.positionText=jp,a.classList.remove("mtmStickyBottom"),a.classList.add("mtmStickyTop")):(this.positionText=vp,a.classList.remove("mtmStickyTop"),a.classList.add("mtmStickyBottom"))},mtmCloseDebugWindow:function(){var e=window.parent.document.getElementById("mtmDebugFrame");e&&(e.style.display="none")},selectEvent:function(e){this.mtmEvents[e]&&(this.selectedEventIndex=e)},stringifySelectedVariable:function(e){return JSON.stringify(e.value,Op())}},computed:{homeTabTitle:function(){var e;if(null===(e=this.selectedEvent)||void 0===e||!e.container)return"";var t=this.selectedEvent.container.versionName||"Draft version",n=this.selectedEvent.container.id,a=this.selectedEventIndex+1;return"Event ".concat(a,": ").concat(this.selectedEvent.name," (").concat(n," - ").concat(t,")")},notFiredTags:function(){var e;if(null===(e=this.selectedEvent)||void 0===e||!e.container)return[];var t=this.selectedEventIndex,n=[];this.mtmEvents.forEach((function(e,a){a>t||n.push.apply(n,dp(e.tags.map((function(e){return e.name}))))}));var a=[];return this.selectedEvent.container.tags.forEach((function(e){-1===n.indexOf(e.name)&&a.push(e)})),a},selectedEvent:function(){return this.mtmEvents[this.selectedEventIndex]},mtmEvents:function(){return window.mtmDbgData.mtmEvents},mtmEventsReversed:function(){var e=dp(this.mtmEvents);return e.reverse(),e},mtmLogs:function(){return window.mtmDbgData.mtmLogs},selectedEventData:function(){var e;return(null===(e=this.selectedEvent)||void 0===e?void 0:e.eventData)&&JSON.stringify(this.selectedEvent.eventData,Op())},selectedEventContainerDataLayer:function(){var e,t;return(null===(e=this.selectedEvent)||void 0===e||null===(t=e.container)||void 0===t?void 0:t.dataLayer)&&JSON.stringify(this.selectedEvent.container.dataLayer,Op())}}});Tp.render=sp;var yp=Tp,Vp={class:"copyMtmObjectDialog"},Cp=["innerHTML"],Np=["innerHTML"];function Ep(e,t,n,a,i,o){var l=Object(r["resolveComponent"])("Field"),c=Object(r["resolveDirective"])("form");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",Vp,[Object(r["createElementVNode"])("h2",null,Object(r["toDisplayString"])(e.getCopyDialogTitle),1),Object(r["createElementVNode"])("p",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.getCopyDescription)+"  ",1),Object(r["createElementVNode"])("span",{innerHTML:e.$sanitize(e.getLearnMoreLink),class:"learnMore"},null,8,Cp)]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"site",name:"destinationSite",title:e.translate("TagManager_ChooseWebsite"),modelValue:e.site,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.site=t})},null,8,["title","modelValue"]),"container"!==e.copyType.toLowerCase()?(Object(r["openBlock"])(),Object(r["createBlock"])(l,{key:0,uicontrol:"select",name:"idDestinationContainer",options:e.containerOptions,disabled:e.containerOptions.length<=1,"full-width":!0,title:e.translate("TagManager_Container"),modelValue:e.idDestinationContainer,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.idDestinationContainer=t})},null,8,["options","disabled","title","modelValue"])):Object(r["createCommentVNode"])("",!0),"container"===e.copyType.toLowerCase()?(Object(r["openBlock"])(),Object(r["createElementBlock"])("p",{key:1,class:"copyNote",innerHTML:e.$sanitize(e.getCopyContainerNote)},null,8,Np)):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("button",{class:"btn",onClick:t[2]||(t[2]=function(){return e.performCopy&&e.performCopy.apply(e,arguments)})},Object(r["toDisplayString"])(e.translate("General_Copy")),1)],512),[[c]])])}var Sp=Object(r["defineComponent"])({props:{defaultSite:{type:Object,required:!0},copyType:{type:String,required:!0},copyNonce:{type:String,required:!1,default:""},idToCopy:{type:[String,Number],required:!0},idSourceContainer:{type:String,required:!1,default:""},idContainerVersion:{type:Number,required:!1,default:0}},directives:{Form:g["Form"]},components:{Field:g["Field"]},data:function(){return{site:this.defaultSite,idDestinationContainer:"",containerOptions:[]}},created:function(){this.onSiteChange(),this.idDestinationContainer=this.idSourceContainer},watch:{site:function(){this.onSiteChange()}},methods:{onSiteChange:function(){var e,t=this;"container"!==this.copyType.toLowerCase()&&(this.containerOptions=[],this.idDestinationContainer="",null!==(e=this.site)&&void 0!==e&&e.id&&u["AjaxHelper"].fetch({method:"TagManager.getContainers",filter_limit:"-1",idSite:this.site.id}).then((function(e){if(t.containerOptions=[],null===e||void 0===e||!e.length)return t.idDestinationContainer="",void t.containerOptions.push({key:"",value:t.translate("TagManager_NoContainersFound")});e.forEach((function(e){t.idDestinationContainer||(t.idDestinationContainer=e.idcontainer),t.containerOptions.push({key:e.idcontainer,value:e.name})}))})))},performCopy:function(){var e,t=this,n={module:"TagManager",action:"",idSite:this.defaultSite.id,idDestinationSite:null!==(e=this.site)&&void 0!==e&&e.id?this.site.id:0,nonce:this.copyNonce,idDestinationContainer:"",idSourceContainer:"",idContainerVersion:0,idContainer:0,idTag:0,idTrigger:0,idVariable:0};switch(this.copyType.toLowerCase()){case"container":n.action="copyContainer",n.idContainer=this.idToCopy;break;case"tag":n.action="copyTag",n.idTag=this.idToCopy;break;case"trigger":n.action="copyTrigger",n.idTrigger=this.idToCopy;break;case"variable":n.action="copyVariable",n.idVariable=this.idToCopy;break;default:throw Error("Unrecognised copy object type.")}this.idDestinationContainer&&(n.idDestinationContainer=this.idDestinationContainer),this.idSourceContainer&&(n.idSourceContainer=this.idSourceContainer),this.idContainerVersion>0&&(n.idContainerVersion=this.idContainerVersion),u["AjaxHelper"].fetch(n).then((function(e){if(!e||!e.isSuccess||!e.urlToNewCopy){var n=Object(u["translate"])("General_ErrorRequest","",""),a=u["NotificationsStore"].show({message:n,id:"CopyDialogResultNotification",context:"error",type:"transient"});return u["NotificationsStore"].scrollToNotification(a),void window.Piwik_Popover.close()}t.reloadEntityStore(),t.displaySuccessNotification(e.urlToNewCopy),window.Piwik_Popover.close()}))},reloadEntityStore:function(){switch(this.copyType.toLowerCase()){case"container":ud.reload();break;case"tag":bo.reload(this.idSourceContainer,this.idContainerVersion);break;case"trigger":ya.reload(this.idSourceContainer,this.idContainerVersion);break;case"variable":ft.reload(this.idSourceContainer,this.idContainerVersion);break;default:throw Error("Unrecognised copy object type.")}},displaySuccessNotification:function(e){var t="TagManager_CopyXSuccess",n="";switch(this.copyType.toLowerCase()){case"container":n="TagManager_ContainerLowercase";break;case"tag":n="TagManager_TagLowercase";break;case"trigger":n="TagManager_TriggerLowercase";break;case"variable":n="TagManager_VariableLowercase";break;default:throw Error("Unrecognised copy object type.")}var a=Object(u["translate"])(t,['<a href="'.concat(e,'">'),Object(u["translate"])(n),"</a>"]),i=u["NotificationsStore"].show({message:a,id:"CopyDialogResultNotification",context:"success",type:"transient"});u["NotificationsStore"].scrollToNotification(i)}},computed:{getCopyDialogTitle:function(){var e="";switch(this.copyType.toLowerCase()){case"container":e=Object(u["translate"])("TagManager_Container");break;case"tag":e=Object(u["translate"])("TagManager_Tag");break;case"trigger":e=Object(u["translate"])("TagManager_Trigger");break;case"variable":e=Object(u["translate"])("TagManager_Variable");break;default:throw Error("Unrecognised copy object type.")}return Object(u["translate"])("TagManager_CopyX",e)},getCopyDescription:function(){if("container"===this.copyType.toLowerCase())return Object(u["translate"])("TagManager_CopyContainerDescription");var e="";switch(this.copyType.toLowerCase()){case"tag":e=Object(u["translate"])("TagManager_TagLowercase");break;case"trigger":e=Object(u["translate"])("TagManager_TriggerLowercase");break;case"variable":e=Object(u["translate"])("TagManager_VariableLowercase");break;default:throw Error("Unrecognised copy object type.")}return Object(u["translate"])("TagManager_CopyXDescription",e)},getCopyContainerNote:function(){return Object(u["translate"])("TagManager_CopyContainerNote","<strong>","</strong>")},getCopyUrl:function(){var e,t={module:"TagManager",action:"",idSite:this.defaultSite.id,idDestinationSite:null!==(e=this.site)&&void 0!==e&&e.id?this.site.id:0,nonce:this.copyNonce,idDestinationContainer:"",idSourceContainer:"",idContainerVersion:0,idContainer:0,idTag:0,idTrigger:0,idVariable:0};switch(this.copyType.toLowerCase()){case"container":t.action="copyContainer",t.idContainer=this.idToCopy;break;case"tag":t.action="copyTag",t.idTag=this.idToCopy;break;case"trigger":t.action="copyTrigger",t.idTrigger=this.idToCopy;break;case"variable":t.action="copyVariable",t.idVariable=this.idToCopy;break;default:throw Error("Unrecognised copy object type.")}return this.idDestinationContainer&&(t.idDestinationContainer=this.idDestinationContainer),this.idSourceContainer&&(t.idSourceContainer=this.idSourceContainer),this.idContainerVersion>0&&(t.idContainerVersion=this.idContainerVersion),"?".concat(u["MatomoUrl"].stringify(t))},getLearnMoreLink:function(){var e="";switch(this.copyType.toLowerCase()){case"container":e="https://matomo.org/faq/tag-manager/how-to-copy-a-matomo-tag-manager-container-and-its-components";break;case"tag":e="https://matomo.org/faq/tag-manager/how-to-copy-a-tag-in-matomo-tag-manager ";break;case"trigger":e="https://matomo.org/faq/tag-manager/how-to-copy-a-trigger-in-matomo-tag-manager";break;case"variable":e="https://matomo.org/faq/tag-manager/how-to-copy-a-variable-in-matomo-tag-manager";break;default:throw Error("Unrecognised copy object type.")}var t=Object(u["externalLink"])(e);return Object(u["translate"])("TagManager_LearnMoreFullStop",t,"</a>")}}});Sp.render=Ep;var wp=Sp;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=TagManager.umd.min.js.map